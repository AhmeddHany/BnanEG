@using Bnan.Core.Extensions;
@using Bnan.Ui.ViewModels.BS;
@using Microsoft.AspNetCore.Identity;
@using Microsoft.EntityFrameworkCore;
@using Newtonsoft.Json;
@model BSLayoutVM
@inject UserManager<CrMasUserInformation> userManager
@inject SignInManager<CrMasUserInformation> signinManager
@inject IViewLocalizer localizer
@{
    var user = await userManager.GetUserAsync(User);
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    ViewData["returnUrl"] = string.IsNullOrEmpty(Context.Request.Path) ? "~/" : $"~{Context.Request.Path.Value}";
    var userInfo = await userManager.Users
          .Include(l => l.CrMasUserMainValidations)
          .Include(l => l.CrMasUserSubValidations)
          .Include(l => l.CrMasUserInformationLessorNavigation)
          .Include(l => l.CrMasUserContractValidity)
          .FirstOrDefaultAsync(l => l.UserName == user.UserName);
    var lessorInfo = await userManager.Users.Include(l => l.CrMasUserInformationLessorNavigation).ThenInclude(l => l.CrMasLessorImage).FirstOrDefaultAsync(x => x.UserName == user.UserName);
}
@* <link href="~/BranchSys/CreateContract/sb-admin-2.min.css" rel="stylesheet">
 *@
<link href="~/BranchSys/CreateContract/css/contract.css" rel="styleSheet">
<link rel="stylesheet" href="~/css/toastr.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
@if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
{
    <link href="~/BranchSys/CreateContract/css/english-style.css" rel="styleSheet">
}
<style>
    .flatpickr-input::placeholder {
        color: #999; /* Make sure the color is not the same as the background */
    }

    .form-control[readonly],
    .form-select[disabled] {
        background-color: #ffffff !important;
        opacity: 1;
        cursor: not-allowed; /* Optional: Change cursor to not-allowed to indicate non-interactivity */
    }

    .content {
        height: 120%;
    }
</style>
<div class="container-fluid ">
    <section class="section-mainCard">
        <div class="row justify-content-center w-100 h-100">
            <div class="col-11 col-sm-10 col-md-11 col-lg-11 col-xl-10 text-center p-0 ">
                <div class="card main-card ">
                    <div class="row pt-2">
                        <a asp-action="Index" asp-area="BS" asp-controller="Home" style="width: fit-content;">
                            <img src="~/BranchSys/CreateContract/img/cancel.png" alt="cancle_icon" class="cancle-icon">
                        </a>
                    </div>
                    <div class="row" style="flex-direction: row-reverse;">
                        <div class="col justify-content-center d-flex title-row">
                            <span class="card-title">
                                @localizer["CreateContract"]
                            </span>
                        </div>
                    </div>
                    <div class="row justify-content-center h-100 content-row">
                        <div class="col-md-11 mx-0 h-100">
                            <form asp-area="BS" asp-action="CreateContract" asp-controller="Contract" id="msform" novalidate class="needs-validation" enctype="multipart/form-data" method="post">
                                <input hidden id="StaticContractCardImg" name="StaticContractCardImg" />
                                <input hidden id="SavePdfArInvoice" name="SavePdfArInvoice" />
                                <input hidden id="SavePdfEnInvoice" name="SavePdfEnInvoice" />
                                <input hidden id="SavePdfArReceipt" name="SavePdfArReceipt" />
                                <input hidden id="SavePdfEnReceipt" name="SavePdfEnReceipt" />
                                <input hidden id="SavePdfArContract" name="SavePdfArContract" />
                                <input hidden id="SavePdfEnContract" name="SavePdfEnContract" />
                                <input hidden asp-for="Contract.RenterInfo.CrMasRenterInformationSignature" />
                                <input hidden asp-for="Contract.RenterInfo.OldSignature" />
                                <input hidden asp-for="Contract.AccountReceiptNo" />
                                <input hidden asp-for="Contract.InitialInvoiceNo" />
                                <input hidden id="language" name="language" />
                                <div class=" pe-4">
                                    <!-- progressbar -->
                                    <ul id="progressbar">
                                        <li class="active" id="tenant">@localizer["Renterr"]</li>
                                        <li id="car">@localizer["Car"]</li>
                                        <li id="driver">@localizer["Driver"]</li>
                                        <li id="add-driver">@localizer["AdditionalDriver"]</li>
                                        <li id="options">@localizer["AdditionalAndChoices"]</li>
                                        <li id="check">@localizer["CheckUp"]</li>
                                        <li id="payment">@localizer["Payment"]</li>

                                    </ul>
                                </div>
                                <fieldset id="">
                                    <div class="form-card form-card1 h-100">
                                        <input hidden asp-for="SelectedBranch" />
                                        <div class="row flex-row-reverse g-3 ">
                                            <div class="col-lg-9">
                                                <div class="row flex-row-reverse align-items-center g-2 gap-2">
                                                    <div class="col-md-4 requird-inputs-col">
                                                        <label for="national-number" class="form-label">@localizer["RenterId"]</label>
                                                        <input type="text" class="form-control inputs-style" asp-for="Contract.RenterInfo.CrMasRenterInformationId" maxlength="20" autofocus>
                                                        <div class="row requird-field-row">
                                                            <span class="requird-field" id="requird-field_RenterID" asp-validation-for="Contract.RenterInfo.CrMasRenterInformationId"></span>
                                                        </div>
                                                    </div>
                                                    <div class="col-auto seacrh-icon-col" id="seacrh_icon_Renter" style="display:none">
                                                        <img src="~/BranchSys/CreateContract/img/seacrh-icon.png" alt="seacrh-icon Image">
                                                        <div class="dropdown-content" id="dropdown_content_Renter">
                                                            <div class="row dropdown-content-row pt-2">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["FirstVisit"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="FirstVisit"></p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["LastContract"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="LastContract"></p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["ActiveContractsCount"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="ActiveContractsCount">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["ClosedContractsCount"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="ClosedContractsCount">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["RentalDays"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="RentalDays">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["KilometersCut"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="KMCut">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["AmountsTraded"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="AmountsTraded">0.00</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["Balance"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="BalanceRenter">0.00</p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["AvailableBalance"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="AvailableBalance">0.00</p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["ReservedBalance"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="ReservedBalance">0.00</p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["Evaluation"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="DealingMechanism"></p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["Membership"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="Membership"></p>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 requird-inputs-col">
                                                        <label for="nationality-type" class="form-label">
                                                            @localizer["UserIdType"]
                                                        </label>
                                                        @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                        {
                                                            <select class="form-select select-style AR-select" id="nationality-type" asp-for="Contract.RenterInfo.CrMasRenterInformationIdtype">
                                                                <option selected></option>
                                                                @foreach (var type in Model.RenterIdtypes)
                                                                {
                                                                    <option value="@type.CrMasSupRenterIdtypeCode">@type.CrMasSupRenterIdtypeEnName</option>
                                                                }
                                                            </select>

                                                        }
                                                        else
                                                        {
                                                            <select class="form-select select-style AR-select text-right" id="nationality-type" asp-for="Contract.RenterInfo.CrMasRenterInformationIdtype">
                                                                <option selected></option>
                                                                @foreach (var type in Model.RenterIdtypes)
                                                                {
                                                                    <option value="@type.CrMasSupRenterIdtypeCode">@type.CrMasSupRenterIdtypeArName</option>
                                                                }
                                                            </select>
                                                        }
                                                        <div class="row requird-field-row">
                                                            <span class="requird-field" id="requird-field_RenterIDType" asp-validation-for="@Model.Contract.RenterInfo.CrMasRenterInformationIdtype"></span>
                                                        </div>
                                                    </div>
                                                    <div class="col-auto">
                                                        <button type="button" class="btn check-btn payment-button" id="UploadRenderIdPhoto" onclick="setupIDPhotoUpload('UploadRenderIdPhoto','RenterIdImg')">
                                                            <div class="row align-items-center">
                                                                <div class="col-auto">
                                                                    <div class="systems-check">
                                                                        <i class="fa-solid fa-check text-white"></i>
                                                                    </div>
                                                                </div>
                                                                <div class="col">
                                                                    @localizer["RenterIdPhoto"]
                                                                </div>
                                                            </div>
                                                        </button>
                                                        <input hidden asp-for="Contract.RenterInfo.CrMasRenterInformationRenterIdImage" id="RenterIdImg" />
                                                    </div>

                                                </div>
                                            </div>
                                            <div class="col-lg-12">
                                                <div class="row align-items-center g-4 flex-row-reverse">
                                                    <div class="col-lg-3 requird-inputs-col">
                                                        <label for="birth-date" class="form-label">
                                                            @localizer["Birthdate"]
                                                        </label>
                                                        <input type="date" id="birth-date" class="form-control inputs-style" min="1950-01-01" max="" asp-for="Contract.RenterInfo.CrMasRenterInformationBirthDate">
                                                        <div class="row requird-field-row">
                                                            <span class="requird-field" id="requird-field_RenterBirthDate" asp-validation-for="Contract.RenterInfo.CrMasRenterInformationBirthDate"></span>
                                                            <span class="requird-field" id="birth-date-error"></span> <!-- Error message display -->
                                                        </div>
                                                    </div>
                                                    <div class="col-md-auto">
                                                        <button type="button"
                                                                class="btn check-btn check-btn-version2 px-5 Driver-checkModal-open-button"
                                                                id="CheckRenter">
                                                            @localizer["Verification"]
                                                        </button>
                                                    </div>
                                                    <div class="col">
                                                        <div class="row  justify-content-start flex-row-reverse align-items-center" style="display:none" id="RenterIsdriverDiv">
                                                            <div class="col-auto">
                                                                <div class="form-check">
                                                                    <label class="form-check-label" for="RenterIsdriver"> @localizer["TheRenterIsAdriver"]</label>
                                                                    <input class="form-check-input" type="checkbox" name="RenterIsdriver" id="RenterIsdriver" value="tenant-is-driver">
                                                                </div>
                                                            </div>
                                                            <div class="col-auto">
                                                                <div class="form-check form-check2" id="PrivateDriverDiv" style="display:none">
                                                                    <label class="form-check-label" for="PrivateDriver">@localizer["PrivateDriver"]</label>
                                                                    <input class="form-check-input" type="checkbox" name="PrivateDriver" id="PrivateDriver" value="another-driver">
                                                                </div>
                                                            </div>
                                                            <div class=" col-md-6  col-xl-4" id="Private-Driver-select-Div" style="display: none;">
                                                                <label for="Private-Driver-selectt" class="form-label">@localizer["ChooseYourDriver"]</label>
                                                                @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                                {
                                                                    <select class="form-select select-style AR-select" id="Private-Driver-selectt" asp-for="Contract.PrivateDriverId">
                                                                        <option selected disabled></option>
                                                                        @foreach (var driver in Model.Drivers)
                                                                        {
                                                                            <option value="@driver.CrCasRenterPrivateDriverInformationId">@driver.CrCasRenterPrivateDriverInformationEnName</option>
                                                                        }
                                                                    </select>

                                                                }
                                                                else
                                                                {
                                                                    <select class="form-select select-style AR-select text-right" id="Private-Driver-selectt" asp-for="Contract.PrivateDriverId">
                                                                        <option selected disabled>@localizer["ChooseYourDriver"]</option>
                                                                        @foreach (var driver in Model.Drivers)
                                                                        {
                                                                            <option value="@driver.CrCasRenterPrivateDriverInformationId">@driver.CrCasRenterPrivateDriverInformationArName</option>
                                                                        }
                                                                    </select>
                                                                }

                                                                <div class="row requird-field-row">
                                                                    <p class="requird-field" id="PrivateDriverRequired"></p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>

                                        </div>
                                        <hr class="version2-hr">
                                        <div class="row hidden-input-row hidden-input-row-renter ms-2" style="display: none">
                                            <input type="hidden" asp-for="Contract.RenterInfo.CrMasRenterInformationCountreyKey" />
                                            <input type="hidden" asp-for="Contract.RenterInfo.CrMasRenterInformationMobile" />
                                            <div class="col-lg-12">
                                                <div class="row justify-content-end">
                                                    <div class="col-lg-7 inner-hidden-row-div">
                                                        <div class="row">
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="AR-name-tenant" class="form-label">
                                                                    @localizer["NameArabic"]
                                                                </label>
                                                                <input type="text" id="AR-name-tenant" class="form-control text-end inputs-style" asp-for="Contract.RenterInfo.CrMasRenterInformationArName" maxlength="100" oninput="this.value=this.value.replace(/[^\u0600-\u06FF\ufb50-\ufdff\ufe70-\ufeff\s]/g, '')">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.RenterInfo.CrMasRenterInformationArName"></span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="EN-name-tenant" class="form-label">
                                                                    @localizer["NameEnglish"]
                                                                </label>
                                                                <input type="text" id="EN-name-tenant" class="form-control text-start inputs-style" asp-for="Contract.RenterInfo.CrMasRenterInformationEnName" maxlength="100" oninput="this.value = this.value.replace(/[^a-zA-Z ]/g, '')">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.RenterInfo.CrMasRenterInformationEnName"></span>
                                                                </div>
                                                            </div>


                                                        </div>
                                                        <div class="row ">
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="nationality-tenant" class="form-label">@localizer["RenterDriverNationality"]</label>
                                                                <input type="text" id="nationality-tenant" class="form-control inputs-style" asp-for="Contract.RenterInfo.NationalityText">
                                                                <input type="hidden" id="nationality-tenant-code" asp-for="Contract.RenterInfo.CrMasRenterInformationNationality" maxlength="100">
                                                                <div id="autocomplete-Nationalities1" class="autocomplete-items "></div>
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" id="nationality-tenant-error" asp-validation-for="Contract.RenterInfo.NationalityText"></span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6 " id="divGenderRenter">
                                                                <label class="form-label">
                                                                    @localizer["Gender"]
                                                                </label>
                                                                <div class="d-flex">

                                                                    @foreach (var gender in Model.RenterGender)
                                                                    {
                                                                        <div class="form-check">
                                                                            <input class="form-check-input genderRenter"
                                                                                   type="radio"
                                                                                   id="genderRenter-@gender.CrMasSupRenterGenderCode"
                                                                                   asp-for="Contract.RenterInfo.CrMasRenterInformationGender"
                                                                                   value="@gender.CrMasSupRenterGenderCode"
                                                                                   data-en="@gender.CrMasSupRenterGenderEnName"
                                                                                   data-ar="@gender.CrMasSupRenterGenderArName">

                                                                            <label class="form-check-label" for="genderRenter-@gender.CrMasSupRenterGenderCode">
                                                                                @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                                                {
                                                                                    @gender.CrMasSupRenterGenderEnName
                                                                                }
                                                                                else
                                                                                {
                                                                                    @gender.CrMasSupRenterGenderArName
                                                                                }
                                                                            </label>
                                                                        </div>
                                                                    }
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row align-items-center">
                                                            <div class="col-md-6">
                                                                <label for="Profession-tenant" class="form-label">
                                                                    @localizer["RenterProfessionName"]
                                                                </label>
                                                                @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                                {
                                                                    <select class="form-select select-style AR-select" id="Profession-tenant" asp-for="Contract.RenterInfo.CrMasRenterInformationProfession">
                                                                        <option selected></option>
                                                                        @foreach (var type in Model.RenterProfession)
                                                                        {
                                                                            <option value="@type.CrMasSupRenterProfessionsCode">@type.CrMasSupRenterProfessionsEnName</option>
                                                                        }
                                                                    </select>

                                                                }
                                                                else
                                                                {
                                                                    <select class="form-select select-style AR-select text-right" id="Profession-tenant" asp-for="Contract.RenterInfo.CrMasRenterInformationProfession">
                                                                        <option selected></option>
                                                                        @foreach (var type in Model.RenterProfession)
                                                                        {
                                                                            <option value="@type.CrMasSupRenterProfessionsCode">@type.CrMasSupRenterProfessionsArName</option>
                                                                        }
                                                                    </select>
                                                                }
                                                                <div class="row requird-field-row">
                                                                </div>
                                                            </div>

                                                            <div class="col-md-6">
                                                                <label for="tenant-workplace" class="form-label">@localizer["RenterEmployerName"]</label>
                                                                <input type="text" id="tenant-workplace" class="form-control  inputs-style" maxlength="100">
                                                                <input type="hidden" id="tenant-workplace-code" asp-for="Contract.RenterInfo.CrMasRenterInformationEmployer">
                                                                <div id="autocomplete-workplace1" class="autocomplete-items"></div>
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" id="tenant-workplace-error"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row align-items-center">
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="Region-city-tenant" class="form-label">@localizer["PostCityConcateAr"]</label>
                                                                <input type="text" id="Region-city-tenant" class="form-control  inputs-style" asp-for="Contract.RenterInfo.CityText" maxlength="100">
                                                                <input type="hidden" id="Region-city-tenant-code" asp-for="Contract.RenterInfo.CrMasRenterInformationCity">
                                                                <div id="autocomplete-Cities1" class="autocomplete-items autocomplete-Cities"></div>
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" id="Region-city-tenant-error" asp-validation-for="Contract.RenterInfo.CityText"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <label for="AR-adress-tenant" class="form-label">@localizer["ArAddress"]</label>
                                                                <input type="text" id="AR-adress-tenant" class="form-control text-end inputs-style" asp-for="Contract.RenterInfo.CrMasRenterInformationArAddress" maxlength="200">
                                                                <div class="row requird-field-row">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label for="EN-adress-tenant" class="form-label">@localizer["EnAddress"]</label>
                                                                <input type="text" id="EN-adress-tenant" class="form-control inputs-style text-start" asp-for="Contract.RenterInfo.CrMasRenterInformationEnAddress" maxlength="200">
                                                                <div class="row requird-field-row">
                                                                </div>
                                                            </div>


                                                        </div>
                                                    </div>
                                                    <div class="col-lg-10 inner-hidden-row-div">
                                                        <div class="row tenant-last-row-content g-3">
                                                            <div class="col-md-6 col-lg-4 requird-inputs-col">
                                                                <label for="Email-tenant" class="form-label">
                                                                    @localizer["Email"]
                                                                </label>
                                                                <input type="text" id="Email-tenant" class="form-control inputs-style email-input" asp-for="Contract.RenterInfo.CrMasRenterInformationEmail" maxlength="100">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.RenterInfo.CrMasRenterInformationEmail"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row my-3">
                                                            <div class="col-lg-12">
                                                                <label>@localizer["reasons"]</label>
                                                            </div>
                                                            <div class="col-lg-7">
                                                                <textarea class="form-control textarea-inputs reasons" rows="1" maxlength="100" id="Reasons-tenant" asp-for="Contract.RenterInfo.CrMasRenterInformationReasons" type="text"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row button-row" style="text-align: left;">
                                        <div class="button-card">
                                            <img src="~/BranchSys/CreateContract/img/Group.png" alt="Button Image"
                                                 class="next action-button" style="vertical-align: middle; ">
                                            <input type="button" name="next" class="next action-button"
                                                   id="driver_fieldset" value="@localizer["Next"]" />
                                        </div>
                                    </div>
                                </fieldset>
                                <!--Car Field-->
                                <fieldset>
                                    <div class="form-card">
                                        <div class="row g-4" style="flex-direction: row-reverse;">
                                            <div class=" col-lg-auto car-catogeries my-3 " id="scrollContainer">
                                                <input asp-for="Contract.SerialNo" hidden />
                                                <input asp-for="Contract.PriceNo" hidden />
                                                <div class="row d-flex car-catogeries-div px-2 ">
                                                    <button type="button" class="btn customized-button" onclick="GetCodeCategory(`3400000000`)">@localizer["All"]</button>
                                                    @foreach (var category in Model.CarCategories)
                                                    {
                                                        @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                        {
                                                            <button type="button" class="btn customized-button" onclick="GetCodeCategory(`@category.CrMasSupCarCategoryCode`)">@category.CrMasSupCarCategoryEnName</button>
                                                        }
                                                        else
                                                        {
                                                            <button type="button" class="btn customized-button" onclick="GetCodeCategory(`@category.CrMasSupCarCategoryCode`)">@category.CrMasSupCarCategoryArName</button>
                                                        }
                                                    }
                                                </div>
                                            </div>
                                            <!--Cars Informations-->
                                            <div class="col scrollable-content">
                                                <table width="100%" class="table table-hover" id="ListCars">
                                                    <tbody>
                                                        <partial name="_CarsList" />
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row button-row">
                                        <div class="button-card">
                                        </div>
                                        <div class="button-card">
                                            <input type="button" name="previous" class="previous action-button-previous" value="@localizer["Previous"]" />
                                            <img src="~/BranchSys/CreateContract/Vector.png" alt="Button Image" class="previous action-button-previous" style="vertical-align: middle; ">
                                        </div>
                                    </div>

                                </fieldset>
                                <!--Driver-->
                                <fieldset class="disable-all-inputs">
                                    <div class="form-card form-card1 h-100">
                                        <div class="row flex-row-reverse g-3 ">
                                            <div class="col-lg-9">
                                                <div class="row flex-row-reverse align-items-center gap-2 g-2">
                                                    <div class="col-md-4 requird-inputs-col">
                                                        <label for="national-number-driver" class="form-label">@localizer["RenterId"]</label>
                                                        <input type="text" class="form-control inputs-style" asp-for="Contract.DriverInfo.CrMasRenterInformationId" maxlength="20">
                                                        <div class="row requird-field-row">
                                                            <span class="requird-field" id="requird-field_DriverID" asp-validation-for="Contract.DriverInfo.CrMasRenterInformationId"></span>
                                                        </div>
                                                    </div>
                                                    <div class="col-auto seacrh-icon-col" id="seacrh_icon_Driver" style="display:none">
                                                        <img src="~/BranchSys/CreateContract/img/seacrh-icon.png" alt="seacrh-icon Image" id="driver-details">
                                                        <div class="dropdown-content" id="dropdown_content_Driver">
                                                            <div class="row dropdown-content-row pt-2">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["FirstVisit"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="FirstVisitDriver"></p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["LastContract"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="LastContractDriver"></p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["ActiveContractsCount"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="ActiveContractsCountDriver">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["ClosedContractsCount"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="ClosedContractsCountDriver">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["RentalDays"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="RentalDaysDriver">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["KilometersCut"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="KMCutDriver">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["AmountsTraded"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="AmountsTradedDriver">0.00</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["Balance"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="BalanceRenterDriver">0.00</p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["AvailableBalance"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="AvailableBalanceDriver">0.00</p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["ReservedBalance"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="ReservedBalanceDriver">0.00</p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["Evaluation"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="DealingMechanismDriver"></p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["Membership"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="MembershipDriver"></p>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 requird-inputs-col">
                                                        <label for="nationality-type-driver" class="form-label"> @localizer["UserIdType"]</label>
                                                        @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                        {
                                                            <select class="form-select select-style AR-select" id="nationality-type-driver" asp-for="Contract.DriverInfo.CrMasRenterInformationIdtype">
                                                                <option selected></option>
                                                                @foreach (var type in Model.RenterIdtypes)
                                                                {
                                                                    <option value="@type.CrMasSupRenterIdtypeCode">@type.CrMasSupRenterIdtypeEnName</option>
                                                                }
                                                            </select>
                                                        }
                                                        else
                                                        {
                                                            <select class="form-select select-style AR-select text-right" id="nationality-type-driver" asp-for="Contract.DriverInfo.CrMasRenterInformationIdtype">
                                                                <option selected></option>
                                                                @foreach (var type in Model.RenterIdtypes)
                                                                {
                                                                    <option value="@type.CrMasSupRenterIdtypeCode">@type.CrMasSupRenterIdtypeArName</option>
                                                                }
                                                            </select>
                                                        }
                                                        <div class="row requird-field-row">
                                                            <span class="requird-field" id="requird-field_DriverIDType" asp-validation-for="Contract.DriverInfo.CrMasRenterInformationIdtype"></span>
                                                        </div>
                                                    </div>
                                                    <div class="col-auto">
                                                        <button type="button" class="btn check-btn payment-button " id="DriverIdBtn" onclick="setupIDPhotoUpload('DriverIdBtn','DriverIdImg')">
                                                            <div class="row align-items-center">
                                                                <div class="col-auto">
                                                                    <div class="systems-check">
                                                                        <i class="fa-solid fa-check text-white"></i>
                                                                    </div>
                                                                </div>
                                                                <div class="col">
                                                                    @localizer["RenterIdPhoto"]
                                                                </div>
                                                            </div>
                                                        </button>
                                                        <input hidden asp-for="Contract.DriverInfo.CrMasRenterInformationRenterIdImage" id="DriverIdImg" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">

                                                <div class="row align-items-center g-4 flex-row-reverse">

                                                    <div class="col-md-6 requird-inputs-col">
                                                        <label for="birth-date-driver" class="form-label">
                                                            @localizer["Birthdate"]
                                                        </label>
                                                        <input type="date" id="birth-date-driver" class="form-control inputs-style" min="1950-01-01" max="" asp-for="Contract.DriverInfo.CrMasRenterInformationBirthDate">
                                                        <div class="row requird-field-row">
                                                            <span class="requird-field" id="requird-field_DriverBirthDate" asp-validation-for="Contract.DriverInfo.CrMasRenterInformationBirthDate"></span>
                                                            <span class="requird-field" id="driver-birth-date-error"></span> <!-- Error message display -->
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <button type="button" class="btn check-btn check-btn-version2 px-5 Driver-checkModal-open-button" id="CheckDriver">
                                                            @localizer["Verification"]
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <hr class="version2-hr">
                                        <div class="row  hidden-input-row hidden-input-row-driver ms-2" style="display:none">
                                            <input type="hidden" id="keyCountry-driver" asp-for="Contract.DriverInfo.CrMasRenterInformationCountreyKey" />
                                            <input type="hidden" id="mobile-driver" asp-for="Contract.DriverInfo.CrMasRenterInformationMobile" />
                                            <div class="col-lg-12">
                                                <div class="row justify-content-end">
                                                    <div class="col-lg-7  inner-hidden-row-div">
                                                        <div class="row">
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="AR-name-driver" class="form-label">
                                                                    @localizer["NameArabic"]
                                                                </label>
                                                                <input type="text" id="AR-name-driver" class="form-control text-end inputs-style" maxlength="100" asp-for="Contract.DriverInfo.CrMasRenterInformationArName" oninput="this.value=this.value.replace(/[^\u0600-\u06FF\ufb50-\ufdff\ufe70-\ufeff\s]/g, '')">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.DriverInfo.CrMasRenterInformationArName"></span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="EN-name-driver" class="form-label">
                                                                    @localizer["NameEnglish"]
                                                                </label>
                                                                <input type="text" id="EN-name-driver"
                                                                       class="form-control inputs-style text-start" asp-for="Contract.DriverInfo.CrMasRenterInformationEnName" maxlength="100" oninput="this.value = this.value.replace(/[^a-zA-Z ]/g, '')">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.DriverInfo.CrMasRenterInformationEnName"></span>
                                                                </div>
                                                            </div>


                                                        </div>
                                                        <div class="row ">
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="nationality-driver" class="form-label">@localizer["RenterDriverNationality"]</label>
                                                                <input type="text" id="nationality-driver" class="form-control inputs-style" maxlength="100" asp-for="Contract.DriverInfo.NationalityText">
                                                                <input type="hidden" id="nationality-driver-code" asp-for="Contract.DriverInfo.CrMasRenterInformationNationality">
                                                                <div id="autocomplete-Nationalities2" class="autocomplete-items"></div>
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" id="nationality-driver-error" asp-validation-for="Contract.DriverInfo.NationalityText"></span>
                                                                </div>
                                                            </div>

                                                            <div class="col-md-6 " id="divGenderDriver">
                                                                <label class="form-label">
                                                                    @localizer["Gender"]

                                                                </label>
                                                                <div class="d-flex">
                                                                    @foreach (var gender in Model.RenterGender)
                                                                    {
                                                                        <div class="form-check">
                                                                            <input class="form-check-input genderDriver"
                                                                                   type="radio"
                                                                                   id="genderDriver-@gender.CrMasSupRenterGenderCode"
                                                                                   asp-for="Contract.DriverInfo.CrMasRenterInformationGender"
                                                                                   value="@gender.CrMasSupRenterGenderCode"
                                                                                   data-en="@gender.CrMasSupRenterGenderEnName"
                                                                                   data-ar="@gender.CrMasSupRenterGenderArName">

                                                                            <label class="form-check-label" for="genderRenter-@gender.CrMasSupRenterGenderCode">
                                                                                @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                                                {
                                                                                    @gender.CrMasSupRenterGenderEnName
                                                                                }
                                                                                else
                                                                                {
                                                                                    @gender.CrMasSupRenterGenderArName
                                                                                }
                                                                            </label>
                                                                        </div>
                                                                    }
                                                                    <div class="row requird-field-row">
                                                                    </div>
                                                                </div>

                                                            </div>

                                                        </div>
                                                        <div class="row align-items-center">

                                                            <div class="col-md-6">
                                                                <label for="Profession-driver"
                                                                       class="form-label">
                                                                    @localizer["RenterProfessionName"]
                                                                </label>
                                                                @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                                {
                                                                    <select class="form-select select-style AR-select" id="Profession-driver" asp-for="Contract.DriverInfo.CrMasRenterInformationProfession">
                                                                        <option selected></option>
                                                                        @foreach (var type in Model.RenterProfession)
                                                                        {
                                                                            <option value="@type.CrMasSupRenterProfessionsCode">@type.CrMasSupRenterProfessionsEnName</option>
                                                                        }
                                                                    </select>

                                                                }
                                                                else
                                                                {
                                                                    <select class="form-select select-style AR-select text-right" id="Profession-driver" asp-for="Contract.DriverInfo.CrMasRenterInformationProfession">
                                                                        <option selected></option>
                                                                        @foreach (var type in Model.RenterProfession)
                                                                        {
                                                                            <option value="@type.CrMasSupRenterProfessionsCode">@type.CrMasSupRenterProfessionsArName</option>
                                                                        }
                                                                    </select>
                                                                }
                                                                <div class="row requird-field-row">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label for="driver-workplace" class="form-label">@localizer["RenterEmployerName"]</label>
                                                                <input type="text" id="driver-workplace" class="form-control inputs-style" maxlength="100" maxlength="100">
                                                                <input type="hidden" id="driver-workplace-code" asp-for="Contract.DriverInfo.CrMasRenterInformationEmployer">
                                                                <div id="autocomplete-workplace2" class="autocomplete-items"></div>
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" id="driver-workplace-error"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="Region-city-driver" class="form-label">@localizer["PostCityConcateAr"]</label>
                                                                <input type="text" id="Region-city-driver" class="form-control  inputs-style" asp-for="Contract.DriverInfo.CityText" maxlength="100">
                                                                <input type="hidden" id="Region-city-driver-code" asp-for="Contract.DriverInfo.CrMasRenterInformationCity">
                                                                <div id="autocomplete-Cities2" class="autocomplete-items autocomplete-Cities"></div>
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" id="Region-city-driver-error" asp-validation-for="Contract.DriverInfo.CityText"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <label for="AR-adress-driver" class="form-label">
                                                                    @localizer["ArAddress"]
                                                                </label>
                                                                <input type="text" id="AR-adress-driver" asp-for="Contract.DriverInfo.CrMasRenterInformationArAddress" class="form-control text-end inputs-style" maxlength="200">
                                                                <div class="row requird-field-row">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label for="EN-adress-driver" class="form-label">
                                                                    @localizer["EnAddress"]
                                                                </label>
                                                                <input type="text" id="EN-adress-driver" asp-for="Contract.DriverInfo.CrMasRenterInformationEnAddress" class="form-control inputs-style text-start" maxlength="200">
                                                                <div class="row requird-field-row">
                                                                </div>
                                                            </div>


                                                        </div>
                                                    </div>
                                                    <div class="col-lg-10  inner-hidden-row-div">
                                                        <div class="row" id="divLicence">
                                                            <div class="col-lg-4">
                                                                <label for="licence-driver-number" class="form-label"> @localizer["RenterDriverLicenseNO"]</label>
                                                                <input type="text" id="licence-driver-number" asp-for="Contract.DriverInfo.CrMasRenterInformationDrivingLicenseNo" class="form-control inputs-style" maxlength="50">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.DriverInfo.CrMasRenterInformationDrivingLicenseNo"></span>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-4 requird-inputs-col">
                                                                <label for="licence-driver-type" class="form-label"> @localizer["RenterDriverLicenseType"] </label>
                                                                @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                                {
                                                                    <select class="form-select select-style AR-select" id="licence-driver-type" asp-for="Contract.DriverInfo.CrMasRenterInformationDrivingLicenseType">
                                                                        @foreach (var type in Model.DrivingLicense)
                                                                        {
                                                                            <option value="@type.CrMasSupRenterDrivingLicenseCode"
                                                                                    data-en="@type.CrMasSupRenterDrivingLicenseEnName"
                                                                                    data-ar="@type.CrMasSupRenterDrivingLicenseArName">
                                                                                @type.CrMasSupRenterDrivingLicenseEnName
                                                                            </option>
                                                                        }
                                                                    </select>
                                                                }
                                                                else
                                                                {
                                                                    <select class="form-select select-style AR-select text-right" id="licence-driver-type" asp-for="Contract.DriverInfo.CrMasRenterInformationDrivingLicenseType">
                                                                        @foreach (var type in Model.DrivingLicense)
                                                                        {
                                                                            <option value="@type.CrMasSupRenterDrivingLicenseCode"
                                                                                    data-en="@type.CrMasSupRenterDrivingLicenseEnName"
                                                                                    data-ar="@type.CrMasSupRenterDrivingLicenseArName">
                                                                                @type.CrMasSupRenterDrivingLicenseArName
                                                                            </option>
                                                                        }
                                                                    </select>
                                                                }
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.DriverInfo.CrMasRenterInformationDrivingLicenseType"></span>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-4">
                                                                <label for="ExpiryDrivingLicenseDate-driver" class="form-label">
                                                                    @localizer["Expirationdate"]
                                                                </label>
                                                                <input type="date" id="ExpiryDrivingLicenseDate-driver" class="form-control inputs-style" asp-for="Contract.DriverInfo.CrMasRenterInformationExpiryDrivingLicenseDate" placeholder="yyyy/mm/dd">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.DriverInfo.CrMasRenterInformationExpiryDrivingLicenseDate"></span>
                                                                </div>
                                                                <div class="row requird-field-row">
                                                                </div>
                                                            </div>


                                                        </div>
                                                        <div class="row align-items-center g-3 licence-row-mobile">
                                                            <div class="col-lg-4 mt-2 requird-inputs-col">
                                                                <label for="Email-driver" class="form-label">
                                                                    @localizer["Email"]
                                                                </label>
                                                                <input type="text" id="Email-driver" asp-for="Contract.DriverInfo.CrMasRenterInformationEmail" maxlength="100" class="form-control inputs-style email-input">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.DriverInfo.CrMasRenterInformationEmail"></span>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-4">
                                                                <div class="form-check form-check2" id="additionalDriverDiv">
                                                                    <input class="addational-driver-input form-check-input" type="checkbox" name='addtional-driver-add' id="addational-driver">
                                                                    <label class="form-check-label" for="addational-driver"> @localizer["AdditionalDriverr"]</label>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-4 ">
                                                                <button type="button" class="btn check-btn payment-button " id="UploadDriverLicensePhoto" onclick="setupIDPhotoUpload('UploadDriverLicensePhoto','LicenseImage-driver')">
                                                                    <div class="row align-items-center">
                                                                        <div class="col">
                                                                            @localizer["DrivingPhoto"]
                                                                        </div>
                                                                        <div class="col-auto">
                                                                            <div class="systems-check">
                                                                                <i class="fa-solid fa-check text-white"></i>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </button>
                                                            </div>
                                                            <input hidden asp-for="Contract.DriverInfo.CrMasRenterInformationRenterLicenseImage" id="LicenseImage-driver" />
                                                        </div>
                                                        <div class="row my-3">
                                                            <div class="col-lg-12">
                                                                <label>@localizer["reasons"]</label>
                                                            </div>
                                                            <div class="col-lg-7 ">
                                                                <textarea class=" form-control textarea-inputs reasons" rows="1" maxlength="100" id="Reasons-driver" asp-for="Contract.DriverInfo.CrMasRenterInformationReasons" type="text"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row button-row">
                                        <div class="button-card">
                                            <img src="~/BranchSys/CreateContract/Group.png" alt="Button Image"
                                                 class="next action-button"
                                                 style="vertical-align: middle; ">
                                            <input type="button" name="next" class="next action-button" value="@localizer["Next"]" />
                                        </div>
                                        <div class="button-card">
                                            <input type="button" name="previous" class="previous action-button-previous" value="@localizer["Previous"]" />
                                            <img src="~/BranchSys/CreateContract/Vector.png" alt="Button Image" class="previous action-button-previous" style="vertical-align: middle; ">
                                        </div>
                                    </div>
                                </fieldset>
                                <!--AddDriver-->
                                <fieldset>
                                    <div class="form-card form-card1 h-100">
                                        <div class="row flex-row-reverse g-3 ">
                                            <div class="col-lg-9">
                                                <div class="row flex-row-reverse gap-2 g-2 align-items-center">
                                                    <div class="col-md-4 requird-inputs-col">
                                                        <label for="Contract_AddDriverInfo_CrMasRenterInformationId" class="form-label">@localizer["RenterId"]</label>
                                                        <input type="text" class="form-control inputs-style" asp-for="Contract.AddDriverInfo.CrMasRenterInformationId" maxlength="20">
                                                        <div class="row requird-field-row">
                                                            <span class="requird-field" id="requird-field_AddDriverID" asp-validation-for="Contract.AddDriverInfo.CrMasRenterInformationId"></span>
                                                        </div>
                                                    </div>
                                                    <div class="col-auto seacrh-icon-col" id="seacrh_icon_AddDriver" style="display:none">
                                                        <img src="~/BranchSys/CreateContract/img/seacrh-icon.png" alt="seacrh-icon Image" id="add-driver-details">
                                                        <div class="dropdown-content" id="dropdown_content_AddDriver">
                                                            <div class="row dropdown-content-row pt-2">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["FirstVisit"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="FirstVisitAddDriver"></p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["LastContract"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="LastContractAddDriver"></p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["ActiveContractsCount"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="ActiveContractsCountAddDriver">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["ClosedContractsCount"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="ClosedContractsCountAddDriver">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["RentalDays"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="RentalDaysAddDriver">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["KilometersCut"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="KMCutAddDriver">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["AmountsTraded"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="AmountsTradedAddDriver">0.00</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["Balance"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="BalanceAddDriver">0.00</p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["AvailableBalance"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="AvailableBalanceAddDriver">0.00</p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["ReservedBalance"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="ReservedBalanceAddDriver">0.00</p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p> @localizer["Evaluation"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="DealingMechanismAddDriver"></p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-7 ">
                                                                    <p>@localizer["Membership"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="MembershipAddDriver"></p>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 requird-inputs-col">
                                                        <label for="nationality-type-AddDriver" class="form-label"> @localizer["UserIdType"]</label>
                                                        @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                        {
                                                            <select class="form-select select-style AR-select" id="nationality-type-addDriver" asp-for="Contract.AddDriverInfo.CrMasRenterInformationIdtype">
                                                                <option selected></option>
                                                                @foreach (var type in Model.RenterIdtypes)
                                                                {
                                                                    <option value="@type.CrMasSupRenterIdtypeCode">@type.CrMasSupRenterIdtypeEnName</option>
                                                                }
                                                            </select>
                                                        }
                                                        else
                                                        {
                                                            <select class="form-select select-style AR-select text-right" id="nationality-type-addDriver" asp-for="Contract.AddDriverInfo.CrMasRenterInformationIdtype">
                                                                <option selected></option>
                                                                @foreach (var type in Model.RenterIdtypes)
                                                                {
                                                                    <option value="@type.CrMasSupRenterIdtypeCode">@type.CrMasSupRenterIdtypeArName</option>
                                                                }
                                                            </select>
                                                        }
                                                        <div class="row requird-field-row">
                                                            <span class="requird-field" id="requird-field_AddDriverIDType" asp-validation-for="Contract.AddDriverInfo.CrMasRenterInformationIdtype"></span>
                                                        </div>
                                                    </div>
                                                    <div class="col-auto">
                                                        <button type="button" class="btn check-btn payment-button " id="AddDriverIdBtn" onclick="setupIDPhotoUpload('AddDriverIdBtn','AddDriverIdImg')">
                                                            <div class="row align-items-center">
                                                                <div class="col-auto">
                                                                    <div class="systems-check">
                                                                        <i class="fa-solid fa-check text-white"></i>
                                                                    </div>
                                                                </div>
                                                                <div class="col">
                                                                    @localizer["RenterIdPhoto"]
                                                                </div>
                                                            </div>
                                                        </button>
                                                        <input hidden asp-for="Contract.AddDriverInfo.CrMasRenterInformationRenterIdImage" id="AddDriverIdImg" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="row align-items-center g-4 flex-row-reverse">
                                                    <div class="col-md-6 requird-inputs-col">
                                                        <label for="birth-date-AddDriver" class="form-label">
                                                            @localizer["Birthdate"]
                                                        </label>
                                                        <input type="date" id="birth-date-AddDriver" class="form-control inputs-style" min="1950-01-01" max="" asp-for="Contract.AddDriverInfo.CrMasRenterInformationBirthDate">
                                                        <div class="row requird-field-row">
                                                            <span class="requird-field" id="requird-field_AddDriverBirthDate" asp-validation-for="Contract.AddDriverInfo.CrMasRenterInformationBirthDate"></span>
                                                            <span class="requird-field" id="addDriver-birth-date-error"></span> <!-- Error message display -->
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <button type="button" class="btn check-btn check-btn-version2 px-5 Driver-checkModal-open-button" id="CheckAddDriver">
                                                            @localizer["Verification"]
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <hr class="version2-hr">
                                        <div class="row hidden-input-row hidden-input-row-addDriver ms-2" style="display:none;">
                                            <input type="hidden" asp-for="Contract.AddDriverInfo.CrMasRenterInformationCountreyKey" />
                                            <input type="hidden" asp-for="Contract.AddDriverInfo.CrMasRenterInformationMobile" />
                                            <div class="col-lg-12">
                                                <div class="row justify-content-end">
                                                    <div class="col-lg-7  inner-hidden-row-div">
                                                        <div class="row">
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="AR-name-addDriver" class="form-label">
                                                                    @localizer["NameArabic"]
                                                                </label>
                                                                <input type="text" id="AR-name-addDriver" class="form-control text-end inputs-style" asp-for="Contract.AddDriverInfo.CrMasRenterInformationArName" maxlength="100" oninput="this.value=this.value.replace(/[^\u0600-\u06FF\ufb50-\ufdff\ufe70-\ufeff\s]/g, '')">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.AddDriverInfo.CrMasRenterInformationArName"></span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="EN-name-addDriver" class="form-label">
                                                                    @localizer["NameEnglish"]
                                                                </label>
                                                                <input type="text" id="EN-name-addDriver" class="form-control inputs-style text-start" asp-for="Contract.AddDriverInfo.CrMasRenterInformationEnName" maxlength="100" oninput="this.value = this.value.replace(/[^a-zA-Z ]/g, '')">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.AddDriverInfo.CrMasRenterInformationEnName"></span>
                                                                </div>
                                                            </div>

                                                        </div>

                                                        <div class="row ">
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="nationality-addDriver" class="form-label">@localizer["RenterDriverNationality"]</label>
                                                                <input type="text" id="nationality-addDriver" class="form-control inputs-style" maxlength="100" asp-for="Contract.AddDriverInfo.NationalityText">
                                                                <input type="hidden" id="nationality-addDriver-code" asp-for="Contract.AddDriverInfo.CrMasRenterInformationNationality">
                                                                <div id="autocomplete-Nationalities3" class="autocomplete-items"></div>
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" id="nationality-addDriver-error" asp-validation-for="Contract.AddDriverInfo.NationalityText"></span>
                                                                </div>
                                                            </div>

                                                            <div class="col-md-6 " id="divGenderAddDriver">
                                                                <label class="form-label">
                                                                    @localizer["Gender"]

                                                                </label>
                                                                <div class="d-flex">
                                                                    @foreach (var gender in Model.RenterGender)
                                                                    {
                                                                        <div class="form-check">
                                                                            <input class="form-check-input genderAddDriver"
                                                                                   type="radio"
                                                                                   id="genderAddDriver-@gender.CrMasSupRenterGenderCode"
                                                                                   asp-for="Contract.AddDriverInfo.CrMasRenterInformationGender"
                                                                                   value="@gender.CrMasSupRenterGenderCode"
                                                                                   data-en="@gender.CrMasSupRenterGenderEnName"
                                                                                   data-ar="@gender.CrMasSupRenterGenderArName">

                                                                            <label class="form-check-label" for="genderRenter-@gender.CrMasSupRenterGenderCode">
                                                                                @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                                                {
                                                                                    @gender.CrMasSupRenterGenderEnName
                                                                                }
                                                                                else
                                                                                {
                                                                                    @gender.CrMasSupRenterGenderArName
                                                                                }
                                                                            </label>
                                                                        </div>
                                                                    }
                                                                    <div class="row requird-field-row">
                                                                    </div>
                                                                </div>

                                                            </div>

                                                        </div>
                                                        <div class="row align-items-center">

                                                            <div class="col-md-6">
                                                                <label for="Profession-addDriver" class="form-label"> @localizer["RenterProfessionName"]</label>
                                                                @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                                {
                                                                    <select class="form-select select-style AR-select" id="Profession-addDriver" asp-for="Contract.AddDriverInfo.CrMasRenterInformationProfession">
                                                                        <option selected></option>
                                                                        @foreach (var type in Model.RenterProfession)
                                                                        {
                                                                            <option value="@type.CrMasSupRenterProfessionsCode">@type.CrMasSupRenterProfessionsEnName</option>
                                                                        }
                                                                    </select>

                                                                }
                                                                else
                                                                {
                                                                    <select class="form-select select-style AR-select text-right" id="Profession-addDriver" asp-for="Contract.AddDriverInfo.CrMasRenterInformationProfession">
                                                                        <option selected></option>
                                                                        @foreach (var type in Model.RenterProfession)
                                                                        {
                                                                            <option value="@type.CrMasSupRenterProfessionsCode">@type.CrMasSupRenterProfessionsArName</option>
                                                                        }
                                                                    </select>
                                                                }
                                                                <div class="row requird-field-row">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label for="addDriver-workplace" class="form-label">@localizer["RenterEmployerName"]</label>
                                                                <input type="text" id="addDriver-workplace" class="form-control inputs-style" maxlength="100">
                                                                <input type="hidden" id="addDriver-workplace-code" asp-for="Contract.AddDriverInfo.CrMasRenterInformationEmployer">
                                                                <div id="autocomplete-workplace3" class="autocomplete-items"></div>
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" id="addDriver-workplace-error"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6 requird-inputs-col">
                                                                <label for="Region-city-addDriver" class="form-label">@localizer["PostCityConcateAr"]</label>
                                                                <input type="text" id="Region-city-addDriver" class="form-control  inputs-style" asp-for="Contract.AddDriverInfo.CityText" maxlength="100">
                                                                <input type="hidden" id="Region-city-addDriver-code" asp-for="Contract.AddDriverInfo.CrMasRenterInformationCity">
                                                                <div id="autocomplete-Cities3" class="autocomplete-items autocomplete-Cities"></div>
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" id="Region-city-addDriver-error" asp-validation-for="Contract.AddDriverInfo.CityText"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <label for="AR-adress-driver" class="form-label">
                                                                    @localizer["ArAddress"]
                                                                </label>
                                                                <input type="text" id="AR-adress-addDriver" asp-for="Contract.AddDriverInfo.CrMasRenterInformationArAddress" class="form-control text-end inputs-style" maxlength="200">
                                                                <div class="row requird-field-row">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label for="EN-adress-driver" class="form-label">
                                                                    @localizer["EnAddress"]
                                                                </label>
                                                                <input type="text" id="EN-adress-addDriver" asp-for="Contract.AddDriverInfo.CrMasRenterInformationEnAddress" class="form-control inputs-style text-start" maxlength="200">
                                                                <div class="row requird-field-row">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-10  inner-hidden-row-div">
                                                        <div class="row" id="divLicenceAddDriver">
                                                            <div class="col-lg-4">
                                                                <label for="licence-addDriver-number" class="form-label"> @localizer["RenterDriverLicenseNO"]</label>
                                                                <input type="text" id="licence-addDriver-number" asp-for="Contract.AddDriverInfo.CrMasRenterInformationDrivingLicenseNo" class="form-control inputs-style" maxlength="50">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.AddDriverInfo.CrMasRenterInformationDrivingLicenseNo"></span>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-4 requird-inputs-col">
                                                                <label for="licence-addDriver-type" class="form-label"> @localizer["RenterDriverLicenseType"] </label>
                                                                @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                                {
                                                                    <select class="form-select select-style AR-select" id="licence-addDriver-type" asp-for="Contract.AddDriverInfo.CrMasRenterInformationDrivingLicenseType">
                                                                        <option selected></option>
                                                                        @foreach (var type in Model.DrivingLicense)
                                                                        {
                                                                            <option value="@type.CrMasSupRenterDrivingLicenseCode"
                                                                                    data-en="@type.CrMasSupRenterDrivingLicenseEnName"
                                                                                    data-ar="@type.CrMasSupRenterDrivingLicenseArName">
                                                                                @type.CrMasSupRenterDrivingLicenseEnName
                                                                            </option>
                                                                        }
                                                                    </select>
                                                                }
                                                                else
                                                                {
                                                                    <select class="form-select select-style AR-select text-right" id="licence-addDriver-type" asp-for="Contract.AddDriverInfo.CrMasRenterInformationDrivingLicenseType">
                                                                        <option selected></option>
                                                                        @foreach (var type in Model.DrivingLicense)
                                                                        {
                                                                            <option value="@type.CrMasSupRenterDrivingLicenseCode"
                                                                                    data-en="@type.CrMasSupRenterDrivingLicenseEnName"
                                                                                    data-ar="@type.CrMasSupRenterDrivingLicenseArName">
                                                                                @type.CrMasSupRenterDrivingLicenseArName
                                                                            </option>
                                                                        }
                                                                    </select>
                                                                }
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.AddDriverInfo.CrMasRenterInformationDrivingLicenseType"></span>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-4">
                                                                <label for="ExpiryDrivingLicenseDate-driver" class="form-label">
                                                                    @localizer["Expirationdate"]
                                                                </label>
                                                                <input type="date" id="ExpiryDrivingLicenseDate-addDriver" class="form-control inputs-style" asp-for="Contract.AddDriverInfo.CrMasRenterInformationExpiryDrivingLicenseDate" placeholder="yyyy/mm/dd">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.AddDriverInfo.CrMasRenterInformationExpiryDrivingLicenseDate"></span>
                                                                </div>
                                                                <div class="row requird-field-row">
                                                                </div>
                                                            </div>


                                                        </div>
                                                        <div class="row align-items-center g-3 licence-row-mobile">
                                                            <div class="col-lg-4 mt-2 requird-inputs-col">
                                                                <label for="Email-driver" class="form-label">
                                                                    @localizer["Email"]
                                                                </label>
                                                                <input type="text" id="Email-addDriver" asp-for="Contract.AddDriverInfo.CrMasRenterInformationEmail" maxlength="100" class="form-control inputs-style email-input">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" asp-validation-for="Contract.AddDriverInfo.CrMasRenterInformationEmail"></span>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-4 ">
                                                                <button type="button" class="btn check-btn payment-button " id="UploadAddDriverLicensePhoto" onclick="setupIDPhotoUpload('UploadAddDriverLicensePhoto','LicenseImage-addDriver')">
                                                                    <div class="row align-items-center">
                                                                        <div class="col">
                                                                            @localizer["DrivingPhoto"]
                                                                        </div>
                                                                        <div class="col-auto">
                                                                            <div class="systems-check">
                                                                                <i class="fa-solid fa-check text-white"></i>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </button>
                                                            </div>
                                                            <input hidden asp-for="Contract.AddDriverInfo.CrMasRenterInformationRenterLicenseImage" id="LicenseImage-addDriver" />
                                                        </div>
                                                        <div class="row my-3">
                                                            <div class="col-lg-12">
                                                                <label>@localizer["reasons"]</label>
                                                            </div>
                                                            <div class="col-lg-7 ">
                                                                <textarea class=" form-control textarea-inputs reasons" rows="1" maxlength="100" id="Reasons-addDriver" asp-for="Contract.AddDriverInfo.CrMasRenterInformationReasons" type="text"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="row button-row">
                                        <div class="button-card">
                                            <img src="~/BranchSys/CreateContract/Group.png" alt="Button Image"
                                                 class="next action-button"
                                                 style="vertical-align: middle; ">
                                            <input type="button" name="next" class="next action-button"
                                                   value="@localizer["Next"]" />
                                        </div>
                                        <div class="button-card">
                                            <input type="button" name="previous"
                                                   class="previous action-button-previous"
                                                   value="@localizer["Previous"]" />
                                            <img src="~/BranchSys/CreateContract/Vector.png" alt="Button Image"
                                                 class="previous action-button-previous"
                                                 style="vertical-align: middle; ">
                                        </div>
                                    </div>
                                </fieldset>
                                <!--Choices and Additional-->
                                <fieldset>
                                    <div class="form-card">
                                        <div class="row  table-field-row g-4 justify-content-center">
                                            <!--Car Options-->
                                            <div class="col-lg-4">
                                                <div class="table-scroll">
                                                    <table class="table table-bordered  table-hover " id="AdditionalList">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col" class="value-tabel-header">@localizer["TheValue"]</th>
                                                                <th scope="col" style='border-left: 1px solid #ff9626a3;'>@localizer["Additionals"]</th>
                                                            </tr>
                                                        </thead>

                                                        <tbody id="additionalBody">
                                                            <input hidden id="AdditionalsList" name="AdditionalsList" />
                                                            <input hidden asp-for="Contract.AdditionalTotal" />
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="table-scroll">
                                                    <table class="table table-bordered  table-hover" id="OptionsList">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col"
                                                                    class="value-tabel-header">
                                                                    @localizer["TheValue"]
                                                                </th>
                                                                <th scope="col"
                                                                    style='border-left: 1px solid #ff9626a3; '>
                                                                    @localizer["Choices"]
                                                                </th>

                                                            </tr>
                                                        </thead>
                                                        <tbody id="optionsBody">
                                                            <input hidden id="ChoicesList" name="ChoicesList" />
                                                            <input hidden asp-for="Contract.OptionTotal" />
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row button-row">
                                        <div class="button-card">
                                            <img src="~/BranchSys/CreateContract/Group.png" alt="Button Image"
                                                 class="next action-button"
                                                 style="vertical-align: middle; margin-right: 10px;">
                                            <input type="button" name="next" class="next action-button"
                                                   value="@localizer["Next"]" />
                                        </div>
                                        <div class="button-card">
                                            <input type="button" name="previous"
                                                   class="previous action-button-previous"
                                                   value="@localizer["Previous"]" />
                                            <img src="~/BranchSys/CreateContract/Vector.png" alt="Button Image"
                                                 class="previous action-button-previous"
                                                 style="vertical-align: middle; margin-right: 10px;">
                                        </div>
                                    </div>
                                </fieldset>
                                <!--CheckUP-->
                                <fieldset>
                                    <div class="form-card">
                                        <div class="row g-3">
                                            <div class="col-xl-6">
                                                <div class="row flex-row-reverse g-2 mb-2  justify-content-between">
                                                    <div class="col-md-6">
                                                        <div class="row CurrentReadingg_row"
                                                             style="flex-direction: row-reverse;align-items: baseline;">
                                                            <div class="col-auto">
                                                                <label id="CurrentReadingg" for="CurrentReadingg-input">
                                                                    @localizer["CurrentMeter"]
                                                                </label>
                                                            </div>
                                                            <div class="col-6">
                                                                <input type="tel" class="form-control inputs-style" style="width: 100%;" asp-for="Contract.CurrentMeter" autocomplete="off">
                                                                <div class="row requird-field-row">
                                                                    <span class="requird-field" id="requird_field_CurrentMeter"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <button type="button" class="btn check-btn d-flex align-items-center gap-2" data-bs-toggle="modal" href="#TechnicalCheckUp">
                                                            <img src="~/BranchSys/CreateContract/img/icon (2).svg">
                                                            @localizer["TechnicalInspection"]
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="upload__box d-flex">
                                                        <div class="upload_img-wrap_inner" style="display: flex; flex-wrap: wrap; gap: 10px ">
                                                            <div class="upload__img-box" id="upload-img1">
                                                            </div>
                                                            <div class="upload__btn-box" id="upload__btn-box">
                                                                <label class="upload__btn" id="upload__btn">
                                                                    <div class="upload-container-checking">
                                                                        <img class="upload-icon" src="~/BranchSys/CreateContract/Group (1).png" alt="Upload Icon">
                                                                        <input type="file" multiple accept="image/*" data-max_length="12" id="checking-img" class="upload__inputfile " onclick="HideFirstImg()">
                                                                    </div>
                                                                </label>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <p style="color: red;" id="checkUpMessageRequired">

                                                    </p>
                                                </div>

                                            </div>

                                            <div class="col-xl-6">
                                                <div id="referenceDiv">

                                                    <div id="tableContainer" class="table-scroll">
                                                        <table class="table table-bordered  table-hover Checkup-table ">
                                                            <thead>
                                                                <tr>
                                                                    <th scope="col" class="value-tabel-header">
                                                                        @localizer["reasons"]
                                                                    </th>
                                                                    <th scope="col">
                                                                        @localizer["TheCheck"]
                                                                    </th>
                                                                    <th scope="col">
                                                                        <div class="d-flex justify-content-center gap-3">
                                                                            <div class="col">
                                                                                @localizer["CheckUpNames"]
                                                                            </div>
                                                                            <div class="col-auto p-0">
                                                                                <input type="checkbox" id="CheckAll" />
                                                                            </div>
                                                                        </div>
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="CheckBody">
                                                                <partial name="_CheckUpList" />
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="row button-row"
                                         style=" justify-content: space-between;">
                                        <div class="button-card">
                                            <img src="~/BranchSys/CreateContract/Group.png" alt="Button Image"
                                                 class="next action-button"
                                                 style="vertical-align: middle; margin-right: 10px;">
                                            <input type="button" name="next" class="next action-button"
                                                   value="@localizer["Next"]" />
                                        </div>
                                        <div class="button-card">
                                            <input type="button" name="previous"
                                                   class="previous action-button-previous"
                                                   value="@localizer["Previous"]" />
                                            <img src="~/BranchSys/CreateContract/Vector.png" alt="Button Image"
                                                 class="previous action-button-previous"
                                                 style="vertical-align: middle; margin-right: 10px;">
                                        </div>
                                    </div>

                                </fieldset>
                                <!--Payment-->
                                <fieldset>
                                    <div class="form-card form-card7">
                                        <div class="row flex-row-reverse">
                                            <div class="col-md-6 col-lg-4 d-flex payment-col">
                                                <div class="col-auto">
                                                    <p id="contract-number">@localizer["ContractNo"]</p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <input name="ContractNo" id="ContractNo" value="@ViewBag.ContractNo" hidden />
                                                    <p>@ViewBag.ContractNo</p>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-4 d-flex  payment-col">
                                                <div class="col-auto">
                                                    <p id="start-date">@localizer["StartDate"]</p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <p id="StartDate">@ViewBag.StartDate</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row flex-row-reverse">
                                            <div class="col-md-6 col-lg-4 d-flex payment-col align-items-center">
                                                <div class="col-auto">
                                                    <label id="days-number" for="days-number-input">
                                                        @localizer["DaysNo"]
                                                    </label>
                                                </div>
                                                <div class="col-auto DaysNoFixPaddin">
                                                    <input type="text" class="form-control1 form-control" asp-for="Contract.DaysNo" id="dayNo" oninput="this.value=this.value.replace(/[^0-9]/g,'');if(parseInt(this.value)> 365) this.value = '365';" onfocusout="CalculateContract()" maxlength="3" autocomplete="off" autofocus required>                                                <div class="row requird-field-row-last">
                                                        <div class="row requird-field-row-last">
                                                            <span class="requird-field" id="requird_field_DaysNo" asp-validation-for="@Model.Contract.DaysNo"></span>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-4 d-flex  payment-col">
                                                <div class="col-auto">
                                                    <p id="end-date">@localizer["EndDate"]</p>

                                                </div>
                                                <div class="col-auto personal-data">
                                                    <p id="EndDate"> </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row flex-row-reverse g-2">
                                            <div class="col-md-6 col-lg-4 d-flex payment-col  flex-wrap ">
                                                <div class="col-12 col-md-auto d-flex gap-3 flex-wrap contract-value ">
                                                    <p class="personal-data" id="contractValue">0.00</p>
                                                    <p id="renting-price"> @localizer["ContractValue"]</p>
                                                    <input hidden asp-for="Contract.ContractValueBeforeDiscount" />
                                                </div>
                                                <div class="col-auto">
                                                    <img src="~/BranchSys/CreateContract/img/seacrh-icon.png" alt="icon button to display more data" id="payment-extra-details">
                                                    <div class="dropdown-content payment-dropdown-content" id="dropdown-content-payment">
                                                        <div class="data-container">
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-auto ">
                                                                    <p>@localizer["RentalValue"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="RentValue">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-auto ">
                                                                    <p>@localizer["AdvantagesValue"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="AdvatagesValue">0</p>
                                                                    <input hidden asp-for="Contract.AdvantagesTotalValue" />
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-auto ">
                                                                    <p>@localizer["ChoicesValue"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="ChoicesValue">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-auto ">
                                                                    <p>@localizer["AdditionalValue"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="AdditionalValue">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-auto ">
                                                                    <p>@localizer["AddDriverValue"] </p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="AddDriverValue">0</p>
                                                                </div>

                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-auto ">
                                                                    <p>@localizer["PrivateDriverValue"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="PrivateDriverValue">0</p>
                                                                </div>
                                                            </div>
                                                            <div class="row dropdown-content-row">
                                                                <div class="col-auto ">
                                                                    <p>@localizer["DelegationValue"]</p>
                                                                </div>
                                                                <div class="col personal-data-dropdown">
                                                                    <p id="InFeesTammValue">0</p>
                                                                    <input hidden asp-for="Contract.FeesTmmValue" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="col-md-6 col-lg-4 d-flex  payment-col ">
                                                <div class="col-auto personal-data">
                                                    <input class="Delegate-out-input" type="checkbox" name="Contract_OutFeesTmm" id="Delegate-out" value="checked">
                                                    <input hidden asp-for="Contract.OutFeesTmm" />
                                                </div>
                                                <div class="col-auto">
                                                    <label class="Delegate-out-label" for="Delegate-out" name="Delegate-out">
                                                        @localizer["ExternalDelegation"]
                                                    </label>
                                                </div>

                                            </div>
                                            <div class="col-md-6 col-lg-4 d-flex  payment-col" id="ReceivingBranch" style="display:none">
                                                <div class="col-auto">
                                                    <p id="Receiving-branch"> فرع التسليم </p>

                                                </div>
                                                <div class="col-md-7 personal-data">
                                                    <div class="offset">
                                                        <select class="form-select-last form-select" id="Receiving-branch-dropdown" asp-for="Contract.BranchReceivingCode">
                                                            <option selected disabled>
                                                            </option>
                                                            @foreach (var item in Model.CrCasBranchInformations.Where(x => x.CrCasBranchInformationCode != Model.SelectedBranch))
                                                            {
                                                                <option value="@item.CrCasBranchInformationCode"
                                                                        data-en="@item.CrCasBranchInformationEnShortName"
                                                                        data-ar="@item.CrCasBranchInformationArShortName">
                                                                    @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
                                                                    {
                                                                        @item.CrCasBranchInformationEnShortName
                                                                    }
                                                                    else
                                                                    {
                                                                        @item.CrCasBranchInformationArShortName
                                                                    }
                                                                </option>
                                                            }
                                                        </select>
                                                        <div class="row requird-field-row-last">
                                                            <span class="requird-field" asp-validation-for="@Model.Contract.BranchReceivingCode"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row flex-row-reverse align-items-baseline g-2 my-2">
                                            <div class="col-md-6 col-lg-4 d-flex payment-col align-items-center">
                                                <div class="col-auto">
                                                    <label id="discount-percentage" for="discount-percentage-input">@localizer["DiscountRate"]</label>
                                                </div>
                                                <div class="col-auto">
                                                    <input type="text" class="form-control1 form-control" asp-for="Contract.UserDiscount" id="Discount_Input" oninput="handleDiscountInput(this)" onfocusout="CalculateDiscount()" min="0" max="100" value="0" maxlength="5" autocomplete="off">
                                                    <input hidden asp-for="Contract.DiscountValue" />
                                                    <div class="row requird-field-row-last">
                                                        <p class="requird_field_Discount"></p>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="col-md-6 col-lg-4 d-flex  payment-col align-items-center">
                                                <div class="col-auto">
                                                    <label id="addational-hours" for="AdditionalHours"> @localizer["AdditionalHours"] </label>
                                                </div>
                                                <div class="col-auto">
                                                    <input type="tel" class="form-control1 form-control" asp-for="Contract.UserAddHours" id="AdditionalHours" maxlength="2" oninput="handleAdditionalHoursInput(this)" min="0" max="99" value="0" autocomplete="off">
                                                    <div class="row requird-field-row-last">
                                                        <p class="requird-field"></p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-4 d-flex  payment-col align-items-center">
                                                <div class="col-auto">
                                                    <label id="addational-kilos"
                                                           for="AdditionalKilos">
                                                        @localizer["AdditionalKm"]
                                                    </label>
                                                </div>
                                                <div class="col-auto">
                                                    <input type="tel" class="form-control1 form-control" asp-for="Contract.UserAddKm" id="AdditionalKilos" maxlength="3" oninput="handleAdditionalKilosInput(this)" min="0" max="999" value="0" autocomplete="off">
                                                    <div class="row requird-field-row-last">
                                                        <p class="requird-field"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row flex-row-reverse">
                                            <div class="col-md-6 col-lg-4 d-flex payment-col">
                                                <div class="col-auto">
                                                    <p id="Total contract">@localizer["TotalContract"]</p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <p id="totalContract">0.00</p>
                                                    <input hidden asp-for="Contract.ContractValueAfterDiscount" />
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-4 d-flex payment-col">
                                                <div class="col-auto">
                                                    <p id="Tax-value"> @localizer["TaxValue"]</p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <p id="Taxvalue">0.00</p>
                                                    <input hidden asp-for="Contract.TaxValue" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row flex-row-reverse">
                                            <div class="col-md-6 col-lg-4 d-flex payment-col">
                                                <div class="col-auto">
                                                    <p id="Total_Contract"> @localizer["NetContract"]</p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <p id="TotalActualContract">0</p>
                                                    <input hidden asp-for="Contract.TotalContractAmount" />
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-4 d-flex payment-col">
                                                <div class="col-auto">
                                                    <p id="previous-balance"> @localizer["PreviousBalance"]</p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <p id="Balance">0.00</p>

                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-4 d-flex payment-col">
                                                <div class="col-auto">
                                                    <p id="price"> @localizer["AmountRequired"]</p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <p id="TotalAmount">0.00</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row flex-row-reverse g-2">
                                            <div class="col-md-6 col-lg-4 d-flex payment-col">
                                                <div class="col-auto">
                                                    <label id="amount-paid" for="AmountPayed">@localizer["AmountPaid"]</label>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <input type="text" class="form-control2 form-control" asp-for="Contract.AmountPayed" style="width: 110px!important" id="AmountPayed" oninput="handleAmountPayed(this)" autocomplete="off" readonly>
                                                    <div class="row requird-field-row-last">
                                                        <p class="requird_field_AmountPayed"></p>
                                                    </div>
                                                </div>
                                            </div>
                                            @{
                                                if (Model?.AccountBanks?.FindAll(x => x.CrCasAccountBankNo != "00").Count() == 0)
                                                {
                                                    Model.PaymentMethods = Model?.PaymentMethods?.FindAll(x => x.CrMasSupAccountPaymentMethodClassification == "1");
                                                }
                                                else if (Model?.AccountBanks?.FindAll(x => x.CrCasAccountBankNo != "00").Count() > 0 && Model?.SalesPoint?.FindAll(x => x.CrCasAccountSalesPointBank != "00").Count() == 0)
                                                {
                                                    Model.PaymentMethods = Model?.PaymentMethods?.FindAll(x => x.CrMasSupAccountPaymentMethodClassification == "3" || x.CrMasSupAccountPaymentMethodClassification == "1");
                                                }
                                                else if (Model?.AccountBanks?.FindAll(x => x.CrCasAccountBankNo != "00").Count() > 0 && Model?.SalesPoint?.FindAll(x => x.CrCasAccountSalesPointBank != "00").Count() > 0)
                                                {
                                                    Model.PaymentMethods = Model?.PaymentMethods?.FindAll(x => x.CrMasSupAccountPaymentMethodClassification == "2" || x.CrMasSupAccountPaymentMethodClassification == "3" || x.CrMasSupAccountPaymentMethodClassification == "1");
                                                }
                                            }
                                            <div class="col-md-6 col-lg-4 d-flex  payment-col">
                                                <div class="col-auto">
                                                    <p id="payment-method">@localizer["PaymentMethod"]</p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <div class="offset">
                                                        <select class="form-select-last form-select" asp-for="Contract.PaymentMethod" style="font-size:14px;" disabled>
                                                            <option selected disabled></option>
                                                            @foreach (var payment in Model.PaymentMethods)
                                                            {
                                                                @if (requestCulture?.RequestCulture.UICulture.Name != "en-US")
                                                                {
                                                                    <option value="@payment.CrMasSupAccountPaymentMethodCode" data-ar="@payment.CrMasSupAccountPaymentMethodArName" data-en="@payment.CrMasSupAccountPaymentMethodEnName" class="text-right">@payment.CrMasSupAccountPaymentMethodArName</option>

                                                                }
                                                                else
                                                                {
                                                                    <option value="@payment.CrMasSupAccountPaymentMethodCode" data-ar="@payment.CrMasSupAccountPaymentMethodArName" data-en="@payment.CrMasSupAccountPaymentMethodEnName">@payment.CrMasSupAccountPaymentMethodEnName</option>
                                                                }
                                                            }
                                                        </select>
                                                    </div>
                                                    <span class="requird-field" id="requird_field_PaymentMethod" asp-validation-for="@Model.Contract.PaymentMethod"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-4 d-flex  payment-col">
                                                <div class="col-auto">
                                                    <p id="selling-point"> @localizer["SalesPoint"] </p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <div class="offset">
                                                        <select class="form-select-last form-select" asp-for="Contract.SalesPoint" style="font-size:14px;width:240px!important" disabled>
                                                        </select>
                                                    </div>
                                                    <span class="requird-field" id="requird_field_SalesPoint" asp-validation-for="@Model.Contract.SalesPoint"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row p-2 row-step1 ">
                                            <div class="col-auto">
                                                <p id="notes">@localizer["reasons"]</p>
                                            </div>
                                            <div class="col-sm-7 col-md-7 col-lg-7">
                                                <input class="form-control text-right textarea-inputs" id="FormControl-last-Textarea" asp-for="Contract.PaymentReasons" rows="1" maxlength="100">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row button-row align-items-center"
                                         style="padding: 6px 7px 0px 20px;">
                                        <div class="payment-button-card button-card  gap-2">
                                            <input id="submitForm" type="button" class=" check-btn payment-button" value="@localizer["Save"]">
                                            <button type="button" class="btn check-btn check-btn-load payment-button signature-button" id="check_btn_load_Signture" data-bs-toggle="modal" href="#PicsignatureModal">
                                                <div class="row align-items-center">
                                                    <div class="col-auto">
                                                        <div class="systems-check">
                                                            <i class="fa-solid fa-check text-white"></i>
                                                        </div>
                                                    </div>
                                                    <div class="col">@localizer["SignatureTenant"]</div>
                                                </div>
                                            </button>
                                            <button type="button" class="btn check-btn check-btn-load payment-button">
                                                <div class="row align-items-center">
                                                    <div class="col-auto">
                                                        <div class="systems-check">
                                                            <i class="fa-solid fa-check text-white"></i>
                                                        </div>
                                                    </div>
                                                    <div class="col">
                                                        @localizer["Unifiedcontract"]
                                                    </div>
                                                </div>
                                            </button>
                                            <button type="button" class="btn check-btn check-btn-load payment-button">
                                                <div class="row align-items-center">
                                                    <div class="col-auto">
                                                        <div class="systems-check">
                                                            <i class="fa-solid fa-check text-white"></i>
                                                        </div>
                                                    </div>
                                                    <div class="col">
                                                        @localizer["Shemos"]
                                                    </div>
                                                </div>
                                            </button>
                                        </div>
                                        <div class="button-card">
                                            <input type="button" name="previous" class="previous action-button-previous" value="@localizer["Previous"]" />
                                            <img src="~/BranchSys/CreateContract/img/vector.png" alt="Button Image" class="previous action-button-previous" style="vertical-align: middle; margin-right: 10px;">
                                        </div>
                                    </div>
                                </fieldset>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- %%%%%%%%%%%%%%%%%%%%%%%Check To Number Whatsup%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
                <div class="modal fade" id="checkModalToggle" aria-hidden="true" aria-labelledby="checkModalToggleLabel" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content">
                            <div class="modal-header text-center version2-modal-header">
                                <p class="modal-title w-100" style="font-size: 20px;">@localizer["MobileVerificationTenant"]</p>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row pt-lg-3  justify-content-center version2-modal-rows">
                                    <div class="col-auto">
                                        <div class="row version2-modal-rows ">
                                            <div class="col-auto version2-titles">
                                                <label for="CheckModal-PhoneInput">@localizer["RenterDriverMobile"]</label>
                                            </div>
                                            <div class="col-auto ">

                                                <select id="country-code" name="country Code" class="country-code-select">
                                                    <option selected></option>
                                                    @foreach (var item in Model.CallingKeys)
                                                    {
                                                        <option value="@item.CrMasSysCallingKeysNo?.Trim()">@item.CrMasSysCallingKeysNo</option>
                                                    }
                                                </select>
                                                <input type="tel" id="CheckModal-PhoneInput" name="phone_Number" class="form-control version2-select" maxlength="11" autocomplete="off" autofocus="true">
                                                <div class="row requird-field-row"><p class="requird-field" id="CheckModal-PhoneInput-Error"></p></div>
                                                <div class="col-12"><p>@localizer["SentToTheEnteredMobile"]</p></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-auto SMS-Whats-Col">
                                        <div class="d-flex gap-2">
                                            <input type="radio" name="SMS-or-WhatsApp" value="SMS" id="SMS">
                                            <label for="SMS">
                                                @localizer["SmsMessage"]
                                            </label>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <input type="radio" name="SMS-or-WhatsApp" value="WhatsApp" id="WhatsApp" checked>
                                            <label for="WhatsApp">
                                                @localizer["Whatsup"]
                                            </label>
                                        </div>

                                    </div>
                                    <div class="col-auto">
                                        <button type="submit" class="btn  check-btn px-4 py-1" id="SendMessageBtn">
                                            @localizer["Send"]
                                        </button>
                                    </div>

                                </div>
                                <form class="otc mt-4" name="one-time-code" id="otc">
                                    <div class="row flex-row-reverse justify-content-center align-items-center otc-row">
                                        <div class="col-md-auto">
                                            <legend>
                                                @localizer["VerificationCode"]
                                            </legend>
                                        </div>
                                        <div class="col-md-auto">
                                            <div>
                                                <input type="number" class="OTP" pattern="[0-9]*" value=""
                                                       inputtype="numeric" autocomplete="one-time-code"
                                                       id="otc-1" name="otc-1">
                                                <!-- Autocomplete not to put on other input -->
                                                <input type="number" class="OTP" pattern="[0-9]*" min="0"
                                                       max="9" maxlength="1" value="" inputtype="numeric"
                                                       id="otc-2" name="otc-2" required>
                                                <input type="number" class="OTP" pattern="[0-9]*" min="0"
                                                       max="9" maxlength="1" value="" inputtype="numeric"
                                                       id="otc-3" name="otc-3" required>
                                                <input type="number" class="OTP" pattern="[0-9]*" min="0"
                                                       max="9" maxlength="1" value="" inputtype="numeric"
                                                       id="otc-4" name="otc-4" required>
                                                <input type="number" class="OTP" pattern="[0-9]*" min="0"
                                                       max="9" maxlength="1" value="" inputtype="numeric"
                                                       id="otc-5" name="otc-5" required>
                                                <input type="number" class="OTP" pattern="[0-9]*" min="0"
                                                       max="9" maxlength="1" value="" inputtype="numeric"
                                                       id="otc-6" name="otc-6" required>
                                            </div>
                                            <p class="modal-title w-100 my-2" style="font-size: .7rem;">
                                                @localizer["CodeExpireAfter"] <span id="timerDiv">05:00</span>
                                            </p>
                                        </div>

                                    </div>
                                    <div class="row requird-field-row">
                                        <p class="requird-field" id="Incorrect-Code-Erorr"></p>
                                    </div>
                                    <div class="row  justify-content-center g-2">
                                        <div class="col-auto">
                                            <button type="button"
                                                    class="btn check-btn ModalButtons resend px-5 py-1"
                                                    id="ResendButton">
                                                @localizer["SendAnotherCode"]
                                            </button>
                                        </div>

                                        <div class="col-auto">
                                            <button type="submit"
                                                    class="btn  check-btn  px-5 py-1 text-center"
                                                    disabled="true" id="confirmButton">
                                                @localizer["Submit"]
                                            </button>
                                        </div>
                                    </div>

                                </form>

                            </div>

                        </div>
                    </div>
                </div>
                <!-- %%%%%%%%%%%%%%%%%%%%%%%Licence Driver Photo%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
                <div class="modal fade" id="IDphoto-modal" tabindex="-1"
                     aria-labelledby="PicignaturPopupModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered d-flex justify-content-center">
                        <div class="modal-content IDphoto-modal-content p-3">
                            <div class="modal-body IDphoto-modal-body">
                                <div class="ID-Card">
                                    <div class="ID-main-container" id="removeIDImg"></div>
                                    <div class="ID-upload-container">
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col">
                                        <div class="Id-btn-card p-2">
                                            <img src="~/BranchSys/CreateContract/img/signature/Pic.svg" class="w-100"
                                                 id="UploadIDPic">
                                            <input type="file" id="IDimageUpload" accept="image/*"
                                                   style="display: none;">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="Id-btn-card p-2">
                                            <img src="~/BranchSys/CreateContract/img/Camera.svg"
                                                 class="w-100" id="openCamera">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="Id-btn-card p-2">
                                            <img src="~/BranchSys/CreateContract/img/signature/save.svg" class="w-100" id="ID-photo-save">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--Signture-->
                <div class="modal fade" id="PicsignatureModal" tabindex="-1" aria-labelledby="PicignaturPopupModalLabel" aria-hidden="true" data-bs-backdrop="true">
                    <div class="modal-dialog modal-dialog-centered d-flex justify-content-center">
                        <div class="modal-content signature-modal-content p-3">
                            <div class="modal-body Signature-modal-body">
                                <div class="SignatureCard">
                                    <div class="main-container" id="removeSignatureImg"></div>
                                    <div class="upload-container">
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col-4">
                                        <div class="sinature-Btn-Card p-2" id="UploadSigntaurePic">
                                            <img src="~/BranchSys/img/Pic.svg" class="w-100">
                                            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                                        </div>
                                    </div>
                                    <div class="col-4" id="WriteSignature">
                                        <div class="sinature-Btn-Card p-2">
                                            <img src="~/BranchSys/img/file-signature_9795523 1.svg" class="w-100">
                                        </div>
                                    </div>
                                    @* <div class="col-3" id="clear">
                                    <div class="sinature-Btn-Card p-2">
                                    <img src="~/BranchSys/img/Frame.svg" class="w-100">
                                    </div>
                                    </div> *@
                                    <div class="col-4" id="Save_Btn">
                                        <div class="sinature-Btn-Card p-2">
                                            <img src="~/BranchSys/img/save.svg" class="w-100" id="save">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--Signture-->
                <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%% TechnicalCheckUp %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
                <div class="modal fade" id="TechnicalCheckUp" aria-hidden="true"
                     aria-labelledby="TechnicalCheckUpLabel" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable "
                         style="max-width: 800px !important;">
                        <div class="modal-content">
                            <div class="modal-header text-center">
                                <p class="modal-title w-100"></p>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>

                            </div>
                            <div class="modal-body">
                                <div class="container">
                                    <div class="row flex-column">
                                        <div class="col-12 text-center">
                                            <div class="row g-3 justify-content-center "
                                                 id="TechnicalCheckUp-container">
                                                <div class="col-auto">
                                                    <button id="bend-in-body-btn"
                                                            class="TechnicalCheckUp-Btn p-2">
                                                        <img src="~/BranchSys/CreateContract/img/bend-in-body.svg">@localizer["CurvatureStructure"]
                                                    </button>
                                                </div>
                                                <div class="col-auto">
                                                    <button id="very-deep-scratch-btn"
                                                            class="TechnicalCheckUp-Btn p-2">
                                                        <img src="~/BranchSys/CreateContract/img/very-deep-scratch.svg">@localizer["VeryDeepScratch"]
                                                    </button>

                                                </div>
                                                <div class="col-auto">
                                                    <button id="deep-scratch-btn"
                                                            class="TechnicalCheckUp-Btn p-2">
                                                        <img src="~/BranchSys/CreateContract/img/deep-scratch.svg"> @localizer["DeepScratch"]
                                                    </button>

                                                </div>
                                                <div class="col-auto">
                                                    <button id="small-scratch-btn"
                                                            class="TechnicalCheckUp-Btn p-2">
                                                        <img src="~/BranchSys/CreateContract/img/small-scratch.svg"> @localizer["SimpleScratch"]
                                                    </button>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 d-flex justify-content-center">
                                            <div class="car-container mt-3">
                                                <canvas id="shape-canvas"></canvas>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="row g-3">
                                                <div class="col d-flex justify-content-center ">
                                                    <button id="undo-btn" class=" undo-redo-btn">
                                                        <img src="~/BranchSys/CreateContract/img/undo.svg">
                                                    </button>


                                                    <button id="redo-btn" class="undo-redo-btn mx-2 ">
                                                        <img src="~/BranchSys/CreateContract/img/undo (2).svg">
                                                    </button>

                                                </div>
                                                <div class="col">
                                                    <button id="save-btn" class="check-btn ">@localizer["Save"] </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% TechnicalCheckUp %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
            </div>
        </div>
    </section>
</div>
<footer class="fixed-bottom-xl">
    <div class="before-footer-widget">
        <svg width: 100%; height:auto viewbox="0 0 2444 132">
            <path fill="rgba(254, 248, 232, 1)" fill-rule="evenodd"
                  d="M1222 0h1222c-444.13 88-852.127 132-1223.993 132C849.253 132 442.585 88.263 0 .789V0h1222z">
            </path>
        </svg>
    </div>
</footer>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <!--makes bootsrab animation works-->
    @*     <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.9.2/dist/umd/popper.min.js"
                       integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
                       crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
            integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>*@
    @*  <script src="~/BranchSys/CreateContract/contract.js"></script>
    <script src="~/BranchSys/CreateContract/contract2.js"></script> *@
    <script src="~/BranchSys/CreateContract/js/contract.js"></script>
    <script src="~/BranchSys/CreateContract/js/contract2.js"></script>
    <script src="~/BranchSys/CreateContract/js/TechnicalCheckUp.js"></script>
    @*     <script src="~/BranchSys/js/javascript/LoaderByPercent.js"></script>
 *@   @*  <script src="~/BranchSys/js/javascript/Loader.js"></script> *@
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/js/all.min.js" integrity="sha512-u3fPA7V8qQmhBPNT5quvaXVa1mnnLSXUep5PS1qo5NRzHwG19aHmNJnj1Q8hpA/nBWZtZD4r4AX6YOt5ynLN2g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="~/js/toastr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        $(document).ready(function () {
            // "Check All" checkbox functionality
            $('#CheckAll').on('change', function () {
                // Set all checkboxes with the class 'CheckUp' to the same state as "Check All"
                console.log("111111")
                $('.CheckUp').prop('checked', $(this).prop('checked'));
            });

            // Uncheck the "Check All" checkbox if any individual checkbox is unchecked
            $(document).on('change', '.CheckUp', function () {
                console.log("00000")
                if (!$(this).prop('checked')) {
                    $('#CheckAll').prop('checked', false);
                }
            });
        });
    </script>
    <script>
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('birth-date').setAttribute('max', today);
        document.getElementById('birth-date-driver').setAttribute('max', today);
        document.getElementById('birth-date-AddDriver').setAttribute('max', today);
    </script>
    <!-- script for جهة العمل و الجنسيات و المنطقة / المدينة dropdown autocomplete list -->
    <script>
        const nationalities = @Html.Raw(Json.Serialize(ViewBag.RenterNationalities));
        const cities = @Html.Raw(Json.Serialize(ViewBag.RenterCities));
        const workPlaces = @Html.Raw(Json.Serialize(ViewBag.RenterWorkplaces));
        var listsIsTrueOrNotRenter = true;
        var listsIsTrueOrNotDriver = true;
        var listsIsTrueOrNotAddDriver = true;
        const dataLists = {
            Cities: cities,
            Nationalities: nationalities,
            WorkPlace: workPlaces
        };

        $(document).ready(function () {
            function setupAutocomplete(inputId, list, dataList, errorElementId, listsIsTrueOrNot, validate) {
                $("#" + inputId).on("input", function () {
                    const value = this.value.toLowerCase();
                    const autocompleteList = $("#" + list);
                    autocompleteList.empty();

                    if (validate) {
                        // Clear the code input and error message whenever the user types
                        $("#" + inputId + "-code").val('');
                        $("#" + errorElementId).text(''); // Clear any previous error message
                    }

                    if (value) {
                        let matchesFound = false;
                        dataList.forEach(item => {
                            if (item.text.toLowerCase().includes(value)) {
                                autocompleteList.append("<div data-value='" + item.value + "'>" + item.text + "</div>");
                                matchesFound = true;
                            }
                        });

                        autocompleteList.toggle(matchesFound);
                    } else {
                        autocompleteList.hide();
                    }
                });

                $(document).on("click", "#" + list + " div", function () {
                    const selectedText = $(this).text();
                    const selectedValue = $(this).data("value");

                    $("#" + inputId).val(selectedText);
                    $("#" + inputId + "-code").val(selectedValue);

                    const matchedItemFromChose = dataList.find(item => item.text === selectedText);

                    if (validate) {
                        if (matchedItemFromChose) {
                            $("#" + inputId + "-code").val(matchedItemFromChose.value);
                            $("#" + errorElementId).text(''); // Clear error message
                            window[listsIsTrueOrNot] = true; // Update the global flag
                        } else {
                            $("#" + errorElementId).text("@localizer["requiredFiled"]"); // Show error message
                            $("#" + inputId + "-code").val("");
                            window[listsIsTrueOrNot] = false; // Update the global flag
                        }
                    }

                    $("#" + list).empty().hide();
                });

                $(document).click(function (e) {
                    if (!$(e.target).closest("#" + list + ", #" + inputId).length) {
                        $("#" + list).empty().hide();
                    }
                });

                if (validate) {
                    // Check for match on blur or Enter key press
                    $("#" + inputId).on("blur keypress", function (e) {
                        if (e.type === "blur" || (e.type === "keypress" && e.which === 13)) {
                            const inputValue = $(this).val();
                            const matchedItem = dataList.find(item => item.text === inputValue);

                            if (matchedItem) {
                                $("#" + inputId + "-code").val(matchedItem.value);
                                $("#" + errorElementId).text(''); // Clear error message
                                window[listsIsTrueOrNot] = true; // Update the global flag
                            } else {
                                $("#" + errorElementId).text("@localizer["requiredFiled"]"); // Show error message
                                window[listsIsTrueOrNot] = false; // Update the global flag
                            }
                        }
                    });
                }
            }

            // Initialize autocomplete for different inputs
            setupAutocomplete("Region-city-tenant", "autocomplete-Cities1", dataLists.Cities, "Region-city-tenant-error", "listsIsTrueOrNotRenter", true);
            setupAutocomplete("nationality-tenant", "autocomplete-Nationalities1", dataLists.Nationalities, "nationality-tenant-error", "listsIsTrueOrNotRenter", true);
            setupAutocomplete("tenant-workplace", "autocomplete-workplace1", dataLists.WorkPlace, "tenant-workplace-error", "listsIsTrueOrNotRenter", false);


            setupAutocomplete("Region-city-driver", "autocomplete-Cities2", dataLists.Cities, "Region-city-driver-error", "listsIsTrueOrNotDriver", true);
            setupAutocomplete("nationality-driver", "autocomplete-Nationalities2", dataLists.Nationalities, "nationality-driver-error", "listsIsTrueOrNotDriver", true);
            setupAutocomplete("driver-workplace", "autocomplete-workplace2", dataLists.WorkPlace, "driver-workplace-error", "listsIsTrueOrNotDriver", false);

            setupAutocomplete("Region-city-addDriver", "autocomplete-Cities3", dataLists.Cities, "Region-city-addDriver-error", "listsIsTrueOrNotAddDriver", true);
            setupAutocomplete("nationality-addDriver", "autocomplete-Nationalities3", dataLists.Nationalities, "nationality-addDriver-error", "listsIsTrueOrNotAddDriver", true);
            setupAutocomplete("addDriver-workplace", "autocomplete-workplace3", dataLists.WorkPlace, "addDriver-workplace-error", "listsIsTrueOrNotAddDriver", false);
        });
    </script>
    <script>
        // // //////////////////////////////////////////////// رفع صورة الهوية ////////////////////////////////////////////////////////////////////////

        //variables//

        // let saveIDBtn = null;

        // document.addEventListener("click", function () {
        //         saveIDBtn = "UploadIDPic";
        //         console.log(saveIDBtn)
        //     });

        // const IDuploadContainer = document.querySelector(".ID-upload-container");
        // const IDmainContainer = document.querySelector(".ID-main-container");
        // const UploadIDPic = document.getElementById("UploadIDPic");
        // const IDimageUpload = document.getElementById("IDimageUpload");
        // const UploadRenderIdPhotoBtn = document.getElementById("UploadRenderIdPhoto");
        // const UploadDriverDrivingLicensePhotoBtn = document.getElementById("UploadDriverLicensePhoto");
        // var imgeURL;
        // const IDuploadedImg = null;
        // //
        // UploadIDPic.addEventListener("click", function () {
        //     IDimageUpload.click();
        // });
        // IDimageUpload.addEventListener("change", function () {
        //     const file = IDimageUpload.files[0];
        //     if (file) {
        //         const reader = new FileReader();
        //         reader.onload = function (e) {
        //             const IDimageURL = e.target.result;
        //             const IDpreviewImage = document.createElement("img");
        //             IDpreviewImage.classList.add("preview-image");
        //             IDpreviewImage.src = IDimageURL;
        //             IDpreviewImage.id = "IDImage";
        //             imgeURL = IDimageURL;
        //             IDmainContainer.innerHTML =
        //                 '<i class="fa-regular fa-circle-xmark"  style="cursor: pointer;"></i>';
        //             IDuploadContainer.innerHTML = "";
        //             IDuploadContainer.appendChild(IDpreviewImage);
        //             IDuploadContainer.classList.add("previewing");
        //         };
        //         reader.readAsDataURL(file);
        //     }
        // });
        // removeIDImg.addEventListener("click", function (event) {
        //     event.preventDefault();
        //     if (IDuploadContainer.firstChild) {
        //         IDuploadContainer.innerHTML = "";
        //         IDmainContainer.innerHTML = "";
        //         IDuploadContainer.classList.remove("previewing");
        //         IDuploadContainer.innerHTML =
        //             ' <img class="upload-icon" src="/BranchSys/CreateContract/img/Rectangle 144.png" alt="Upload Icon"><p>ارفق صورة الهوية </p>';
        //         document.getElementById("RenterIdImg").value = null;
        //     }
        // });
        // // // //////////////////////////////////////////////// التقاط صورة الهوية ////////////////////////////////////////////////////////////////////////
        // const openCameraButton = document.getElementById('openCamera');
        // document.getElementById("openCamera").addEventListener("click", function () {
        //         saveIDBtn = "CameraID";
        //         console.log(saveIDBtn)
        //     });
        // openCameraButton.addEventListener('click', async () => {
        //     let videoElement = document.getElementById('videoElement');
        //     let photo = document.getElementById('photo');

        //     if (!videoElement) {
        //         IDuploadContainer.innerHTML = `
        //                                                                     <video id="videoElement" autoplay></video>
        //                                                                     <img id="photo" alt="The screen capture will appear in this box." style="display:none;">
        //                                                                 `;
        //         videoElement = document.getElementById('videoElement');
        //         photo = document.getElementById('photo');

        //         try {
        //             const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        //             videoElement.srcObject = stream;

        //             await new Promise(resolve => {
        //                 videoElement.onloadedmetadata = () => {
        //                     resolve();
        //                 };
        //             });

        //         } catch (error) {
        //             console.error('Error accessing the camera:', error);
        //         }
        //     } else {
        //         const canvasElement = document.createElement('canvas');
        //         canvasElement.width = videoElement.videoWidth;
        //         canvasElement.height = videoElement.videoHeight;
        //         const context = canvasElement.getContext('2d');
        //         context.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);

        //         const stream = videoElement.srcObject;
        //         const tracks = stream.getTracks();
        //         tracks.forEach(track => track.stop());

        //         const dataUrl = canvasElement.toDataURL('image/png');
        //         photo.src = dataUrl;
        //         photo.style.display = 'block';
        //         videoElement.remove();
        //     }
        // });
        // // Save the uploded IDphoto image
        // function SaveUplodedIDphoto() {
        //     const img = document.getElementById("IDImage");
        //     const canvas = document.createElement("canvas");
        //     canvas.width = img.width;
        //     canvas.height = img.height;
        //     const context = canvas.getContext("2d");
        //     context.drawImage(img, 0, 0, canvas.width, canvas.height);
        //     const base64 = canvas.toDataURL("image/jpeg");
        //     document.getElementById("RenterIdImg").value = base64;
        //     console.log(base64);
        //     $("#IDphoto-modal").modal("hide");
        //     showSpinner(UploadRenderIdPhotoBtn);
        //     setTimeout(function () {
        //         if (base64) {
        //             removeSpinnerAndChangeColor(UploadRenderIdPhotoBtn); // Remove spinner and change color
        //         }
        //     }, 2000);
        // }
        // // Save the camera IDphoto image
        // function SaveCameraIDphoto() {
        //     const img = document.getElementById("photo");
        //     const canvas = document.createElement("canvas");
        //     canvas.width = img.width;
        //     canvas.height = img.height;
        //     const context = canvas.getContext("2d");
        //     context.drawImage(img, 0, 0, canvas.width, canvas.height);
        //     const base64 = canvas.toDataURL("image/jpeg");
        //     document.getElementById("RenterIdImg").value = base64;
        //     console.log(base64);
        //     $("#IDphoto-modal").modal("hide");
        //     showSpinner(UploadRenderIdPhotoBtn);
        //     setTimeout(function () {
        //         if (base64) {
        //             removeSpinnerAndChangeColor(UploadRenderIdPhotoBtn); // Remove spinner and change color
        //         }
        //     }, 2000);
        // }
        // document.getElementById("ID-photo-save").addEventListener("click", function () {
        //     if (saveIDBtn === "UploadIDPic") {
        //         SaveUplodedIDphoto();
        //     } else if (saveIDBtn === "CameraID") {
        //         SaveCameraIDphoto();
        //     }
        // });

        function setupIDPhotoUpload(idBtn, idInputSaved) {

            $('#IDphoto-modal').modal('show'); // Open the modal
            let saveBtn = null;
            document.addEventListener("click", function () {
                saveBtn = "UploadPic";
                console.log(saveBtn)
            });
            const IDuploadContainer = document.querySelector(".ID-upload-container");
            const IDmainContainer = document.querySelector(".ID-main-container");
            const UploadIDPic = document.getElementById("UploadIDPic");
            const IDimageUpload = document.getElementById("IDimageUpload");
            const UploadRenderIdPhotoBtn = document.getElementById(idBtn);
            const InputSavePicture = document.getElementById(idInputSaved);
            InputSavePicture.value = ""; // Clear the hidden input value
            var imgeURL;
            const IDuploadedImg = null;

            UploadIDPic.addEventListener("click", function () {
                IDimageUpload.click();
            });

            IDimageUpload.addEventListener("change", function () {
                const file = IDimageUpload.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const IDimageURL = e.target.result;
                        const IDpreviewImage = document.createElement("img");
                        IDpreviewImage.classList.add("preview-image");
                        IDpreviewImage.src = IDimageURL;
                        IDpreviewImage.id = "IDImage";
                        imgeURL = IDimageURL;
                        IDmainContainer.innerHTML =
                            '<i class="fa-regular fa-circle-xmark" style="cursor: pointer;"></i>';
                        IDuploadContainer.innerHTML = "";
                        IDuploadContainer.appendChild(IDpreviewImage);
                        IDuploadContainer.classList.add("previewing");
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.querySelector("#removeIDImg").addEventListener("click", function (event) {
                event.preventDefault();
                if (IDuploadContainer.firstChild) {
                    IDuploadContainer.innerHTML = "";
                    IDmainContainer.innerHTML = "";
                    IDuploadContainer.classList.remove("previewing");
                    IDuploadContainer.innerHTML =
                        '<img class="upload-icon" src="/BranchSys/CreateContract/img/Rectangle 144.png" alt="Upload Icon"><p>ارفق صورة الهوية </p>';
                    InputSavePicture.value = null;
                }
            });

            const openCameraButton = document.getElementById("openCamera");
            openCameraButton.addEventListener("click", function () {
                saveBtn = "CameraID";
                console.log(saveBtn);
            });

            openCameraButton.addEventListener('click', async () => {
                let videoElement = document.getElementById('videoElement');
                let photo = document.getElementById('photo');

                if (!videoElement) {
                    IDuploadContainer.innerHTML = `
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <video id="videoElement" autoplay></video>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <img id="photo" alt="The screen capture will appear in this box." style="display:none;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    `;
                    videoElement = document.getElementById('videoElement');
                    photo = document.getElementById('photo');

                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                        videoElement.srcObject = stream;

                        await new Promise(resolve => {
                            videoElement.onloadedmetadata = () => {
                                resolve();
                            };
                        });

                    } catch (error) {
                        console.error('Error accessing the camera:', error);
                    }
                } else {
                    const canvasElement = document.createElement('canvas');
                    canvasElement.width = videoElement.videoWidth;
                    canvasElement.height = videoElement.videoHeight;
                    const context = canvasElement.getContext('2d');
                    context.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);

                    const stream = videoElement.srcObject;
                    const tracks = stream.getTracks();
                    tracks.forEach(track => track.stop());

                    const dataUrl = canvasElement.toDataURL('image/png');
                    photo.src = dataUrl;
                    photo.style.display = 'block';
                    videoElement.remove();
                }
            });

            function saveUploadedPhoto() {
                const img = document.getElementById("IDImage");
                const canvas = document.createElement("canvas");
                canvas.width = img.width;
                canvas.height = img.height;
                const context = canvas.getContext("2d");
                context.drawImage(img, 0, 0, canvas.width, canvas.height);
                const base64 = canvas.toDataURL("image/jpeg");
                InputSavePicture.value = base64;
                console.log(base64);
                $("#IDphoto-modal").modal("hide");
                showSpinner(UploadRenderIdPhotoBtn);
                setTimeout(function () {
                    if (base64) {
                        removeSpinnerAndChangeColor(UploadRenderIdPhotoBtn); // Remove spinner and change color
                    }
                }, 2000);
            }

            function saveCameraPhoto() {
                const img = document.getElementById("photo");
                const canvas = document.createElement("canvas");
                canvas.width = img.width;
                canvas.height = img.height;
                const context = canvas.getContext("2d");
                context.drawImage(img, 0, 0, canvas.width, canvas.height);
                const base64 = canvas.toDataURL("image/jpeg");
                InputSavePicture.value = base64;
                console.log(base64);
                $("#IDphoto-modal").modal("hide");
                showSpinner(UploadRenderIdPhotoBtn);
                setTimeout(function () {
                    if (base64) {
                        removeSpinnerAndChangeColor(UploadRenderIdPhotoBtn); // Remove spinner and change color
                    }
                }, 2000);
            }

            document.getElementById("ID-photo-save").addEventListener("click", function () {
                if (saveBtn === "UploadPic") {
                    saveUploadedPhoto();
                } else if (saveBtn === "CameraID") {
                    saveCameraPhoto();
                }
            });
        }

    </script>
    <!--Upload Signture-->
    <script>
        //variables//
        let saveSignatureBtn = null;
        var imgeURL;
        document.getElementById("UploadSigntaurePic").addEventListener("click", function () { saveSignatureBtn = "UploadSigntaurePic"; });
        document.getElementById("WriteSignature").addEventListener("click", function () { saveSignatureBtn = "WriteSignature"; });
        const uploadContainer = document.querySelector(".upload-container");
        const mainContainer = document.querySelector(".main-container");
        const UploadSigntaurePic = document.getElementById("UploadSigntaurePic");
        const imageUpload = document.getElementById("imageUpload");
        var btnSignture = document.getElementById('check_btn_load_Signture');
        const originalContentBtnSignture = document.querySelector("#check_btn_load_Signture").innerHTML;
        var imgeURL;
        const uploadedImg = null;
        //

        UploadSigntaurePic.addEventListener("click", function () {
            imageUpload.click();
        });

        imageUpload.addEventListener("change", function () {
            const file = imageUpload.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const imageURL = e.target.result;
                    const previewImage = document.createElement("img");
                    previewImage.classList.add("preview-image");
                    previewImage.src = imageURL;
                    previewImage.id = "signatureImage";
                    imgeURL = imageURL;
                    mainContainer.innerHTML =
                        '<i class="fa-regular fa-circle-xmark"  style="cursor: pointer;"></i>';
                    uploadContainer.innerHTML = "";
                    uploadContainer.appendChild(previewImage);
                    uploadContainer.classList.add("previewing");
                };
                reader.readAsDataURL(file);
            }
        });

        removeSignatureImg.addEventListener("click", function (event) {
            event.preventDefault();
            if (uploadContainer.firstChild) {
                uploadContainer.innerHTML = "";
                mainContainer.innerHTML = "";
                uploadContainer.classList.remove("previewing");
                uploadContainer.innerHTML =
                    '<img class="upload-icon" src="/BranchSys/CreateContract/img/Rectangle 144.png" alt="Upload Icon"><p>' + '@localizer["UploadSignture"]' + '</p>';
            }
        });

        function CheckSigntureImgForRenter() {
            // Clear existing content and remove the 'previewing' class by default
            uploadContainer.innerHTML = '<img class="upload-icon" src="/BranchSys/CreateContract/img/Rectangle 144.png" alt="Upload Icon"><p>' + '@localizer["UploadSignture"]' + '</p>';
            uploadContainer.classList.remove('previewing');

            // Check if RenterInformation is not null or undefined and has a signture property
            if (RenterInformation && RenterInformation.signture) {
                removeSpinnerAndChangeColor(btnSignture);
                uploadContainer.innerHTML = '<img class="preview-image" src="' + RenterInformation.signture.replace("~", "") + '">';
                uploadContainer.classList.add('previewing');
            }
        }
        btnSignture.addEventListener('click', function (event) {
            event.preventDefault();
            CheckSigntureImgForRenter();
        });
    </script>
    <!--Write Signture-->
    <script>
        const WriteSignature = document.getElementById("WriteSignature");
        WriteSignature.addEventListener("click", function () {
            uploadContainer.innerHTML = "";
            mainContainer.innerHTML = "";
            uploadContainer.innerHTML =
                '<canvas id="canvas" width="200" height="200" class="mb-2"></canvas>';
            var canvas = document.getElementById("canvas");
            var ctx = canvas.getContext("2d");
            ctx.lineWidth = 4;

            var drawing = false;
            var prevX = 0;
            var prevY = 0;
            var currX = 0;
            var currY = 0;

            function drawLine(x0, y0, x1, y1) {
                ctx.beginPath();
                ctx.moveTo(x0, y0);
                ctx.lineTo(x1, y1);
                ctx.stroke();
                ctx.closePath();
            }

            canvas.addEventListener("mousedown", handleMouseDown, false);
            canvas.addEventListener("mousemove", handleMouseMove, false);
            canvas.addEventListener("mouseup", handleMouseUp, false);

            canvas.addEventListener("touchstart", handleTouchStart, false);
            canvas.addEventListener("touchmove", handleTouchMove, false);
            canvas.addEventListener("touchend", handleTouchEnd, false);

            function handleMouseDown(e) {
                drawing = true;
                prevX = e.clientX - canvas.getBoundingClientRect().left;
                prevY = e.clientY - canvas.getBoundingClientRect().top;
            }

            function handleMouseMove(e) {
                if (!drawing) return;
                currX = e.clientX - canvas.getBoundingClientRect().left;
                currY = e.clientY - canvas.getBoundingClientRect().top;

                drawLine(prevX, prevY, currX, currY);
                prevX = currX;
                prevY = currY;
            }

            function handleMouseUp() {
                drawing = false;
            }

            function handleTouchStart(e) {
                drawing = true;
                prevX = e.touches[0].clientX - canvas.getBoundingClientRect().left;
                prevY = e.touches[0].clientY - canvas.getBoundingClientRect().top;
            }

            function handleTouchMove(e) {
                if (!drawing) return;
                currX = e.touches[0].clientX - canvas.getBoundingClientRect().left;
                currY = e.touches[0].clientY - canvas.getBoundingClientRect().top;

                drawLine(prevX, prevY, currX, currY);
                prevX = currX;
                prevY = currY;
            }

            function handleTouchEnd() {
                drawing = false;
            }
            // Clear the canvas
            // function clearCanvas() {
            //     ctx.clearRect(0, 0, canvas.width, canvas.height);
            // }

            // document.getElementById("clear").addEventListener("click", function () {
            //     clearCanvas();
            // });

        });
        // Save the written signature as an image
        function SaveWrittenSignature() {
            var canvas = document.getElementById("canvas");
            if (canvas) {
                var dataURL = canvas.toDataURL();
                var link = document.createElement("a");
                link.href = dataURL;
                var imgeURL = dataURL;
                $("#PicsignatureModal").modal("hide");
                return imgeURL;
            } else {
                return null;
            }
        }
        // Save the uploaded signature image
        function SaveUploadedSignature() {
            const img = document.getElementById("signatureImage");
            if (img) {
                const canvas = document.createElement("canvas");
                canvas.width = img.width;
                canvas.height = img.height;
                const context = canvas.getContext("2d");
                context.drawImage(img, 0, 0, canvas.width, canvas.height);
                const base64 = canvas.toDataURL("image/jpeg");
                $("#PicsignatureModal").modal("hide");
                return base64;
            } else {
                return null;
            }
        }
    </script>
    <script>
        const imageSubmitBtn = document.getElementById('Save_Btn');
        imageSubmitBtn.addEventListener('click', function (event) {
            event.preventDefault();
            imgeURL = null;
            if (saveSignatureBtn === "UploadSigntaurePic") {
                imgeURL = SaveUploadedSignature();
            } else if (saveSignatureBtn === "WriteSignature") {
                imgeURL = SaveWrittenSignature();
            }
            if (!imgeURL) {
                $('#PicsignatureModal').modal('hide');
                // toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                // toastr.error('@localizer["PleaseEnterPictureToast"]');
                return;
            }

            if (uploadContainer.firstChild) {
                uploadContainer.innerHTML = '';
                uploadContainer.classList.remove('previewing');
                uploadContainer.innerHTML = '<img class="upload-icon" src="/BranchSys/CreateContract/img/Rectangle 144.png" alt="Upload Icon"><p>' + '@localizer["UploadSignture"]' + '</p>';
            }

            $('#PicsignatureModal').modal('hide');
            // Show the spinner
            showSpinner(btnSignture);
            var CheckUpdateSigntureForRenter = updateRenterSignture(imgeURL);
            console.log("CheckUpdateSigntureForRenter", CheckUpdateSigntureForRenter);
            setTimeout(function () {
                $('#thirdPopupModal').modal('hide');
                if (CheckUpdateSigntureForRenter) {
                    removeSpinnerAndChangeColor(btnSignture); // Remove spinner and change color
                    console.log("CheckUpdateSigntureForRenter", 000000000000);
                }
                else {
                    toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                    toastr.error('@localizer["SomethingWrongPleaseCallAdmin"]');
                }
            }, 2000);
        });
        async function updateRenterSignture(img) {
            if (RenterInformation != null && img) {
                RenterInformation.signture = img;
                $("#Contract_RenterInfo_CrMasRenterInformationSignature").val(img);
                console.log("img", img);
                return true;
            }
            return false;
        }
        // async function updateRenterSignture(img, renterId) {
        //     try {
        //         var data = await $.ajax({
        //             url: "/BS/Contract/UpdateSigntureForRenter",
        //             type: "POST",
        //             data: { img: img, renterId: renterId },
        //         });
        //         if (data) {
        //             RenterInformation.signture = data;
        //             console.log("data", data);
        //             return true; // Renter Updated Successfully
        //         }
        //     } catch (error) {
        //         return false; // Error occurred or Renter doesn't exist
        //     }
        //     return false; // Renter doesn't exist
        // }
    </script>
    <script>
        //////////////////////choose-adriver-display////////////////
        document.addEventListener("DOMContentLoaded", function () {
            $(".seacrh_icon_Renter").hide();
            $("#seacrh_icon_Driver").hide();
            $("#seacrh_icon_AddDriver").hide();
            $("#PrivateDriverDiv").hide();
            $("#RenterIsdriverDiv").hide();
            // Check if have driver or not
            var driverRadio1 = document.getElementById("RenterIsdriver");
            var driverRadio2 = document.getElementById("PrivateDriver");
            var dropdownContainer = document.getElementById("Private-Driver-select-Div");

            driverRadio1.addEventListener("click", function () {
                dropdownContainer.style.display = "none";
                driverRadio2.checked = false;
                $('#Private-Driver-selectt option:first').prop('selected', true);
            });

            driverRadio2.addEventListener("click", function () {
                if (this.checked) {
                    dropdownContainer.style.display = "block";
                    driverRadio1.checked = false;
                } else {
                    dropdownContainer.style.display = "none";
                }
            });
        });
        function ShowPrivateAndRenterIsDriver() {
            var driverCount = "@Model.Drivers.Count()";
            console.log("driverCount", driverCount);
            if (parseInt(driverCount) > 0) {
                $("#PrivateDriverDiv").show();
            }
            $("#RenterIsdriverDiv").show();
        }
    </script>
    <script>
        var modelPersonal = {
            renterID: null,
            renterIDType: null,
            personalArName: null,
            personalEnName: null,
            personalArNationality: null,
            personalEnNationality: null,
            nationalityCode: null,
            genderCode: null,
            personalArGender: null,
            personalEnGender: null,
            professionsCode: null,
            personalArProfessions: null,
            personalEnProfessions: null,
            personalEmail: null,
            mobileNumber: null,
            keyCountry: null,
            birthDate: null,
            expiryIdDate: null,
            balance: 0,
            availableBalance: 0,
            reservedBalance: 0,
            licenseType: null,
            licenseCode: null,
            licenseArName: null,
            licenseEnName: null,
            licenseIssuedDate: null,
            licenseExpiryDate: null,
            employerCode: null,
            employerArName: null,
            employerEnName: null,
            cityCode: null,
            cityAr: null,
            cityEn: null,
            postArNameConcenate: null,
            postEnNameConcenate: null,
            firstVisit: null,
            lastContract: null,
            contractCount: null,
            rentalDays: null,
            kMCut: null,
            amountsTraded: null,
            evaluation: null,
            arDealingMechanism: null,
            enDealingMechanism: null,
            arMembership: null,
            enMembership: null,
            signture: null,
            taxNo: null,
            countContracts: null,
            activeContractsCount: null,
            closedContractsCount: null,
            reasons: null
        };
        var CheckIfConfirmByPhone = false;
        var CheckIfRenterIdExist = false;
        var CheckIfDriverIdExist = false;
        var CheckIfAddDriverIdExist = false;
        var RenterInformation = { ...modelPersonal };
        var DriverInformation = { ...modelPersonal };
        var AddDriverInformation = { ...modelPersonal };
        var PrivateDriverInformation;
        var SerialNumberOfCar;
        var PriceNumberOfCar;
        var CarInformation;
        var CarInformationForContract;
        var CarChoices;
        var CarAdditionals;
        var CarAdvantages;
        var CarCheckUp;
        var AdvantagesValue;
        var RenterBalance;
        var phoneForRenter;
        var codeCountryForRenter;
        var phoneForDriver;
        var codeCountryForDriver;
        var phoneForAddDriver;
        var codeCountryForAddDriver;


        // Get Information Using ID and Type Who get it
        async function GetPersonInformation(Id, type) {
            try {
                var data = await $.ajax({
                    url: "/BS/Contract/GetRenter",
                    type: "GET",
                    data: { RenterId: Id },
                });
                if (type === "renter") {
                    RenterInformation = data;
                }
                else if (type === "driver") {
                    DriverInformation = data;
                }
                else if (type === "addDriver") {
                    AddDriverInformation = data;
                }
                else {
                    PrivateDriverInformation = data;
                }

                console.log(type + "Information", data)

                if (data != null) {
                    return true; // Renter exists
                }
            } catch (error) {
                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                toastr.error('@localizer["SomethingWrongPleaseCallAdmin"]');
                return false; // Error occurred or Renter doesn't exist
            }
            return false; // Renter doesn't exist
        }
        // For PrivateDriver
        async function GetPrivateDriverInformation(id) {
            try {
                var data = await $.ajax({
                    url: "/BS/Contract/GetPrivateDriverInfo",
                    type: "GET",
                    data: { id: id },
                });

                PrivateDriverInformation = data;
                console.log("PrivateDriverInformation", PrivateDriverInformation);
                if (data != null) {
                    return true; // Renter exists
                }
            } catch (error) {
                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                toastr.error('@localizer["SomethingWrongPleaseCallAdmin"]');
                return false; // Error occurred or Renter doesn't exist
            }
            return false; // Renter doesn't exist
        }



        // Example usage
        var randomNumberRenter;
        var randomNumberDriver;
        var randomNumberAddDriver;
        function generateRandomNumber() {
            // Generate a random number between 0 and 999999
            const randomNumber = Math.floor(Math.random() * 1000000);
            // Convert it to a string and pad with zeros to ensure length is 6
            return randomNumber.toString().padStart(6, '0');
        }
        // Function to send a message to WhatsApp
        async function sendMessageToWhatsApp(randomNumber, numberPhone) {
            const toNumber = numberPhone; // The recipient's phone number
            const fromNumber = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJudW1iZXIiOiJKYXNlcjExIiwic2VyaWFsIjoiMTk5ZmUzYjFlYjc2MjNlIiwiaWF0IjoxNzA3NzMxNjI4LCJleHAiOjE3OTQxMzE2Mjh9.O_4RW4vYAays1ZL7D-OlOQh6C5P5xVYrT3pZ2Oi9Yak"; // Your WhatsApp API token
            const messageText = '@localizer["VerificationCode"]' + " " + randomNumber + " BnanSC"; // The message text with the random code
            const url = `https://business.enjazatik.com/api/v1/send-message?number=${encodeURIComponent(toNumber)}&message=${encodeURIComponent(messageText)}&token=${encodeURIComponent(fromNumber)}`;
            try {
                const response = await fetch(url, { method: 'GET' });
                const result = await response.json();
            } catch (error) {
                console.error('Error sending message:', error);
            }
        }
        document.getElementById("CheckRenter").addEventListener("click", async function () {
            if ($("#msform").valid()) {
                resetModal();// To Reset Model First
                var renterID = document.getElementById("Contract_RenterInfo_CrMasRenterInformationId").value;
                console.log("renterID", renterID);
                CheckIfRenterIdExist = await GetPersonInformation(renterID, "renter");
                UserCheck(CheckIfRenterIdExist, RenterInformation, SetInformationForRenter, ".hidden-input-row-renter", "renter", "#CheckRenter");
            }
        });
        document.getElementById("CheckDriver").addEventListener("click", async function () {
            if ($("#msform").valid()) {
                resetModal();// To Reset Model First
                var DriverID = document.getElementById("Contract_DriverInfo_CrMasRenterInformationId").value;
                console.log("DriverID", DriverID);
                CheckIfDriverIdExist = await GetPersonInformation(DriverID, "driver");
                UserCheck(CheckIfDriverIdExist, DriverInformation, SetInformationForDriver, ".hidden-input-row-driver", "driver", "#CheckDriver");
            }
        });
        document.getElementById("CheckAddDriver").addEventListener("click", async function () {
            if ($("#msform").valid()) {
                resetModal();// To Reset Model First
                var AddDriverID = document.getElementById("Contract_AddDriverInfo_CrMasRenterInformationId").value;
                console.log("AddDriverID", AddDriverID);
                CheckIfAddDriverIdExist = await GetPersonInformation(AddDriverID, "addDriver");
                UserCheck(CheckIfAddDriverIdExist, AddDriverInformation, SetInformationForAddDriver, ".hidden-input-row-addDriver", "addDriver", "#CheckAddDriver");
            }
        });

        function SetCodeAndPhoneNumberToRenter(type) {
            if (type === "renter") {
                $("#Contract_RenterInfo_CrMasRenterInformationCountreyKey").val(codeCountryForRenter)
                $("#Contract_RenterInfo_CrMasRenterInformationMobile").val(phoneForRenter)
                // RenterInformation.keyCountry = codeCountryForRenter;
                // RenterInformation.mobileNumber = phoneForRenter;
            }
            else if (type === "driver") {
                $("#keyCountry-driver").val(codeCountryForDriver)
                $("#mobile-driver").val(phoneForDriver)
                // DriverInformation.keyCountry = codeCountryForDriver;
                // DriverInformation.mobileNumber = phoneForDriver;
            }
            else {
                $("#Contract_AddDriverInfo_CrMasRenterInformationCountreyKey").val(codeCountryForAddDriver)
                $("#Contract_AddDriverInfo_CrMasRenterInformationMobile").val(phoneForAddDriver)
                // AddDriverInformation.keyCountry = codeCountryForAddDriver;
                // AddDriverInformation.mobileNumber = phoneForAddDriver;
            }

        }
        async function SendCodeToPhoneNumber(type) {
            const selectedWayToSendMessage = $('input[name="SMS-or-WhatsApp"]:checked').val();
            if (selectedWayToSendMessage == "WhatsApp") {
                TimerFunction("SendMessageBtn");
                randomNumberRenter = generateRandomNumber();
                if (type === "renter") {
                    phoneForRenter = $("#CheckModal-PhoneInput").val();
                    codeCountryForRenter = $("#country-code").val();
                    console.log("phoneForRenter", phoneForRenter);
                    console.log("codeCountryForRenter", codeCountryForRenter);
                }
                else if (type === "driver") {
                    phoneForDriver = $("#CheckModal-PhoneInput").val();
                    codeCountryForDriver = $("#country-code").val();
                }
                else {
                    phoneForAddDriver = $("#CheckModal-PhoneInput").val();
                    codeCountryForAddDriver = $("#country-code").val();
                }
                var phoneNoSendCode;
                var phoneNumberRenter = codeCountryForRenter + phoneForRenter;
                var phoneNumberUser = '@user.CrMasUserInformationCallingKey' + '@user.CrMasUserInformationMobileNo';
                var lessorCode = "@lessorInfo.CrMasUserInformationLessor";
                if (parseInt(lessorCode) > 4009) {
                    phoneNoSendCode = phoneNumberRenter;
                    console.log("phoneNumberRenter", phoneNoSendCode);
                }
                else {
                    phoneNoSendCode = phoneNumberUser;
                    console.log("phoneNumberUser", phoneNoSendCode);
                }
                await sendMessageToWhatsApp(randomNumberRenter, phoneNoSendCode);
            }
            else if (selectedWayToSendMessage == "SMS") {
                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                toastr.warning('@localizer["ThisFeatureNotAvaliable"]');
                return;
            }
        }
        const originalContent = document.querySelector("#confirmButton").innerHTML;
        const originalContentSendMessage = document.getElementById("SendMessageBtn").innerHTML;
        function UserCheck(WhoIsCheck, model, updateFunction, classDivHide, type, btnCheck) {
            $("#checkModalToggle").modal('show');
            setTimeout(() => {
                $("#CheckModal-PhoneInput").focus();
            }, 500);
            if (WhoIsCheck) {
                var countryKey = model.keyCountry;
                var mobileNumber = model.mobileNumber;
                $("#country-code").val(countryKey);
                $("#CheckModal-PhoneInput").val(mobileNumber);
            }
            const confirmButton = document.querySelector("#confirmButton");
            const ResendButton = document.querySelector("#ResendButton");
            // تغيير حالة مدخلات ارقام الكود الي disabledd
            const otpInputs = document.querySelectorAll("input.OTP");
            otpInputs.forEach(function (input) {
                input.disabled = true;
            });
            // التأكد من ادخال جميع ارقام الكود السته
            otpInputs.forEach((input, index) => {
                input.addEventListener("input", () => {
                    if (Array.from(otpInputs).every((input) => input.value.trim() !== "")) {
                        confirmButton.disabled = false;
                    } else {
                        confirmButton.disabled = true;
                    }
                });
            });
            confirmButton.addEventListener("click", function () {
                $("#Incorrect-Code-Erorr").text("");
                //  اظهار لودر اثناء التحقق من الكود
                var spinner = document.createElement("div");
                spinner.classList.add(
                    "spinner-border",
                    "spinner-border-sm",
                    "text-warning"
                );
                spinner.role = "status";

                var checkIcon = document.createElement("i");
                checkIcon.classList.add("fa-solid", "fa-check");

                confirmButton.innerHTML = "";
                confirmButton.appendChild(spinner);
                confirmButton.classList.add("send-check");

                setTimeout(() => {
                    confirmButton.innerHTML = "";
                    confirmButton.innerHTML = originalContent;
                    console.log("originalContent", originalContent)
                    confirmButton.classList.remove("send-check");

                }, 1500);
                // مقارنة الكود المدخل بالكود المرسل و حالة المستأجر
                var predefinedCode = "111111";
                var hiddenInputRow = document.querySelector(classDivHide);
                var otpInputs = document.querySelectorAll("input.OTP");
                let enteredCode = "";
                otpInputs.forEach(function (input) {
                    enteredCode += input.value;
                });
                if (enteredCode === predefinedCode || enteredCode === randomNumberRenter) {
                    setTimeout(() => {
                        hiddenInputRow.style.display = "block";
                        $(btnCheck).hide();
                        CheckIfConfirmByPhone = true;
                        SetCodeAndPhoneNumberToRenter(type);
                        updateFunction();
                        $("#checkModalToggle").modal("hide");
                    }, 1500);

                }
                else {
                    setTimeout(() => {
                        $("#Incorrect-Code-Erorr").text('@localizer["CodeIsWrong"]');
                    }, 1500);
                }
            });
            // Send Code To Phone
            document.getElementById("SendMessageBtn").addEventListener("click", async function () {
                //Check Phone And Code
                var countryCode = $("#country-code").val();
                var phoneNumber = $("#CheckModal-PhoneInput").val();
                if (countryCode && phoneNumber) {
                    $("#CheckModal-PhoneInput-Error").text('');
                    await SendCodeToPhoneNumber(type);
                }
                else {
                    $("#CheckModal-PhoneInput-Error").text('@localizer["SureCountryCodeAndPhone"]');
                    return;
                }
            });
            // Resend Code To Phone
            ResendButton.addEventListener("click", async function () {
                const SendButton = document.getElementById("SendMessageBtn");
                const otcInputs = document.querySelectorAll(".OTP");
                // SendButton.disabled = false;
                document.getElementById("otc-1").value = "";
                document.getElementById("otc-2").value = "";
                document.getElementById("otc-3").value = "";
                document.getElementById("otc-4").value = "";
                document.getElementById("otc-5").value = "";
                document.getElementById("otc-6").value = "";
                otcInputs[0].focus();
                await SendCodeToPhoneNumber(type);
            });

        }
        function TimerFunction(buttonId) {
            const otpInputs = document.querySelectorAll("input.OTP");
            otpInputs.forEach(function (input) {
                input.disabled = false;
            });
            const SendButton = document.getElementById("SendMessageBtn");
            const ResendButton = document.getElementById("ResendButton");
            const otcInputs = document.querySelectorAll(".OTP");
            const spinner = document.createElement("div");
            spinner.classList.add("spinner-border", "spinner-border-sm", "text-warning");
            spinner.role = "status";

            const checkIcon = document.createElement("i");
            checkIcon.classList.add("fa-solid", "fa-check");

            SendButton.innerHTML = "";
            SendButton.appendChild(spinner);
            SendButton.classList.add("send-check");

            setTimeout(() => {
                SendButton.innerHTML = originalContentSendMessage;
                SendButton.classList.remove("send-check");
                SendButton.disabled = true;
                ResendButton.disabled = false;
                otcInputs[0].focus();
            }, 2000);

            if (buttonId !== lastClickedButtonId || !interval) {
                if (interval) {
                    clearInterval(interval);
                }
                lastClickedButtonId = buttonId;
                var display = document.querySelector("#timerDiv");
                var timer = 300, minutes, seconds;
                interval = setInterval(function () {
                    minutes = parseInt(timer / 60, 10);
                    seconds = parseInt(timer % 60, 10);

                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;

                    display.textContent = minutes + ":" + seconds;

                    if (--timer < 0) {
                        timer = 0;
                        clearInterval(interval);
                        $("#checkModalToggle").modal("hide");
                    }
                }, 1000);
            }
        };
        function resetModal() {
            // Clear input fields
            CheckIfConfirmByPhone = false;
            $("#country-code").val('');
            $("#CheckModal-PhoneInput").val('');
            $(".OTP").val('');

            // Reset radio buttons
            $("input[name='SMS-or-WhatsApp']").prop('checked', false);
            $("#WhatsApp").prop('checked', true);

            // Hide error messages and disable buttons

            $("#ResendButton").prop('disabled', true);
            $("#confirmButton").prop('disabled', true);
            $("#SendMessageBtn").prop('disabled', false);
            // Reset timer
            ResetTimerForModal();
        }
        function ResetTimerForModal() {
            // ايقاف الtimer
            if (interval) {
                clearInterval(interval);
            }

            // Reset the timer
            var display = document.querySelector("#timerDiv");
            display.innerHTML = "05:00";
        }

        // Renter
        //Restart all values
        $(document).ready(function () {
            var initialRenterID = $('#Contract_RenterInfo_CrMasRenterInformationId').val();
            $('#Contract_RenterInfo_CrMasRenterInformationId').on('change', function () {
                // Check if the value has changed
                if ($(this).val() !== initialRenterID) {
                    // Clear previous data and style
                    RenterInformation = null;
                    EmptyRenterInput();
                    $("#nationality-type").val('');
                    // setDateForInputField("birth-date", "");
                    $("#birth-date").val("");
                    $(".hidden-input-row-renter").hide();
                    $("#PrivateDriverDiv").hide();
                    $("#RenterIsdriverDiv").hide();
                    $("#seacrh_icon_Renter").hide();
                    $("#CheckRenter").show();
                    $("#country-code").val($("#country-code option:first").val());
                    $("#CheckModal-PhoneInput").val('');
                    EmptyDriverRequiredInputs();
                    EmptyAddDriverRequiredInputs();
                    CheckIfConfirmByPhone = false;
                    CheckIfRenterIdExist = false;
                    CheckIfDriverIdExist = false;
                    CheckIfAddDriverIdExist = false;
                    clearPaymentData();
                    // Update the initial value of RenterID
                    initialRenterID = $(this).val();
                }
            });
        });
        function EmptyRenterInput() {
            $("#AR-name-tenant").val('');
            $("#EN-name-tenant").val('');
            $("#AR-adress-tenant").val('');
            $("#EN-adress-tenant").val('');
            $("#Region-city-tenant-code").val('');
            $("#Region-city-tenant").val('');
            $("#tenant-workplace-code").val('');
            $("#Profession-tenant").val('');
            $("#Email-tenant").val('');
            $("#Reasons-tenant").val('');
            $(".requird-field").text('');
            $('.genderRenter[type="radio"]').prop('checked', false);
            var idType = document.getElementById("nationality-type").value;
            if (parseInt(idType) > 5) {
                // Disable all input fields
                $('.genderRenter[type="radio"]').prop('checked', false);
                // Remove the div with id 'divGenderRenter'
                $('#divGenderRenter').remove();
            }
            $("#nationality-tenant").val('');
            $("#tenant-workplace").val('');
            $("#Region-city-tenant").val('');
            document.getElementById("PrivateDriver").checked = false;
            document.getElementById("RenterIsdriver").checked = false;
            // Auto Focus
            if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                setTimeout(() => {
                    $("#EN-name-tenant").focus();
                }, 500);
            } else {
                setTimeout(() => {
                    $("#AR-name-tenant").focus();
                }, 500);
            }
        }
        function SaveRenterInfo() {
            // Collect form data
            var formData = {
                CrMasRenterInformationId: $("#Contract_RenterInfo_CrMasRenterInformationId").val(),
                CrMasRenterInformationIdtype: $("#nationality-type").val(),
                // CrMasRenterInformationBirthDate: $("#birth-date").val(),
                BirthDate: $("#birth-date").val(),
                CrMasRenterInformationArName: $("#AR-name-tenant").val(),
                CrMasRenterInformationEnName: $("#EN-name-tenant").val(),
                CrMasRenterInformationArAddress: $("#AR-adress-tenant").val(),
                CrMasRenterInformationEnAddress: $("#EN-adress-tenant").val(),
                CrMasRenterInformationCity: $("#Region-city-tenant-code").val(),
                CityText: $("#Region-city-tenant").val(),
                CrMasRenterInformationEmployer: $("#tenant-workplace-code").val(),
                CrMasRenterInformationEmployerName: $("#tenant-workplace").val(),
                CrMasRenterInformationProfession: $("#Profession-tenant").val(),
                CrMasRenterInformationEmail: $("#Email-tenant").val(),
                CrMasRenterInformationReasons: $("#Reasons-tenant").val(),
                CrMasRenterInformationGender: $('.genderRenter[type="radio"]:checked').val(),
                CrMasRenterInformationNationality: $("#nationality-tenant-code").val(),
                CrMasRenterInformationCountreyKey: codeCountryForRenter,
                CrMasRenterInformationMobile: phoneForRenter,
                CrMasRenterInformationRenterIdImage: $("#RenterIdImg").val(),
                // Add more fields as needed
            };
            $.ajax({
                url: "/BS/Contract/AddRenterInformation",
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function (response) {
                    RenterInformation = response;
                    console.log("RenterInformation", RenterInformation);
                    if (response != null) {
                        return true; // Renter exists
                    }
                },
                error: function (xhr, status, error) {
                    toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                    toastr.error('@localizer["SomethingWrongPleaseCallAdmin"]');
                    return false; // Error occurred or Renter doesn't exist
                }
            });
        }
        function SetInformationForRenter() {
            if (RenterInformation != null) {
                document.getElementById("AR-name-tenant").value = RenterInformation.personalArName;
                document.getElementById("EN-name-tenant").value = RenterInformation.personalEnName;
                document.getElementById("AR-adress-tenant").value = RenterInformation.postArNameConcenate;
                document.getElementById("EN-adress-tenant").value = RenterInformation.postEnNameConcenate;
                document.getElementById("Region-city-tenant-code").value = RenterInformation.cityCode;
                document.getElementById("nationality-tenant-code").value = RenterInformation.nationalityCode;
                document.getElementById("tenant-workplace-code").value = RenterInformation.employerCode;
                document.getElementById("Profession-tenant").value = RenterInformation.professionsCode;
                document.getElementById("Email-tenant").value = RenterInformation.personalEmail;
                document.getElementById("Reasons-tenant").value = RenterInformation.reasons;
                document.getElementById("Contract_RenterInfo_OldSignature").value = RenterInformation.signture;
                // Set the selected radio button by id
                var radioButtonId = "genderRenter-" + RenterInformation.genderCode;
                $("#" + radioButtonId).prop('checked', true);
                var idType = document.getElementById("nationality-type").value;
                if (parseInt(idType) > 5) {
                    // Disable all input fields
                    $('.genderRenter[type="radio"]').prop('checked', false);
                    // Remove the div with id 'divGenderRenter'
                    $('#divGenderRenter').remove();
                    $('#RenterIsdriver').remove();
                }
                if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                    document.getElementById("nationality-tenant").value = RenterInformation.personalEnNationality;
                    document.getElementById("tenant-workplace").value = RenterInformation.employerEnName;
                    document.getElementById("Region-city-tenant").value = RenterInformation.cityEn;
                    setTimeout(() => {
                        $("#EN-name-tenant").focus();
                    }, 500);
                }
                else {
                    document.getElementById("nationality-tenant").value = RenterInformation.personalArNationality;
                    document.getElementById("tenant-workplace").value = RenterInformation.employerArName;
                    document.getElementById("Region-city-tenant").value = RenterInformation.cityAr;
                    setTimeout(() => {
                        $("#AR-name-tenant").focus();
                    }, 500);
                }
                // Auto Focus
                CheckIfRenterHaveContractsBefore();
            }
            else {
                EmptyRenterInput();
            }
            ShowPrivateAndRenterIsDriver();
        }
        function SetInformationForRenterIfNotExist() {
            // Personal Information
            if (RenterInformation == null) {
                RenterInformation = { ...modelPersonal };
            }
            RenterInformation.renterID = document.getElementById("Contract_RenterInfo_CrMasRenterInformationId").value;
            RenterInformation.renterIDType = document.getElementById("nationality-type").value;
            RenterInformation.birthDate = document.getElementById("birth-date").value;
            RenterInformation.personalArName = document.getElementById("AR-name-tenant").value;
            RenterInformation.personalEnName = document.getElementById("EN-name-tenant").value;
            RenterInformation.postArNameConcenate = document.getElementById("AR-adress-tenant").value;
            RenterInformation.postEnNameConcenate = document.getElementById("EN-adress-tenant").value;
            RenterInformation.cityCode = document.getElementById("Region-city-tenant-code").value;
            RenterInformation.nationalityCode = document.getElementById("nationality-tenant-code").value;
            RenterInformation.employerCode = document.getElementById("tenant-workplace-code").value;
            RenterInformation.professionsCode = document.getElementById("Profession-tenant").value;
            RenterInformation.personalEmail = document.getElementById("Email-tenant").value;
            RenterInformation.keyCountry = codeCountryForRenter;
            RenterInformation.mobileNumber = phoneForRenter;
            RenterInformation.arMembership = "مشترك";
            RenterInformation.enMembership = "Mutual";
            document.getElementById("Contract_RenterInfo_CrMasRenterInformationMobile").value = phoneForRenter;
            document.getElementById("Contract_RenterInfo_CrMasRenterInformationCountreyKey").value = codeCountryForRenter;
            RenterInformation.reasons = document.getElementById("Reasons-tenant").value;

            // Handle the selected radio button for gender
            var selectedGenderRadio = document.querySelector('input[name="Contract.RenterInfo.CrMasRenterInformationGender"]:checked');
            if (selectedGenderRadio) {
                RenterInformation.genderCode = selectedGenderRadio.value;
                RenterInformation.personalEnGender = selectedGenderRadio.getAttribute('data-en') || '';
                RenterInformation.personalArGender = selectedGenderRadio.getAttribute('data-ar') || ''; // Defaults to an empty string if null or empty
            }

            // Handle the idType and disable inputs if necessary
            var idType = document.getElementById("nationality-type").value;
            if (parseInt(idType) > 5) {
                $('.genderRenter[type="radio"]').prop('checked', false);
                $('#divGenderRenter').remove();
                $('#RenterIsdriver').remove();
            }

            // Handle culture-specific settings
            if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                RenterInformation.personalEnNationality = document.getElementById("nationality-tenant").value;
                RenterInformation.employerEnName = document.getElementById("tenant-workplace").value;
                RenterInformation.cityEn = document.getElementById("Region-city-tenant").value;
                setTimeout(() => {
                    $("#EN-name-tenant").focus();
                }, 500);
            } else {
                RenterInformation.personalArNationality = document.getElementById("nationality-tenant").value;
                RenterInformation.employerArName = document.getElementById("tenant-workplace").value;
                RenterInformation.cityAr = document.getElementById("Region-city-tenant").value;
                setTimeout(() => {
                    $("#AR-name-tenant").focus();
                }, 500);
            }
            ShowPrivateAndRenterIsDriver();
            console.log("RenterInformation", RenterInformation);
        }
        function CheckIfRenterHaveContractsBefore() {
            console.log("countContracts", RenterInformation.countContracts);
            if (RenterInformation != null && RenterInformation.countContracts > 0) {
                console.log("RenterInformation", RenterInformation);
                $("#seacrh_icon_Renter").show();

                var firstVisitDate = new Date(RenterInformation.firstVisit);
                var lastContractDate = new Date(RenterInformation.lastContract);
                var formattedFirstVisit = firstVisitDate.getFullYear() + '/' + (firstVisitDate.getMonth() + 1).toString().padStart(2, '0') + '/' + firstVisitDate.getDate().toString().padStart(2, '0');
                var formattedLastContract = lastContractDate.getFullYear() + '/' + (lastContractDate.getMonth() + 1).toString().padStart(2, '0') + '/' + lastContractDate.getDate().toString().padStart(2, '0');


                if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                    $("#DealingMechanism").text(RenterInformation.enDealingMechanism);
                    $("#Membership").text(RenterInformation.enMembership);
                }
                else {
                    $("#DealingMechanism").text(RenterInformation.arDealingMechanism);
                    $("#Membership").text(RenterInformation.arMembership);
                }
                $("#FirstVisit").text(formattedFirstVisit);
                $("#LastContract").text(formattedLastContract);
                $("#ActiveContractsCount").text(RenterInformation.activeContractsCount);
                $("#ClosedContractsCount").text(RenterInformation.closedContractsCount);
                $("#RentalDays").text(RenterInformation.rentalDays);
                $("#KMCut").text(RenterInformation.kmCut.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 }));
                $("#AmountsTraded").text(RenterInformation.amountsTraded.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                $("#BalanceRenter").text(RenterInformation.balance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                $("#ReservedBalance").text(RenterInformation.reservedBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                $("#AvailableBalance").text(RenterInformation.availableBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
            }
        }

        //Restart Driver values
        $(document).ready(function () {
            var initialRenterID = $('#Contract_DriverInfo_CrMasRenterInformationId').val();
            $('#Contract_DriverInfo_CrMasRenterInformationId').on('change', function () {
                // Check if the value has changed
                if ($(this).val() !== initialRenterID) {
                    // Clear previous data and style
                    EmptyDriverInput();
                    EmptyAddDriverRequiredInputs();
                    DriverInformation = null;
                    AddDriverInformation = null;
                    CheckIfDriverIdExist = false;
                    CheckIfAddDriverIdExist = false;
                    $(".requird-field").text('');

                    $("#nationality-type-driver").val('');
                    $("#birth-date-driver").val("");
                    $(".hidden-input-row-driver").hide();
                    $("#seacrh_icon_Driver").hide();
                    $("#CheckDriver").show();
                    $("#country-code").val($("#country-code option:first").val());
                    $("#CheckModal-PhoneInput").val('');
                    CheckIfConfirmByPhone = false;
                    clearPaymentData();
                    // Update the initial value of RenterID
                    initialRenterID = $(this).val();
                }
            });
        });
        function EmptyDriverInput() {
            $("#AR-name-driver").val('');
            $("#EN-name-driver").val('');
            $("#AR-adress-driver").val('');
            $("#EN-adress-driver").val('');
            $("#Region-city-driver-code").val('');
            $("#Region-city-driver").val('');
            $("#driver-workplace-code").val('');
            $("#Profession-driver").val('');
            $("#Email-driver").val('');
            $("#Reasons-driver").val('');
            $("#licence-driver-number").val("");
            $("#licence-driver-type").val("");
            $("#ExpiryDrivingLicenseDate-driver").val("");
            $("#seacrh_icon_Driver").hide();
            $('.genderDriver[type="radio"]').prop('checked', false);
            var idType = document.getElementById("nationality-type-driver").value;
            if (parseInt(idType) > 5) {
                // Disable all input fields
                $('.genderDriver[type="radio"]').prop('checked', false);
                // Remove the div with id 'divGenderRenter'
                $('#divGenderDriver').remove();
            }
            $("#nationality-driver").val('');
            $("#driver-workplace").val('');
            $("#Region-city-driver").val('');
            document.getElementById("addational-driver").checked = false;
            // Auto Focus
            if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                setTimeout(() => {
                    $("#EN-name-driver").focus();
                }, 500);
            } else {
                setTimeout(() => {
                    $("#AR-name-driver").focus();
                }, 500);
            }
        }
        function EmptyDriverRequiredInputs() {
            // setDateForInputField("birth-date-driver", "");
            $("#birth-date-driver").val("");
            $("#nationality-type-driver").val('');
            $("#Contract_DriverInfo_CrMasRenterInformationId").val('');
            $(".hidden-input-row-driver").hide();
            DriverInformation = null;
            EmptyDriverInput();
        }
        function disableAllInputsForDriver() {
            const fieldset = document.querySelector('.disable-all-inputs');
            const inputs = fieldset.querySelectorAll('input, select,radio');
            inputs.forEach(input => {
                // Apply readonly and enable state to all inputs except hidden inputs, textareas, and buttons
                if (input.tagName.toLowerCase() === 'select') {
                    input.disabled = true; // Make select non-interactive
                } else if (input.type !== 'hidden' && input.tagName.toLowerCase() !== 'textarea' && input.type !== 'button' && input.type !== 'submit') {
                    input.readOnly = true; // Make input non-editable
                    input.disabled = true; // Ensure input is not disabled
                }
                // Special case for specific inputs
                if (input.id === 'licence-driver-number' || input.id === 'ExpiryDrivingLicenseDate-driver' || input.id === 'licence-driver-type' || input.id === 'addational-driver') {
                    input.readOnly = false;
                    input.disabled = false;
                }
            });
            $("#CheckDriver").hide();
            $(".hidden-input-row-driver").show();
        }
        function enableAllInputsForDriver() {
            const fieldset = document.querySelector('.disable-all-inputs');
            const inputs = fieldset.querySelectorAll('input, select, radio');
            inputs.forEach(input => {
                // Apply readOnly and enabled state to all inputs except hidden inputs, textareas, and buttons
                if (input.tagName.toLowerCase() === 'select') {
                    input.disabled = false; // Make select interactive
                } else if (input.type !== 'hidden' && input.tagName.toLowerCase() !== 'textarea' && input.type !== 'button' && input.type !== 'submit') {
                    input.readOnly = false; // Make input editable
                    input.disabled = false; // Ensure input is not disabled
                }
                // Special case for specific inputs
                if (input.id === 'licence-driver-number' || input.id === 'ExpiryDrivingLicenseDate-driver' || input.id === 'licence-driver-type') {
                    input.readOnly = false;
                    input.disabled = false;
                }
            });
            $(".hidden-input-row-driver").hide();
            $("#CheckDriver").show();
        }
        function SaveDriverInfo() {
            // Collect form data
            var formData = {
                CrMasRenterInformationId: $("#Contract_DriverInfo_CrMasRenterInformationId").val(),
                CrMasRenterInformationIdtype: $("#nationality-type").val(),
                // CrMasRenterInformationBirthDate: $("#birth-date").val(),
                BirthDate: $("#birth-date-driver").val(),
                CrMasRenterInformationArName: $("#AR-name-driver").val(),
                CrMasRenterInformationEnName: $("#EN-name-driver").val(),
                CrMasRenterInformationArAddress: $("#AR-adress-driver").val(),
                CrMasRenterInformationEnAddress: $("#EN-adress-driver").val(),
                CrMasRenterInformationCity: $("#Region-city-driver-code").val(),
                CityText: $("#Region-city-driver").val(),
                CrMasRenterInformationEmployer: $("#driver-workplace-code").val(),
                CrMasRenterInformationEmployerName: $("#driver-workplace").val(),
                CrMasRenterInformationProfession: $("#Profession-driver").val(),
                CrMasRenterInformationEmail: $("#Email-driver").val(),
                CrMasRenterInformationReasons: $("#Reasons-driver").val(),
                CrMasRenterInformationGender: $('.genderDriver[type="radio"]:checked').val(),
                CrMasRenterInformationNationality: $("#nationality-driver-code").val(),
                CrMasRenterInformationCountreyKey: codeCountryForRenter,
                CrMasRenterInformationMobile: phoneForRenter,
                CrMasRenterInformationRenterIdImage: $("#DriverIdImg").val(),
                CrMasRenterInformationDrivingLicenseNo: $("#licence-driver-number").val(),
                CrMasRenterInformationDrivingLicenseType: $("#licence-driver-type").val(),
                ExpiryLicenseDate: $("#ExpiryDrivingLicenseDate-driver").val(),
                // Add more fields as needed
            };
            $.ajax({
                url: "/BS/Contract/AddRenterInformation",
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function (response) {
                    DriverInformation = response;
                    console.log("DriverInformation", DriverInformation);
                    if (response != null) {
                        return true; // Renter exists
                    }
                },
                error: function (xhr, status, error) {
                    toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                    toastr.error('@localizer["SomethingWrongPleaseCallAdmin"]');
                    return false; // Error occurred or Renter doesn't exist
                }
            });
        }
        function SetInformationForDriver() {
            if (DriverInformation != null) {
                document.getElementById("AR-name-driver").value = DriverInformation.personalArName;
                document.getElementById("EN-name-driver").value = DriverInformation.personalEnName;
                document.getElementById("AR-adress-driver").value = DriverInformation.postArNameConcenate;
                document.getElementById("EN-adress-driver").value = DriverInformation.postEnNameConcenate;
                document.getElementById("nationality-driver-code").value = DriverInformation.nationalityCode;
                document.getElementById("Region-city-driver-code").value = DriverInformation.cityCode;
                document.getElementById("driver-workplace-code").value = DriverInformation.employerCode;
                document.getElementById("Profession-driver").value = DriverInformation.professionsCode;
                document.getElementById("Email-driver").value = DriverInformation.personalEmail;
                document.getElementById("licence-driver-number").value = DriverInformation.licenseCode;
                document.getElementById("licence-driver-type").value = DriverInformation.licenseType;
                document.getElementById("ExpiryDrivingLicenseDate-driver").value = DriverInformation.licenseExpiryDate ? DriverInformation.licenseExpiryDate.split('T')[0] : '';
                document.getElementById("mobile-driver").value = phoneForDriver;
                document.getElementById("keyCountry-driver").value = codeCountryForDriver;
                // Set the selected radio button by id
                var radioButtonId = "genderDriver-" + DriverInformation.genderCode;
                $("#" + radioButtonId).prop('checked', true);
                var idType = document.getElementById("nationality-type-driver").value;
                if (parseInt(idType) > 5) {
                    // Disable all input fields
                    $('.genderDriver[type="radio"]').prop('checked', false);
                    // Remove the div with id 'divGenderRenter'
                    $('#divGenderDriver').remove();
                }
                if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                    document.getElementById("nationality-driver").value = DriverInformation.personalEnNationality;
                    document.getElementById("driver-workplace").value = DriverInformation.employerEnName;
                    document.getElementById("Region-city-driver").value = DriverInformation.cityEn;
                    setTimeout(() => {
                        $("#EN-name-driver").focus();
                    }, 500);
                }
                else {
                    document.getElementById("nationality-driver").value = DriverInformation.personalArNationality;
                    document.getElementById("driver-workplace").value = DriverInformation.employerArName;
                    document.getElementById("Region-city-driver").value = DriverInformation.cityAr;
                    setTimeout(() => {
                        $("#AR-name-driver").focus();
                    }, 500);
                }
                // Auto Focus
                CheckIfDriverHaveContractsBefore();
            }
            else {
                EmptyDriverInput();
            }
        }
        function SetRenterIsDriverInformation() {
            // Copy tenant information to driver information
            disableAllInputsForDriver();
            DriverInformation = { ...RenterInformation };

            // Map each property from DriverInformation to the corresponding element in the DOM
            document.getElementById("Contract_DriverInfo_CrMasRenterInformationId").value = DriverInformation.renterID;
            document.getElementById("nationality-type-driver").value = DriverInformation.renterIDType;
            document.getElementById("AR-name-driver").value = DriverInformation.personalArName;
            document.getElementById("EN-name-driver").value = DriverInformation.personalEnName;
            document.getElementById("AR-adress-driver").value = DriverInformation.postArNameConcenate;
            document.getElementById("EN-adress-driver").value = DriverInformation.postEnNameConcenate;
            document.getElementById("nationality-driver-code").value = DriverInformation.nationalityCode;
            document.getElementById("Region-city-driver-code").value = DriverInformation.cityCode;
            document.getElementById("driver-workplace-code").value = DriverInformation.employerCode;
            document.getElementById("Profession-driver").value = DriverInformation.professionsCode;
            document.getElementById("Email-driver").value = DriverInformation.personalEmail;
            document.getElementById("nationality-driver").value = DriverInformation.personalArNationality || DriverInformation.personalEnNationality;
            document.getElementById("driver-workplace").value = DriverInformation.employerArName || DriverInformation.employerEnName;
            document.getElementById("Region-city-driver").value = DriverInformation.cityAr || DriverInformation.cityEn;
            document.getElementById("mobile-driver").value = DriverInformation.mobileNumber
            document.getElementById("keyCountry-driver").value = DriverInformation.keyCountry
            document.getElementById("licence-driver-number").value = DriverInformation.licenseCode;
            document.getElementById("licence-driver-type").value = DriverInformation.licenseType;
            document.getElementById("ExpiryDrivingLicenseDate-driver").value = DriverInformation.licenseExpiryDate ? DriverInformation.licenseExpiryDate.split('T')[0] : '';

            // Handle date elements
            $("#birth-date-driver").val(DriverInformation.birthDate);

            // Copy tenant gender to driver gender
            var driverGenderRadioButton = document.getElementById("genderDriver-" + DriverInformation.genderCode);
            if (driverGenderRadioButton) {
                driverGenderRadioButton.checked = true;
            }
            document.querySelectorAll('.genderDriver').forEach(function (element) {
                element.disabled = true;
            });
            // Auto Focus
            setTimeout(() => {
                $("#licence-driver-number").focus();
            }, 500);
            // Handle ID type specifics
            var idType = DriverInformation.renterIDType;
            if (parseInt(idType) > 5) {
                $('.genderDriver[type="radio"]').prop('checked', false);
                $('#divGenderDriver').remove();
            }
            $(".hidden-input-row-driver").show();
        }
        function SetInformationForDriverIfNotExist() {
            // Personal Information
            if (DriverInformation == null) {
                DriverInformation = { ...modelPersonal };
            }
            DriverInformation.renterID = document.getElementById("Contract_DriverInfo_CrMasRenterInformationId").value;
            DriverInformation.renterIDType = document.getElementById("nationality-type-driver").value;
            DriverInformation.birthDate = document.getElementById("birth-date-driver").value;
            DriverInformation.personalArName = document.getElementById("AR-name-driver").value;
            DriverInformation.personalEnName = document.getElementById("EN-name-driver").value;
            DriverInformation.postArNameConcenate = document.getElementById("AR-adress-driver").value;
            DriverInformation.postEnNameConcenate = document.getElementById("EN-adress-driver").value;
            DriverInformation.cityCode = document.getElementById("Region-city-driver-code").value;
            DriverInformation.nationalityCode = document.getElementById("nationality-driver-code").value;
            DriverInformation.employerCode = document.getElementById("driver-workplace-code").value;
            DriverInformation.professionsCode = document.getElementById("Profession-driver").value;
            DriverInformation.personalEmail = document.getElementById("Email-driver").value;
            DriverInformation.keyCountry = codeCountryForDriver;
            DriverInformation.mobileNumber = phoneForDriver;
            DriverInformation.arMembership = "مشترك";
            DriverInformation.enMembership = "Mutual";
            var selectedOption = $("#licence-driver-type option:selected");
            var enNameLicense = selectedOption.data('en') || '';
            var arNameLicense = selectedOption.data('ar') || ''; // Defaults to empty string if null or empty
            DriverInformation.licenseArName = arNameLicense;
            DriverInformation.licenseEnName = enNameLicense;
            DriverInformation.licenseCode = document.getElementById("licence-driver-number").value;
            DriverInformation.licenseType = document.getElementById("licence-driver-type").value;
            DriverInformation.licenseExpiryDate = document.getElementById("ExpiryDrivingLicenseDate-driver").value;
            document.getElementById("mobile-driver").value = phoneForDriver;
            document.getElementById("keyCountry-driver").value = codeCountryForDriver;
            DriverInformation.reasons = document.getElementById("Reasons-driver").value;

            // Handle the selected radio button for gender
            var selectedGenderRadio = document.querySelector('input[name="Contract.DriverInfo.CrMasRenterInformationGender"]:checked');
            if (selectedGenderRadio) {
                DriverInformation.genderCode = selectedGenderRadio.value;
                DriverInformation.personalEnGender = selectedGenderRadio.getAttribute('data-en') || '';
                DriverInformation.personalArGender = selectedGenderRadio.getAttribute('data-ar') || ''; // Defaults to an empty string if null or empty
            }

            // Handle the idType and disable inputs if necessary
            var idType = document.getElementById("nationality-type-driver").value;
            if (parseInt(idType) > 5) {
                $('.genderDriver[type="radio"]').prop('checked', false);
                $('#divGenderDriver').remove();
            }

            // Handle culture-specific settings
            if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                DriverInformation.personalEnNationality = document.getElementById("nationality-driver").value;
                DriverInformation.employerEnName = document.getElementById("driver-workplace").value;
                DriverInformation.cityEn = document.getElementById("Region-city-driver").value;
            } else {
                DriverInformation.personalArNationality = document.getElementById("nationality-driver").value;
                DriverInformation.employerArName = document.getElementById("driver-workplace").value;
                DriverInformation.cityAr = document.getElementById("Region-city-driver").value;
            }
            // Auto Focus
            console.log("DriverInformation", DriverInformation);
        }
        function CheckIfDriverHaveContractsBefore() {
            if (DriverInformation && DriverInformation.countContracts > 0) {
                $("#seacrh_icon_Driver").show();
                var firstVisitDate = new Date(DriverInformation.firstVisit);
                var lastContractDate = new Date(DriverInformation.lastContract);
                // Format the dates as "yyyy/MM/dd"
                var formattedFirstVisit = firstVisitDate.getFullYear() + '/' + (firstVisitDate.getMonth() + 1).toString().padStart(2, '0') + '/' + firstVisitDate.getDate().toString().padStart(2, '0');
                var formattedLastContract = lastContractDate.getFullYear() + '/' + (lastContractDate.getMonth() + 1).toString().padStart(2, '0') + '/' + lastContractDate.getDate().toString().padStart(2, '0');
                if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                    $("#DealingMechanismDriver").text(DriverInformation.enDealingMechanism);
                    $("#MembershipDriver").text(DriverInformation.enMembership);
                }
                else {
                    $("#DealingMechanismDriver").text(DriverInformation.arDealingMechanism);
                    $("#MembershipDriver").text(DriverInformation.arMembership);
                }
                $("#FirstVisitDriver").text(formattedFirstVisit);
                $("#LastContractDriver").text(formattedLastContract);
                $("#ActiveContractsCountDriver").text(DriverInformation.activeContractsCount);
                $("#ClosedContractsCountDriver").text(DriverInformation.closedContractsCount);
                $("#RentalDaysDriver").text(DriverInformation.rentalDays);
                $("#KMCutDriver").text(DriverInformation.kmCut);
                $("#AmountsTradedDriver").text(DriverInformation.amountsTraded.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                $("#BalanceDriver").text(DriverInformation.balance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                $("#AvailableBalanceDriver").text(DriverInformation.reservedBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                $("#ReservedBalanceDriver").text(DriverInformation.availableBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
            }
        }
        // Add Driver
        $(document).ready(function () {
            var initialID = $('#Contract_AddDriverInfo_CrMasRenterInformationId').val();
            $('#Contract_AddDriverInfo_CrMasRenterInformationId').on('change', function () {
                // Check if the value has changed
                if ($(this).val() !== initialID) {
                    // Clear previous data and style
                    EmptyAddDriverInput();
                    AddDriverInformation = null;
                    CheckIfAddDriverIdExist = false;
                    $(".requird-field").text('');

                    $("#nationality-type-addDriver").val('');
                    $("#birth-date-addDriver").val("");
                    $(".hidden-input-row-addDriver").hide();
                    $("#seacrh_icon_AddDriver").hide();
                    $("#CheckAddDriver").show();
                    $("#country-code").val($("#country-code option:first").val());
                    $("#CheckModal-PhoneInput").val('');
                    CheckIfConfirmByPhone = false;
                    clearPaymentData();
                    // Update the initial value of RenterID
                    initialID = $(this).val();
                }
            });
        });
        function EmptyAddDriverInput() {
            $("#AR-name-addDriver").val('');
            $("#EN-name-addDriver").val('');
            $("#AR-adress-addDriver").val('');
            $("#EN-adress-addDriver").val('');
            $("#Region-city-addDriver-code").val('');
            $("#Region-city-addDriver").val('');
            $("#addDriver-workplace-code").val('');
            $("#Profession-addDriver").val('');
            $("#Email-addDriver").val('');
            $("#Reasons-addDriver").val('');
            $("#licence-addDriver-number").val("");
            $("#licence-addDriver-type").val("");
            $("#ExpiryDrivingLicenseDate-addDriver").val("");
            $('.genderAddDriver[type="radio"]').prop('checked', false);
            var idType = document.getElementById("nationality-type-addDriver").value;
            if (parseInt(idType) > 5) {
                // Disable all input fields
                $('.genderAddDriver[type="radio"]').prop('checked', false);
                // Remove the div with id 'divGenderRenter'
                $('#divGenderAddDriver').remove();
            }
            $("#nationality-addDriver").val('');
            $("#addDriver-workplace").val('');
            $("#Region-city-addDriver").val('');
            // Auto Focus
            if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                setTimeout(() => {
                    $("#EN-name-addDriver").focus();
                }, 500);
            } else {
                setTimeout(() => {
                    $("#AR-name-addDriver").focus();
                }, 500);
            }

        }
        function EmptyAddDriverRequiredInputs() {
            // setDateForInputField("birth-date-addDriver", "");
            $("#birth-date-AddDriver").val("");
            $("#nationality-type-addDriver").val('');
            $("#Contract_AddDriverInfo_CrMasRenterInformationId").val('');
            $(".hidden-input-row-addDriver").hide();
            AddDriverInformation = null;
            EmptyAddDriverInput();
            console.log("Run EmptyAddDriverRequiredInputs")
        }
        function SetInformationForAddDriver() {
            if (AddDriverInformation != null) {
                document.getElementById("AR-name-addDriver").value = AddDriverInformation.personalArName;
                document.getElementById("EN-name-addDriver").value = AddDriverInformation.personalEnName;
                document.getElementById("AR-adress-addDriver").value = AddDriverInformation.postArNameConcenate;
                document.getElementById("EN-adress-addDriver").value = AddDriverInformation.postEnNameConcenate;
                document.getElementById("nationality-addDriver-code").value = AddDriverInformation.nationalityCode;
                document.getElementById("Region-city-addDriver-code").value = AddDriverInformation.cityCode;
                document.getElementById("addDriver-workplace-code").value = AddDriverInformation.employerCode;
                document.getElementById("Profession-addDriver").value = AddDriverInformation.professionsCode;
                document.getElementById("Email-addDriver").value = AddDriverInformation.personalEmail;
                document.getElementById("licence-addDriver-number").value = AddDriverInformation.licenseCode;
                document.getElementById("licence-addDriver-type").value = AddDriverInformation.licenseType;
                document.getElementById("ExpiryDrivingLicenseDate-addDriver").value = AddDriverInformation.licenseExpiryDate.split('T')[0];
                document.getElementById("Reasons-addDriver").value = AddDriverInformation.reasons;
                // Set the selected radio button by id
                var radioButtonId = "genderAddDriver-" + AddDriverInformation.genderCode;
                $("#" + radioButtonId).prop('checked', true);
                var idType = document.getElementById("nationality-type-addDriver").value;
                if (parseInt(idType) > 5) {
                    // Disable all input fields
                    $('.genderAddDriver[type="radio"]').prop('checked', false);
                    // Remove the div with id 'divGenderRenter'
                    $('#divGenderAddDriver').remove();
                }
                if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                    document.getElementById("nationality-addDriver").value = AddDriverInformation.personalEnNationality;
                    document.getElementById("addDriver-workplace").value = AddDriverInformation.employerEnName;
                    document.getElementById("Region-city-addDriver").value = AddDriverInformation.cityEn;
                    setTimeout(() => {
                        $("#EN-name-addDriver").focus();
                    }, 500);
                }
                else {
                    document.getElementById("nationality-addDriver").value = AddDriverInformation.personalArNationality;
                    document.getElementById("addDriver-workplace").value = AddDriverInformation.employerArName;
                    document.getElementById("Region-city-addDriver").value = AddDriverInformation.cityAr;
                    setTimeout(() => {
                        $("#AR-name-addDriver").focus();
                    }, 500);
                }
                // Auto Focus
                CheckIfAddDriverHaveContractsBefore();
            }
            else {
                EmptyAddDriverInput();
            }
        }
        function SetInformationForAddDriverIfNotExist() {
            // Personal Information
            if (AddDriverInformation == null) {
                AddDriverInformation = { ...modelPersonal };
            }
            AddDriverInformation.renterID = document.getElementById("Contract_AddDriverInfo_CrMasRenterInformationId").value;
            AddDriverInformation.renterIDType = document.getElementById("nationality-type-addDriver").value;
            AddDriverInformation.birthDate = document.getElementById("birth-date-AddDriver").value;
            AddDriverInformation.personalArName = document.getElementById("AR-name-addDriver").value;
            AddDriverInformation.personalEnName = document.getElementById("EN-name-addDriver").value;
            AddDriverInformation.postArNameConcenate = document.getElementById("AR-adress-addDriver").value;
            AddDriverInformation.postEnNameConcenate = document.getElementById("EN-adress-addDriver").value;
            AddDriverInformation.cityCode = document.getElementById("Region-city-addDriver-code").value;
            AddDriverInformation.nationalityCode = document.getElementById("nationality-addDriver-code").value;
            AddDriverInformation.employerCode = document.getElementById("addDriver-workplace-code").value;
            AddDriverInformation.professionsCode = document.getElementById("Profession-addDriver").value;
            AddDriverInformation.personalEmail = document.getElementById("Email-addDriver").value;
            var selectedOption = $("#licence-addDriver-type option:selected");
            var enNameLicense = selectedOption.data('en') || '';
            var arNameLicense = selectedOption.data('ar') || ''; // Defaults to empty string if null or empty
            AddDriverInformation.licenseArName = arNameLicense;
            AddDriverInformation.licenseEnName = enNameLicense;
            AddDriverInformation.licenseCode = document.getElementById("licence-addDriver-number").value;
            AddDriverInformation.licenseType = document.getElementById("licence-addDriver-type").value;
            AddDriverInformation.licenseExpiryDate = document.getElementById("ExpiryDrivingLicenseDate-addDriver").value;
            AddDriverInformation.keyCountry = codeCountryForAddDriver;
            AddDriverInformation.mobileNumber = phoneForAddDriver;
            AddDriverInformation.arMembership = "مشترك";
            AddDriverInformation.enMembership = "Mutual";
            document.getElementById("Contract_AddDriverInfo_CrMasRenterInformationMobile").value = phoneForAddDriver;
            document.getElementById("Contract_AddDriverInfo_CrMasRenterInformationCountreyKey").value = codeCountryForAddDriver;
            AddDriverInformation.reasons = document.getElementById("Reasons-addDriver").value;

            // Handle the selected radio button for gender
            var selectedGenderRadio = document.querySelector('input[name="Contract.AddDriverInfo.CrMasRenterInformationGender"]:checked');
            if (selectedGenderRadio) {
                AddDriverInformation.genderCode = selectedGenderRadio.value;
                AddDriverInformation.personalEnGender = selectedGenderRadio.getAttribute('data-en') || '';
                AddDriverInformation.personalArGender = selectedGenderRadio.getAttribute('data-ar') || ''; // Defaults to an empty string if null or empty
            }

            // Handle the idType and disable inputs if necessary
            var idType = document.getElementById("nationality-type-addDriver").value;
            if (parseInt(idType) > 5) {
                $('.genderAddDriver[type="radio"]').prop('checked', false);
                $('#divGenderAddDriver').remove();
            }

            // Handle culture-specific settings
            if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                AddDriverInformation.personalEnNationality = document.getElementById("nationality-addDriver").value;
                AddDriverInformation.employerEnName = document.getElementById("addDriver-workplace").value;
                AddDriverInformation.cityEn = document.getElementById("Region-city-addDriver").value;
                setTimeout(() => {
                    $("#EN-name-addDriver").focus();
                }, 500);
            } else {
                AddDriverInformation.personalArNationality = document.getElementById("nationality-addDriver").value;
                AddDriverInformation.employerArName = document.getElementById("addDriver-workplace").value;
                AddDriverInformation.cityAr = document.getElementById("Region-city-addDriver").value;
                setTimeout(() => {
                    $("#AR-name-addDriver").focus();
                }, 500);
            }
            console.log("AddDriverInformation", AddDriverInformation);
        }
        function CheckIfAddDriverHaveContractsBefore() {
            if (AddDriverInformation && AddDriverInformation.countContracts > 0) {
                $("#seacrh_icon_AddDriver").show();
                var firstVisitDate = new Date(AddDriverInformation.firstVisit);
                var lastContractDate = new Date(AddDriverInformation.lastContract);
                // Format the dates as "yyyy/MM/dd"
                var formattedFirstVisit = firstVisitDate.getFullYear() + '/' + (firstVisitDate.getMonth() + 1).toString().padStart(2, '0') + '/' + firstVisitDate.getDate().toString().padStart(2, '0');
                var formattedLastContract = lastContractDate.getFullYear() + '/' + (lastContractDate.getMonth() + 1).toString().padStart(2, '0') + '/' + lastContractDate.getDate().toString().padStart(2, '0');
                $("#FirstVisitAddDriver").text(formattedFirstVisit);
                $("#LastContractAddDriver").text(formattedLastContract);
                if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                    $("#DealingMechanismAddDriver").text(AddDriverInformation.enDealingMechanism);
                    $("#MembershipAddDriver").text(AddDriverInformation.enMembership);
                } else {
                    $("#DealingMechanismAddDriver").text(AddDriverInformation.arDealingMechanism);
                    $("#MembershipAddDriver").text(AddDriverInformation.arMembership);
                }
                $("#ActiveContractsCountAddDriver").text(AddDriverInformation.activeContractsCount);
                $("#ClosedContractsCountAddDriver").text(AddDriverInformation.closedContractsCount);
                $("#RentalDaysAddDriver").text(AddDriverInformation.rentalDays);
                $("#KMCutAddDriver").text(AddDriverInformation.kmCut);
                $("#AmountsTradedAddDriver").text(AddDriverInformation.amountsTraded.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                $("#BalanceAddDriver").text(AddDriverInformation.balance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                $("#AvailableBalanceAddDriver").text(AddDriverInformation.reservedBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                $("#ReservedBalanceAddDriver").text(AddDriverInformation.availableBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
            }
        }

        var current_fs, next_fs, previous_fs;
        var tab = 1;
        var currentField = "";
        var NextField = "";
        var PreviousField = "";
        $(document).on("click", ".next", async function () {
            current_fs = $(this).closest("fieldset");
            next_fs = $(this).closest("fieldset").next();
            currentField = $("#progressbar li").eq($("fieldset").index(current_fs))[0].id;
            NextField = $("#progressbar li").eq($("fieldset").index(next_fs))[0].id;
            PreviousField = $("#progressbar li").eq($("fieldset").index(next_fs))[0].id;
            if (currentField === "tenant") {
                if ($("#msform").valid()) {
                    if (CheckIfConfirmByPhone) {
                        if (!listsIsTrueOrNotRenter) {
                            console.log("listsIsTrueOrNotRenter", listsIsTrueOrNotRenter)
                            toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                            toastr.error('@localizer["PleaseCheckInputs"]');
                            return;
                        }
                        SetInformationForRenterIfNotExist();
                        var dateTimeNow = decodeHTMLEntities('@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fffK")');
                        var currentDate = new Date(dateTimeNow);
                        var city = RenterInformation.cityCode;
                        var employeerWorkPlace = $("tenant-workplace").val();
                        var id = true;
                        var address = true;
                        var employeer = true;
                        var chechAuthUser;
                        CheckSigntureImgForRenter();
                        // var ExpiryIdDateRenter = new Date(RenterInformation.expiryIdDate);
                        // if (ExpiryIdDateRenter < currentDate) {
                        //     id = false;
                        // }
                        if (city == null || city == "") {
                            address = false;
                        }
                        if (employeerWorkPlace == null || employeerWorkPlace == "") {
                            employeer = false;
                        }
                        // This Check to If Renter Need Private Driver Or not
                        var privateDriverRadio1 = document.getElementById("PrivateDriver");
                        var privateDriverID = $("#Private-Driver-selectt").val();
                        if (privateDriverRadio1.checked && privateDriverID == null) {
                            $("#PrivateDriverRequired").text('@localizer["PleaseChooseYourDriver"]').css("color", "red");
                        }
                        else {
                            if (privateDriverRadio1.checked && privateDriverID != null) {
                                // await GetPersonInformation(privateDriverID, "privateDriver");
                                await GetPrivateDriverInformation(privateDriverID);
                                $("#PrivateDriverRequired").text('').css("color", "");
                                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                next_fs.show();
                                current_fs.hide();
                                tab++;
                            }
                            else if (!id || !address || !employeer) {
                                $.ajax({
                                    url: "/BS/Contract/CheckAuthUser", // Replace YourController with your actual controller name
                                    type: "GET",
                                    data: { id: id, address: address, employeer: employeer },
                                    success: function (data) {
                                        var check = data;
                                        if (check == "id") {
                                            $("#PrivateDriverRequired").text('').css("color", "");
                                            toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                            toastr.error('@localizer["IdIsExpriredAndYouNotAuth"]');
                                            return;
                                        }
                                        else if (check == "address") {
                                            $("#PrivateDriverRequired").text('').css("color", "");
                                            toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                            toastr.error('@localizer["AddressIsExpriredAndYouNotAuth"]');
                                            return
                                        }
                                        else if (check == "employeer") {
                                            $("#PrivateDriverRequired").text('').css("color", "");
                                            toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                            toastr.error('@localizer["EmployerIsExpriredAndYouNotAuth"]');
                                            return
                                        }
                                        else {
                                            $("#PrivateDriverRequired").text('').css("color", "");
                                            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                            next_fs.show();
                                            current_fs.hide();
                                            tab++;
                                        }
                                    }
                                });
                            }
                        }
                    }
                    else {
                        toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                        toastr.error('@localizer["PleaseCheckFirst"]');
                        return;
                    }
                }
                else {
                    // Find the first invalid input field
                    focusFirstInvalidInput();
                }
            }
            else if (currentField === "car") {
                var driverRadio1 = document.getElementById("RenterIsdriver");
                var privateDriverRadio1 = document.getElementById("PrivateDriver");
                var privateDriverID = $("#Private-Driver-selectt").val();
                SerialNumberOfCar = $(this).find(".CarInfo").data("serial-number");
                PriceNumberOfCar = $(this).find(".CarInfo").data("price-number");
                $("#Contract_SerialNo").val(SerialNumberOfCar);
                $("#Contract_PriceNo").val(PriceNumberOfCar);
                GetAdvantagesValue(PriceNumberOfCar);
                GetAdvantages(PriceNumberOfCar);
                enableAllInputsForDriver();
                EmptyDriverRequiredInputs();
                EmptyAddDriverRequiredInputs();
                clearPaymentData();
                // Use Promises to ensure data is available before proceeding
                Promise.all([getCarChoices(PriceNumberOfCar), getCarAdditional(PriceNumberOfCar), GetCarInfo(SerialNumberOfCar), GetCarInfoForContract(SerialNumberOfCar)])
                    .then(([choicesData, additionalsData, carInformation, carInfoForContract]) => {
                        IsThereAdditionalDriver();
                        if (privateDriverRadio1.checked) {
                            console.log("privateDriverRadio2222", privateDriverRadio1.checked)
                            console.log("privateDriverID3333", privateDriverID)
                            document.getElementById("addational-driver").checked = false;
                            if (CarAdditionals.count == 0 && CarChoices.count == 0) {
                                currentField = "check";
                                NextField = "payment";
                                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                next_fs = $(this).closest("fieldset").next().next();
                                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                next_fs = $(this).closest("fieldset").next().next().next();
                                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                next_fs = $(this).closest("fieldset").next().next().next().next();
                                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                next_fs.show();
                                current_fs.hide();
                            }
                            else {
                                currentField = "options";
                                NextField = "check";
                                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                next_fs = $(this).closest("fieldset").next().next();
                                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                next_fs = $(this).closest("fieldset").next().next().next();
                                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                next_fs.show();
                                current_fs.hide();
                            }
                        }
                        // This Check to If driverIsRenter Or not
                        else if (driverRadio1.checked) {
                            SetRenterIsDriverInformation();
                            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                            next_fs.show();
                            current_fs.hide();
                            currentField = "driver";
                            NextField = "add-driver";
                        }
                        else {
                            document.getElementById("addational-driver").checked = false;
                            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                            next_fs.show();
                            current_fs.hide();
                            currentField = "driver";
                            NextField = "add-driver";
                            setTimeout(() => {
                                $("#Contract_DriverInfo_CrMasRenterInformationId").focus();
                            }, 500);
                        }
                    })
                    .catch((error) => {
                        console.error("Error loading data:", error);
                    });

                //////////////////////////////////////////
            }
            else if (currentField === "driver") {
                if ($("#msform").valid()) {
                    if (CheckIfConfirmByPhone) {
                        if (!listsIsTrueOrNotDriver) {
                            console.log("listsIsTrueOrNotDriver", listsIsTrueOrNotDriver)
                            toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                            toastr.error('@localizer["PleaseCheckInputs"]');
                            return;
                        }
                        if (DriverInformation == null) {
                            SetInformationForDriverIfNotExist();
                        }
                        enableAllInputsForDriver();
                        var additionalDriver = document.getElementById("addational-driver");
                        var dateTimeNow = decodeHTMLEntities('@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fffK")');
                        var BirthDateDriver = new Date($("#birth-date-driver").val());
                        var DriverAge = calculateAge(BirthDateDriver);
                        var city = $("#Region-city-driver-code").val();
                        var licenseType = $("#licence-driver-type").val();
                        var licenseNo = $("#licence-driver-number").val();
                        var employerCode = $("#driver-workplace").val();

                        var minAge = CarInformation.carPrice.crCasPriceCarBasicMinAge;
                        var maxAge = CarInformation.carPrice.crCasPriceCarBasicMaxAge;
                        // All Values Bool to send it to backend to check auth user
                        var id = true;
                        var address = true;
                        var license = true;
                        var isAgeInRange = DriverAge >= minAge && DriverAge <= maxAge;
                        var employer = true;


                        // Driver Address
                        if (city == null || city == "") {
                            address = false;
                        }
                        // Driver license
                        if (licenseType === '2' || licenseType === '1' || licenseType == null || licenseType == "" || licenseNo == null || licenseNo == "") {
                            license = false;
                        }
                        // Driver employeer
                        if (employerCode === '1800000002' || employerCode === '1800000001' || employerCode == "" || employerCode == null) {
                            employer = false;
                        }
                        var check = "";
                        var Authrize = true;
                        if (!(id && address && license && isAgeInRange && employer)) {
                            if (id == false && "@user.CrMasUserContractValidity.CrMasUserContractValidityId" == "False") {
                                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                toastr.error('@localizer["IdIsExpriredAndYouNotAuth"]');
                                return;
                            }
                            else if (address == false && "@user.CrMasUserContractValidity.CrMasUserContractValidityRenterAddress" == "False") {
                                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                toastr.error('@localizer["AddressIsExpriredAndYouNotAuth"]');
                                return
                            }
                            else if (license == false && "@user.CrMasUserContractValidity.CrMasUserContractValidityDrivingLicense" == "False") {
                                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                toastr.error('@localizer["LicenseIsExpriredAndYouNotAuth"]');
                                return
                            }
                            else if (isAgeInRange == false && "@user.CrMasUserContractValidity.CrMasUserContractValidityAge" == "False") {
                                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                toastr.error('@localizer["AgeIsExpriredAndYouNotAuth"]');
                                return
                            }
                            else if (employer == false && "@user.CrMasUserContractValidity.CrMasUserContractValidityEmployer" == "False") {
                                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                toastr.error('@localizer["EmployerIsExpriredAndYouNotAuth"]');
                                return
                            }
                            else {
                                if (additionalDriver.checked) {
                                    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                    next_fs.show();
                                    current_fs.hide();
                                    currentField = "add-driver";
                                    NextField = "options";
                                    setTimeout(() => {
                                        $("#Contract_AddDriverInfo_CrMasRenterInformationId").focus();
                                    }, 500);
                                }
                                else {
                                    EmptyAddDriverRequiredInputs();
                                    if (CarChoices.count == 0 && CarAdditionals.count == 0) {
                                        $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                        next_fs = $(this).closest("fieldset").next().next();
                                        $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                        next_fs = $(this).closest("fieldset").next().next().next();
                                        $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                        next_fs.show();
                                        current_fs.hide();
                                        currentField = "check";
                                        NextField = "payment";
                                    }
                                    else {
                                        $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                        next_fs = $(this).closest("fieldset").next().next();
                                        $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                        next_fs.show();
                                        current_fs.hide();
                                        currentField = "options";
                                        NextField = "check";
                                    }
                                }
                            }
                        }
                        else {
                            if (additionalDriver.checked) {
                                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                next_fs.show();
                                current_fs.hide();
                                currentField = "add-driver";
                                NextField = "options";
                                setTimeout(() => {
                                    $("#Contract_AddDriverInfo_CrMasRenterInformationId").focus();
                                }, 500);
                            }
                            else {
                                EmptyAddDriverRequiredInputs();
                                if (CarChoices.count == 0 && CarAdditionals.count == 0) {
                                    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                    next_fs = $(this).closest("fieldset").next().next();
                                    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                    next_fs = $(this).closest("fieldset").next().next().next();
                                    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                    next_fs.show();
                                    current_fs.hide();
                                    currentField = "check";
                                    NextField = "payment";
                                }
                                else {
                                    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                    next_fs = $(this).closest("fieldset").next().next();
                                    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                    next_fs.show();
                                    current_fs.hide();
                                    currentField = "options";
                                    NextField = "check";
                                }
                            }
                        }
                    }
                    else {
                        toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                        toastr.error('@localizer["PleaseCheckFirst"]');
                        return;
                    }
                }
                else {
                    // Find the first invalid input field
                    focusFirstInvalidInput();
                }
            }
            else if (currentField === "add-driver") {
                if ($("#msform").valid()) {
                    if (CheckIfConfirmByPhone) {
                        if (!listsIsTrueOrNotAddDriver) {
                            console.log("listsIsTrueOrNotAddDriver", listsIsTrueOrNotAddDriver)
                            toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                            toastr.error('@localizer["PleaseCheckInputs"]');
                            return;
                        }
                        SetInformationForAddDriverIfNotExist();
                        var dateTimeNow = decodeHTMLEntities('@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fffK")');
                        var BirthDateAddDriver = new Date($("#birth-date-AddDriver").val());
                        var AddDriverAge = calculateAge(BirthDateAddDriver);
                        var city = $("#Region-city-addDriver-code").val();
                        var licenseType = $("#licence-addDriver-type").val();
                        var licenseNo = $("#licence-addDriver-number").val();
                        var employerCode = $("#addDriver-workplace-code").val();
                        var minAge = CarInformation.carPrice.crCasPriceCarBasicMinAge;
                        var maxAge = CarInformation.carPrice.crCasPriceCarBasicMaxAge;
                        // All Values Bool to send it to backend to check auth user
                        var id = true;
                        var address = true;
                        var license = true;
                        var isAgeInRange = AddDriverAge >= minAge && AddDriverAge <= maxAge;
                        var employer = true;
                        // AddDriver Address
                        if (city == null || city == "") {
                            address = false;
                        }
                        // AddDriver license
                        // Driver license
                        if (licenseType === '2' || licenseType === '1' || licenseType == null || licenseType == "" || licenseNo == null || licenseNo == "") {
                            license = false;
                        }
                        // AddDriver employeer
                        if (employerCode === '1800000002' || employerCode === '1800000001' || employerCode == "" || employerCode == null) {
                            employer = false;
                        }

                        if (!(id && address && license && isAgeInRange && employer)) {


                            if (id == false && "@user.CrMasUserContractValidity.CrMasUserContractValidityId" == "False") {
                                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                toastr.error('@localizer["IdIsExpriredAndYouNotAuth"]');
                                return;
                            }
                            else if (address == false && "@user.CrMasUserContractValidity.CrMasUserContractValidityRenterAddress" == "False") {
                                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                toastr.error('@localizer["AddressIsExpriredAndYouNotAuth"]');
                                return
                            }
                            else if (license == false && "@user.CrMasUserContractValidity.CrMasUserContractValidityDrivingLicense" == "False") {
                                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                toastr.error('@localizer["LicenseIsExpriredAndYouNotAuth"]');
                                return
                            }
                            else if (isAgeInRange == false && "@user.CrMasUserContractValidity.CrMasUserContractValidityAge" == "False") {
                                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                toastr.error('@localizer["AgeIsExpriredAndYouNotAuth"]');
                                return
                            }
                            else if (employer == false && "@user.CrMasUserContractValidity.CrMasUserContractValidityEmployer" == "False") {
                                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                                toastr.error('@localizer["EmployerIsExpriredAndYouNotAuth"]');
                                return
                            }
                            else {
                                if (CarChoices.count == 0 && CarAdditionals.count == 0) {
                                    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                    next_fs = $(this).closest("fieldset").next().next();
                                    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                    next_fs.show();
                                    current_fs.hide();
                                    currentField = "check";
                                    NextField = "payment"
                                }
                                else {
                                    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                    next_fs.show();
                                    current_fs.hide();
                                    currentField = "options"
                                    NextField = "check"
                                }
                            }


                        }
                        else if (CarChoices.count == 0 && CarAdditionals.count == 0) {
                            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                            next_fs = $(this).closest("fieldset").next().next();
                            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                            next_fs.show();
                            current_fs.hide();
                            currentField = "check";
                            NextField = "payment"
                        }
                        else {
                            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                            next_fs.show();
                            current_fs.hide();
                            currentField = "options"
                            NextField = "check"
                        }
                    }
                    else {
                        toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                        toastr.error('@localizer["PleaseCheckFirst"]');
                        return;
                    }
                }
                else {
                    // Find the first invalid input field
                    focusFirstInvalidInput();
                }
            }
            else if (currentField === "options") {
                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                next_fs.show();
                current_fs.hide();
                currentField = "check";
                NextField = "payment";
            }
            else if (currentField === "check") {
                // Initialize variables
                IfCarChangeBranchReceiving();
                clearPaymentData();
                var allChecked = true;
                var currentMeter = true;
                var imgs = true;

                // Check checkboxes
                var checkboxes = document.querySelectorAll(".CheckUp");
                checkboxes.forEach(function (checkbox) {
                    if (!checkbox.checked) {
                        allChecked = false;
                    }
                });

                // Check currentMeterSpan
                var currentMeterSpan = $("#requird_field_CurrentMeter");
                if (currentMeterSpan.text().trim() === "") {
                } else {
                    currentMeter = false;
                }

                // Check if the div contains at least one img element
                if ($('.upload__img-box img').length > 0) {
                } else {
                    imgs = false;
                }

                // Final check
                if (imgs && currentMeter && allChecked) {
                    //Get RenterBalance
                    if (RenterInformation != null) {
                        RenterBalance = RenterInformation.availableBalance;
                        if (RenterBalance != null && RenterBalance != "" && RenterBalance != 0 && RenterBalance != undefined) {
                            document.getElementById("Balance").textContent = RenterBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        }
                    }
                    else {
                        document.getElementById("Balance").textContent = "0.00";
                        RenterBalance = 0;
                    }
                    $("#checkUpMessageRequired").text('')
                    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                    next_fs.show();
                    current_fs.hide();
                    currentField = "payment"
                    setTimeout(() => {
                        $("#dayNo").focus();
                    }, 500);
                } else {
                    $("#checkUpMessageRequired").text('@localizer["checkUpMessageRequired"]')
                }
            }
        });
        $(".previous").click(function () {
            current_fs = $(this).closest("fieldset");
            previous_fs = $(this).closest("fieldset").prev();
            var additionalDriver = document.getElementById("addational-driver");
            var privateDriverRadio1 = document.getElementById("PrivateDriver");
            var RenterIsdriver = document.getElementById("RenterIsdriver");

            if (currentField === "options") {

                // This Check to If Renter Need Private Driver Or not
                if (privateDriverRadio1.checked) {
                    // Clear previous data and style
                    EmptyDriverRequiredInputs();
                    EmptyAddDriverRequiredInputs();
                    $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                    $("#progressbar li").eq($("fieldset").index(previous_fs)).removeClass("active");
                    previous_fs = $(this).closest("fieldset").prev().prev();
                    $("#progressbar li").eq($("fieldset").index(previous_fs)).removeClass("active");
                    previous_fs = $(this).closest("fieldset").prev().prev().prev();
                    previous_fs.show();
                    current_fs.hide();
                    currentField = "car";
                    PreviousField = "tenant"
                }
                else if (additionalDriver.checked) {
                    enableAllInputsForDriver();
                    console.log("disableAllInputsForDriver", 00000000)
                    $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                    previous_fs.show();
                    current_fs.hide();
                    currentField = "add-driver"
                }
                else {
                    if (RenterIsdriver.checked) {
                        console.log("disableAllInputsForDriver", 1111111)
                        disableAllInputsForDriver();
                    }
                    $(".hidden-input-row-driver").show();
                    $("#CheckDriver").hide();
                    $("#progressbar li").eq($("fieldset").index(previous_fs)).removeClass("active");
                    previous_fs = $(this).closest("fieldset").prev().prev();
                    $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                    previous_fs.show();
                    currentField = "driver"
                    current_fs.hide();
                }
            }
            else if (currentField === "check") {
                if (privateDriverRadio1.checked) {
                    EmptyDriverRequiredInputs();
                    EmptyAddDriverRequiredInputs();
                    if (CarAdditionals.count == 0 && CarChoices.count == 0) {
                        $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                        $("#progressbar li").eq($("fieldset").index(previous_fs)).removeClass("active");
                        previous_fs = $(this).closest("fieldset").prev().prev();
                        $("#progressbar li").eq($("fieldset").index(previous_fs)).removeClass("active");
                        previous_fs = $(this).closest("fieldset").prev().prev().prev();
                        $("#progressbar li").eq($("fieldset").index(previous_fs)).removeClass("active");
                        previous_fs = $(this).closest("fieldset").prev().prev().prev().prev();
                        previous_fs.show();
                        current_fs.hide();
                        currentField = "car";
                        PreviousField = "tenant"
                    }
                    else {
                        $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                        previous_fs.show();
                        current_fs.hide();
                        currentField = "options";
                        PreviousField = "car"
                    }
                }
                else if (additionalDriver.checked && CarAdditionals.count == 0 && CarChoices.count == 0) {
                    $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                    $("#progressbar li").eq($("fieldset").index(previous_fs)).removeClass("active");
                    previous_fs = $(this).closest("fieldset").prev().prev();
                    previous_fs.show();
                    current_fs.hide();
                    currentField = "add-driver";
                    PreviousField = "driver";
                }
                else {
                    if (CarAdditionals.count == 0 && CarChoices.count == 0) {
                        $(".hidden-input-row-driver").show();
                        $("#CheckDriver").hide();
                        $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                        $("#progressbar li").eq($("fieldset").index(previous_fs)).removeClass("active");
                        previous_fs = $(this).closest("fieldset").prev().prev();
                        $("#progressbar li").eq($("fieldset").index(previous_fs)).removeClass("active");
                        previous_fs = $(this).closest("fieldset").prev().prev().prev();
                        previous_fs.show();
                        current_fs.hide();
                        currentField = "driver";
                        PreviousField = "car";
                    }
                    else {
                        $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                        previous_fs.show();
                        current_fs.hide();
                        currentField = "options";
                        PreviousField = "driver";
                    }

                }
            }
            else if (currentField === "payment") {
                $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                previous_fs.show();
                current_fs.hide();
                currentField = "check"
            }
            else {
                if (RenterIsdriver.checked) {
                    disableAllInputsForDriver();
                }
                $(".hidden-input-row-driver").show();
                $("#CheckDriver").hide();
                $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
                previous_fs.show();
                current_fs.hide();
            }
        });
        // Check If Input Required And Focus about it
        function focusFirstInvalidInput() {
            const errorInputs = [];
            document.querySelectorAll('.field-validation-error').forEach(error => {
                // Ensure that closest element exists
                const closestCol = error.closest('.requird-inputs-col');
                if (closestCol) {
                    const input = error.closest('.requird-inputs-col')?.querySelector('input, select');
                    if (input) {
                        errorInputs.push(input);
                    }
                }
            });

            // If there are invalid inputs, focus on the first one
            if (errorInputs.length > 0) {
                setTimeout(() => {
                    errorInputs[0].focus();
                }, 100);
            }
        }
        function IsThereAdditionalDriver() {
            var additionalDriver = CarInformation.carPrice.crCasPriceCarBasicIsAdditionalDriver;
            console.log("additionalDriver", additionalDriver);
            if (additionalDriver == false) {
                $("#additionalDriverDiv").hide();
            }
            else {
                $("#additionalDriverDiv").show();
            }
        }
        function GetCodeCategory(categoryCode) {
            var selectedBranch = "@Model.SelectedBranch";
            $.ajax({
                url: "/BS/Contract/GetCarsByCategory", // Replace YourController with your actual controller name
                type: "GET",
                data: { selectedCategory: categoryCode, selectedBranch: selectedBranch },
                success: function (data) {
                    $('#ListCars tbody').html(data);
                },
                error: function () {
                    alert("Error loading data.");
                }
            });
        }
        function GetCarInfo(serialNumber) {
            return new Promise((resolve, reject) => {
                $.ajax({
                    url: "/BS/Contract/GetCarInformation",
                    type: "GET",
                    data: { serialNumber: serialNumber },
                    cache: false,
                    success: function (data) {
                        resolve(data);
                        CarInformation = data;
                        $("#Contract_CurrentMeter").val(CarInformation.carInformation.crCasCarInformationCurrentMeter);
                        handleCurrentMeterInput();

                    },
                    error: function (xhr, textStatus, errorThrown) {
                        reject(errorThrown);
                    }
                });
            });
        }
        function GetCarInfoForContract(serialNumber) {
            return new Promise((resolve, reject) => {
                $.ajax({
                    url: "/BS/Contract/GetCarInfoForContract",
                    type: "GET",
                    data: { serialNumber: serialNumber },
                    cache: false,
                    success: function (data) {
                        resolve(data);
                        CarInformationForContract = data;
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        reject(errorThrown);
                    }
                });
            });
        }
        function GetAdvantagesValue(priceNumber) {
            $.ajax({
                url: "/BS/Contract/GetAdvantagesValue",
                type: "GET",
                data: { priceNumber: priceNumber },
                success: function (data) {
                    AdvantagesValue = data;
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.error("Error loading data:", textStatus, errorThrown);
                }
            });
        }
        function GetAdvantages(priceNumber) {
            $.ajax({
                url: "/BS/Contract/GetAdvantages",
                type: "GET",
                data: { priceNumber: priceNumber },
                success: function (data) {
                    CarAdvantages = data;
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.error("Error loading data:", textStatus, errorThrown);
                }
            });
        }
        function handleCurrentMeterInput() {
            // Assuming currentMeterInput is the ID of your input field
            var currentMeterInput = $("#Contract_CurrentMeter");
            var currentMeterFromDB = CarInformation.carInformation.crCasCarInformationCurrentMeter;
            var currentMeterValue = parseFloat(currentMeterFromDB) || 0;

            currentMeterInput.on("input keyup", function () {
                var enteredValue = parseFloat($(this).val()) || 0;

                // Check if the entered value is lower than the current value
                if (enteredValue < currentMeterValue) {
                    $("#requird_field_CurrentMeter").text("@localizer["requirdfieldCurrentMeter"]" + " " + currentMeterValue);
                }
                else {
                    $("#requird_field_CurrentMeter").text("")
                }
            });
        }
        function updateOptionsTable(data) {
            // Assuming 'data' is an object with 'OptionsList' property
            var optionsList = data.optionsList;

            // Get the tbody container
            var tbodyContainer = $("#optionsBody");

            // Clear existing content
            tbodyContainer.empty();
            // Check if additionalList is empty
            if (optionsList.length === 0) {
                // If no data, hide the table
                $("#OptionsList").hide();
                return;
            } else {
                // If there is data, show the table
                $("#OptionsList").show();
            }
            // Populate the tbody with the received data
            optionsList.forEach(function (option) {
                var nameLabel = "@requestCulture?.RequestCulture.UICulture.Name" === "en-US" ? option.enName : option.arName;
                var row = $("<tr>");
                var valueCell = $("<td class='text-center' data-value='" + option.optionsValue + "'>" + option.optionsValue + "</td>");
                var optionsCol = $("<td>");
                var optionsDiv = $("<div class='options-col'>");
                optionsDiv.append("<label data-en='" + option.enName + "' data-ar='" + option.arName + "' for='checkbox-" + option.optionsNo + "'>" + nameLabel + "</label>");
                optionsDiv.append("<input class='ChkChoicesList' type='checkbox' name='Additions' value='" + option.optionsCode + "' data-val='" + option.optionsValue + "' id='checkbox-" + option.optionsNo + "'>");
                optionsCol.append(optionsDiv);
                row.append(valueCell);
                row.append(optionsCol);
                tbodyContainer.append(row);
            });

            // Add the total row
            var totalRow = $("<tr>");
            totalRow.append("<td class='text-center' id='TotalChoices'>0.00</td>");
            totalRow.append("<td class='text-center'>@localizer["Total"]</td>");
            tbodyContainer.append(totalRow);
        }
        function getCarChoices(priceNumber) {
            return new Promise((resolve, reject) => {
                $.ajax({
                    url: "/BS/Contract/GetCarChoices",
                    type: "GET",
                    data: { priceNumber: priceNumber },
                    cache: false,
                    success: function (data) {
                        CarChoices = data;
                        resolve(data);
                        if (data && data.optionsList) {
                            updateOptionsTable(data);
                        } else {
                            console.error("Invalid data format:", data.optionsList);
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        reject(errorThrown);
                    }
                });
            });
        }
        //For Contract Pdf
        var ChoiceItems = [];
        ////////////////////////
        $(document).ready(function () {
            // Use event delegation for dynamically generated checkboxes
            $(document).on("change", ".ChkChoicesList", function () {
                var checkedValue = $(this).val();

                if (checkedValue >= '5100000002' && checkedValue <= '5100000005') {
                    var isChecked = $(this).prop("checked");
                    if (isChecked) {
                        $(".ChkChoicesList[value='5100000002'], .ChkChoicesList[value='5100000003'], .ChkChoicesList[value='5100000004'], .ChkChoicesList[value='5100000005']").not(this).prop("checked", false).prop("disabled", true);
                    }
                    else {
                        $(".ChkChoicesList[value='5100000002'], .ChkChoicesList[value='5100000003'], .ChkChoicesList[value='5100000004'], .ChkChoicesList[value='5100000005']").not(this).prop("checked", false).prop("disabled", false);
                    }
                    // Uncheck and disable all checkboxes with values from 5100000002 to 5100000005
                }

                updateTotal();
            });

            function updateTotal() {
                var s = 0;
                var selectedChoices = [];
                var selectedChoiceItems = [];
                $(".ChkChoicesList:checked").each(function () {
                    var dataVal = $(this).attr('data-val');
                    selectedChoices.push($(this).val());
                    s += parseFloat(dataVal) || 0;
                    // For Contract Pdf
                    var label = $(this).parent().find('label'); // Get the label element
                    var dataEn = label.data('en'); // Get the data-en attribute
                    var dataAr = label.data('ar'); // Get the data-ar attribute
                    selectedChoiceItems.push({ value: dataVal, enName: dataEn, arName: dataAr }); // Push name, value, en, and ar as object
                    ChoiceItems = selectedChoiceItems;
                });
                $("#ChoicesList").val(selectedChoices.join(','));
                if (s > 0) {
                    $('#TotalChoices').text(s.toFixed(2));
                } else {
                    $('#TotalChoices').text("0.00");
                }
            }
        });
        function updateAdditionalTable(data) {
            // Assuming 'data' is an object with 'OptionsList' property
            var additionalList = data.addList;

            // Get the tbody container
            var tbodyContainer = $("#additionalBody");

            // Clear existing content
            tbodyContainer.empty();

            // Check if additionalList is empty
            if (additionalList.length === 0) {
                // If no data, hide the table
                $("#AdditionalList").hide();
                return;
            } else {
                // If there is data, show the table
                $("#AdditionalList").show();
            }
            // Populate the tbody with the received data
            additionalList.forEach(function (add) {
                var nameLabel = "@requestCulture?.RequestCulture.UICulture.Name" === "en-US" ? add.enName : add.arName;
                var row = $("<tr>");
                var valueCell = $("<td class='text-center'>" + add.addValue + "</td>");
                var optionsCol = $("<td>");
                var optionsDiv = $("<div class='options-col'>");
                optionsDiv.append("<label data-en='" + add.enName + "' data-ar='" + add.arName + "' for='checkbox-" + add.addNo + "'>" + nameLabel + "</label>");
                optionsDiv.append("<input class='ChkAddList' type='checkbox' name='Additions' value='" + add.addCode + "' data-val='" + add.addValue + "' id='checkbox-" + add.addNo + "'>");
                optionsCol.append(optionsDiv);
                row.append(valueCell);
                row.append(optionsCol);
                tbodyContainer.append(row);
            });

            // Add the total row
            var totalRow = $("<tr>");
            totalRow.append("<td class='text-center' id='TotalAdditionals'>0.00</td>");
            totalRow.append("<td class='text-center'>@localizer["Total"]</td>");
            tbodyContainer.append(totalRow);
        }
        // Function to get CarAdditional data
        function getCarAdditional(priceNumber) {
            return new Promise((resolve, reject) => {
                $.ajax({
                    url: "/BS/Contract/GetCarAdditional",
                    type: "GET",
                    data: { priceNumber: priceNumber },
                    cache: false,
                    success: function (data) {
                        CarAdditionals = data;
                        resolve(data);
                        if (data && data.addList) {
                            updateAdditionalTable(data);
                        } else {
                            console.error("Invalid data format:", data.addList);
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        reject(errorThrown);
                    }
                });
            });
        }
        //For Contract Pdf
        var AdditionalsItems = [];
        ////////////////////////
        $(document).ready(function () {
            // Use event delegation for dynamically generated checkboxes
            $(document).on("change", ".ChkAddList", function () {
                var checkedValue = $(this).val();

                if (checkedValue >= '5000000003' && checkedValue <= '5000000004') {
                    var isChecked = $(this).prop("checked");
                    if (isChecked) {
                        $(".ChkAddList[value='5000000003'], .ChkAddList[value='5000000004']").not(this).prop("checked", false).prop("disabled", true);
                    }
                    else {
                        $(".ChkAddList[value='5000000003'], .ChkAddList[value='5000000004']").not(this).prop("checked", false).prop("disabled", false);
                    }
                }
                console.log("1111111111");
                updateTotal();
            });

            function updateTotal() {
                var s = 0;
                var selectedAdditionals = [];
                var selectedAdditionalsItems = [];
                $(".ChkAddList:checked").each(function () {
                    var dataVal = $(this).attr('data-val');
                    var code = $(this).val();
                    selectedAdditionals.push($(this).val());
                    s += parseFloat(dataVal) || 0;
                    // For Contract Pdf
                    var label = $(this).parent().find('label'); // Get the label element
                    var dataEn = label.data('en'); // Get the data-en attribute
                    var dataAr = label.data('ar'); // Get the data-ar attribute
                    selectedAdditionalsItems.push({ value: dataVal, enName: dataEn, arName: dataAr, code: code }); // Push name, value, en, and ar as object
                    ////////////////////////
                });
                AdditionalsItems = selectedAdditionalsItems;
                $("#AdditionalsList").val(selectedAdditionals.join(','));
                if (s > 0) {
                    $('#TotalAdditionals').text(s.toFixed(2));
                } else {
                    $('#TotalAdditionals').text("0.00");
                }
                IfCarChangeBranchReceiving();
            }

        });
        function IfCarChangeBranchReceiving() {
            const hasCode = AdditionalsItems.some(item => item.code === "5000000003");
            console.log("ReceivingBranch should be shown:", hasCode);

            if (hasCode) {
                $("#ReceivingBranch").show(); // Show the element if the condition is met
            } else {
                document.getElementById("ReceivingBranch").setAttribute("style", "display: none !important;"); // Hide the element with important
                $("#Receiving-branch-dropdown").val(""); // Clear the dropdown value
            }
        }
        function GetCheckUp() {
            // Initialize an empty array to store the data
            var checkUpData = [];

            // Iterate over each table row
            $(".tabel-data-checkbox-td").each(function () {
                var $row = $(this).closest("tr"); // Get the closest <tr> element

                // Extract data from the row
                var notes = $row.find(".check-table-notes").val().trim();
                var $label = $row.find(".Tires");
                var dataEn = $label.data('en'); // Get the data-en attribute
                var dataAr = $label.data('ar'); // Get the data-ar attribute
                var isChecked = $row.find(".CheckUp").is(":checked");
                var selectedReasonCheck = $row.find(".form-select").val(); // Get the selected value from the <select>

                // Check if the checkbox is checked
                if (isChecked) {
                    // Create an object to store the extracted data
                    var rowData = {
                        reason: notes,
                        enName: dataEn,
                        arName: dataAr,
                        reasonCheck: selectedReasonCheck // Add the selected value to the object
                    };

                    // Push the object into the array
                    checkUpData.push(rowData);
                    CarCheckUp = checkUpData;
                }
            });
        }
        function calculateAge(birthDate) {
            var BirthDateDriver = new Date(birthDate);
            var dateTimeNow = decodeHTMLEntities('@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fffK")');

            var age = currentDate.getFullYear() - BirthDateDriver.getFullYear();

            if (
                currentDate.getMonth() < BirthDateDriver.getMonth() ||
                (currentDate.getMonth() === BirthDateDriver.getMonth() &&
                    currentDate.getDate() < BirthDateDriver.getDate())
            ) {
                age--;
            }

            return age;
        }
        var rentValue = 0;
        var choicesValue = 0;
        var additionalValue = 0;
        var advantagesValueTotal = 0;
        var additionalDriverValue = 0;
        var privateDriverValue = 0;
        var FeesTammValue = 0;
        var contractValue = 0;
        var totalContract = 0;
        var discountValue = 0;
        var taxValue = 0;
        var TotalActualContract = 0;
        var TotalAmount = 0;
        var somethingIsNotOkay = true;
        //Calculate Contract
        function CalculateContract() {
            var price = 0;
            var daysNo = document.getElementById('dayNo').value;
            var dateTimeNow = decodeHTMLEntities('@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fffK")');
            var today = new Date(dateTimeNow);
            var RentalDayPrice = CarInformation.carPrice.crCasPriceCarBasicDailyRent;
            if (parseInt(daysNo) > 0) {
                var options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' };
                var formattedstartDate = today.toLocaleDateString('ja-JP', options);
                document.getElementById('StartDate').textContent = formattedstartDate;
                today.setDate(today.getDate() + parseInt(daysNo));
                var formattedEndDate = today.toLocaleDateString('ja-JP', options);
                document.getElementById('EndDate').textContent = formattedEndDate;

                rentValue = parseInt(daysNo) * parseFloat(RentalDayPrice);
                document.getElementById('RentValue').textContent = rentValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                var TotalChoices = $("#TotalChoices").text();
                if (TotalChoices != null && TotalChoices != 0 && TotalChoices != "" && TotalChoices != undefined) {
                    choicesValue = parseFloat(TotalChoices) * parseInt(daysNo);
                    document.getElementById('ChoicesValue').textContent = choicesValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                }
                else {
                    document.getElementById('ChoicesValue').textContent = "0.00";
                    choicesValue = 0;
                }
                $("#Contract_OptionTotal").val(choicesValue);

                var TotalAdditionals = $("#TotalAdditionals").text();
                if (TotalAdditionals != null && TotalAdditionals != 0 && TotalAdditionals != "" && TotalAdditionals != undefined) {
                    additionalValue = parseFloat(TotalAdditionals);
                    document.getElementById('AdditionalValue').textContent = additionalValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                }
                else {
                    document.getElementById('AdditionalValue').textContent = "0.00";
                    additionalValue = 0;
                }
                $("#Contract_AdditionalTotal").val(additionalValue);
                var AdvatagesTotalValue = parseFloat(AdvantagesValue);
                if (AdvatagesTotalValue != null && AdvatagesTotalValue != "") {
                    advantagesValueTotal = AdvatagesTotalValue * parseInt(daysNo);
                    document.getElementById('AdvatagesValue').textContent = advantagesValueTotal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                }
                else {
                    document.getElementById('AdvatagesValue').textContent = "0.00";
                    advantagesValueTotal = 0;
                }
                $("#Contract_AdvantagesTotalValue").val(advantagesValueTotal);


                var additionalDriver = document.getElementById("addational-driver");
                if (additionalDriver.checked) {
                    var AddDriverValue = CarInformation.carPrice.crCasPriceCarBasicAdditionalDriverValue;
                    if (parseInt(AddDriverValue) != null) {
                        additionalDriverValue = parseFloat(AddDriverValue);
                        document.getElementById('AddDriverValue').textContent = additionalDriverValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    }
                    else {
                        document.getElementById('AddDriverValue').textContent = "0.00";
                        additionalDriverValue = 0;
                    }
                }


                var privateDriverRadio1 = document.getElementById("PrivateDriver");
                var privateDriverID = $("#Private-Driver-selectt").val();

                if (privateDriverRadio1.checked && privateDriverID != null) {
                    var privateDriver = CarInformation.carPrice.crCasPriceCarBasicPrivateDriverValue;
                    console.log("privateDriverPrice", privateDriver);

                    if (privateDriver != null) {
                        privateDriverValue = parseFloat(privateDriver) * parseInt(daysNo);
                        document.getElementById('PrivateDriverValue').textContent = privateDriverValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    }
                    else {
                        document.getElementById('PrivateDriverValue').textContent = "0.00";
                        privateDriverValue = 0;
                    }
                }
                else {
                    privateDriverValue = 0;
                    document.getElementById('PrivateDriverValue').textContent = "0.00";
                }
                //Get FeeTmm Out Or in value
                getFeeTmm();


                // Contract Value Total
                contractValue = rentValue + choicesValue + additionalValue + advantagesValueTotal + additionalDriverValue + privateDriverValue + FeesTammValue;
                document.getElementById('contractValue').textContent = contractValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                $("#Contract_ContractValueBeforeDiscount").val(contractValue);
                // get discount and totalContract Value
                CalculateDiscount();
                // Get Tax value from TotalActualContract and get value of TotalActualContract
                CalculateTax();
                CalculateTotalAmount();
                $("#payment-extra-details").show();
                $('#AmountPayed').prop('readonly', false);
            } else {
                clearPaymentData();
            }

        }
        function clearPaymentData() {
            $("#payment-extra-details").hide();
            $("#dropdown-content-payment").hide();
            document.getElementById('EndDate').textContent = "";
            document.getElementById('InFeesTammValue').textContent = "0.00";
            document.getElementById('contractValue').textContent = "0.00";
            document.getElementById('RentValue').textContent = "0.00";
            document.getElementById('PrivateDriverValue').textContent = "0.00";
            document.getElementById('AddDriverValue').textContent = "0.00";
            document.getElementById('AdvatagesValue').textContent = "0.00";
            document.getElementById('AdditionalValue').textContent = "0.00";
            document.getElementById('ChoicesValue').textContent = "0.00";
            document.getElementById("totalContract").textContent = "0.00";
            document.getElementById('Taxvalue').textContent = "0.00";
            document.getElementById('TotalActualContract').textContent = "0.00";
            document.getElementById("TotalAmount").textContent = "0.00";
            document.getElementById("dayNo").value = "";
            document.getElementById("Discount_Input").value = 0;
            document.getElementById("Delegate-out").checked = false;
            $('#AmountPayed').prop('readonly', true);
            $('#AmountPayed').val("");
            document.getElementById('Contract_PaymentMethod').disabled = true;
            document.getElementById('Contract_PaymentMethod').selectedIndex = 0;
            document.getElementById('Contract_SalesPoint').disabled = true;
            document.getElementById('Contract_SalesPoint').selectedIndex = 0;
            $("#Contract_SalesPoint").empty();
            rentValue = 0;
            choicesValue = 0;
            additionalValue = 0;
            advantagesValueTotal = 0;
            additionalDriverValue = 0;
            privateDriverValue = 0;
            FeesTammValue = 0;
            contractValue = 0;
            totalContract = 0;
            discountValue = 0;
            taxValue = 0;
            TotalActualContract = 0;
            TotalAmount = 0;
        }



        //This Function Show if FeeTamm Is Out or In
        $(document).ready(
            function () {
                $("#Delegate-out").click(function () {
                    CalculateContract();
                })
            });
        function getFeeTmm() {
            var InFeesTamm = CarInformation.carPrice.crCasCarPriceBasicInFeesTamm;
            var OutFeesTamm = CarInformation.carPrice.crCasCarPriceBasicOutFeesTamm;
            var OutFeesTammInput = document.getElementById('Delegate-out');

            if (OutFeesTammInput.checked) {
                if (parseFloat(OutFeesTamm) != null && parseFloat(OutFeesTamm) != "") {
                    FeesTammValue = parseFloat(OutFeesTamm);
                    document.getElementById('InFeesTammValue').textContent = FeesTammValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                }
                else {
                    document.getElementById('InFeesTammValue').textContent = "0.00";
                    FeesTammValue = 0;
                }
                $("#Contract_OutFeesTmm").val("true");
                $("#Contract_FeesTmmValue").val(FeesTammValue);
            }
            else {
                if (parseFloat(InFeesTamm) != null) {
                    FeesTammValue = parseFloat(InFeesTamm);
                    document.getElementById('InFeesTammValue').textContent = FeesTammValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                }
                else {
                    document.getElementById('InFeesTammValue').textContent = "0.00";
                    FeesTammValue = 0;
                }
                $("#Contract_OutFeesTmm").val("false");
                $("#Contract_FeesTmmValue").val(FeesTammValue);
            }
        }
        function CalculateDiscount() {
            var DiscountInput = document.getElementById("Discount_Input").value;
            if (parseFloat(DiscountInput) != null && parseFloat(DiscountInput) != "" && parseFloat(DiscountInput) != 0 && parseFloat(DiscountInput) != undefined) {
                discountValue = contractValue * (parseFloat(DiscountInput) / 100);
                totalContract = contractValue - discountValue;
            }
            else {
                totalContract = contractValue;
                discountValue = 0;

            }
            document.getElementById("totalContract").textContent = totalContract.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            $("#Contract_ContractValueAfterDiscount").val(totalContract);
            $("#Contract_DiscountValue").val(discountValue);
            CalculateTax();
            CalculateTotalAmount();
        };
        function CalculateTax() {
            var TaxPercent = parseInt(CarInformation.carPrice.crCasPriceCarBasicRentalTaxRate);
            if (TaxPercent != null && TaxPercent != "" && TaxPercent != undefined && TaxPercent != 0) {
                taxValue = totalContract * (TaxPercent / 100);
                TotalActualContract = parseFloat(taxValue) + parseFloat(totalContract);
            }
            else {
                taxValue = 0;
                TotalActualContract = parseFloat(totalContract);
            }
            document.getElementById('Taxvalue').textContent = taxValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('TotalActualContract').textContent = TotalActualContract.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            $("#Contract_TaxValue").val(taxValue);
        }
        function CalculateTotalAmount() {
            // Get Total Of amount Required
            if (parseFloat(TotalActualContract) <= parseFloat(RenterBalance)) {
                TotalAmount = "0.00";
            }
            else {
                TotalAmount = Math.abs(parseFloat(RenterBalance) - parseFloat(TotalActualContract));
            }
            document.getElementById("TotalAmount").textContent = TotalAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            $("#Contract_TotalContractAmount").val(TotalAmount);
        }
    </script>

    <script>
        // Define the handleDiscountInput function
        function handleDiscountInput(input) {
            // Remove non-digit characters and additional decimal points
            input.value = input.value.replace(/[^0-9\.]/g, '');
            const decimalIndex = input.value.indexOf('.');

            // Limit to 9 digits before and after the decimal point
            if (decimalIndex !== -1) {
                const digitsBeforeDecimal = input.value.substring(0, decimalIndex);
                const digitsAfterDecimal = input.value.substring(decimalIndex + 1);

                // Limit to 2 digits after the decimal point
                input.value = digitsBeforeDecimal.substr(0, 9) + '.' + digitsAfterDecimal.substr(0, 2);

                // Remove additional decimal points
                if (input.value.indexOf('.', decimalIndex + 1) !== -1) {
                    const lastValidIndex = input.value.lastIndexOf('.');
                    input.value = input.value.substring(0, lastValidIndex) + input.value.substring(lastValidIndex + 1);
                }
            } else {
                // Limit to 2 digits before the decimal point
                input.value = input.value.substr(0, 3);
            }

            // Retrieve userDiscount from the model
            var userDiscount = @Html.Raw(Json.Serialize(userInfo?.CrMasUserContractValidity?.CrMasUserContractValidityDiscountRate));

            // Ensure the value is between 0 and 100
            const numericValue = parseFloat(input.value);
            if (isNaN(numericValue) || isNaN(userDiscount)) {
                input.value = '0';
            } else if (!isNaN(userDiscount) && parseFloat(input.value) > parseFloat(userDiscount)) {
                input.value = userDiscount.toFixed(2);
            }
        }
        function handleAdditionalHoursInput(inputElement) {
            inputElement.value = inputElement.value.replace(/[^0-9]/g, '');
            // Retrieve userDiscount from the model
            var userAdditionalHours = @Html.Raw(Json.Serialize(userInfo?.CrMasUserContractValidity?.CrMasUserContractValidityHour));
            // Ensure the value is between 0 and 100
            const numericValue = parseInt(inputElement.value);
            if (isNaN(numericValue) || isNaN(userAdditionalHours)) {
                inputElement.value = '0';
            } else {
                inputElement.value = Math.min(userAdditionalHours, Math.max(0, numericValue));
            }
        }
        function handleAdditionalKilosInput(inputElement) {
            inputElement.value = inputElement.value.replace(/[^0-9]/g, '');
            // Retrieve userDiscount from the model
            var userAdditionalKilos = @Html.Raw(Json.Serialize(userInfo?.CrMasUserContractValidity?.CrMasUserContractValidityKm));
            // Ensure the value is between 0 and 100
            const numericValue = parseInt(inputElement.value);
            if (isNaN(numericValue) || isNaN(userAdditionalKilos)) {
                inputElement.value = '0';
            } else {
                inputElement.value = Math.min(userAdditionalKilos, Math.max(0, numericValue));
            }
        }
        function handleAmountPayed(input) {
            // Remove non-digit characters and additional decimal points
            input.value = input.value.replace(/[^0-9\.]/g, '');
            const decimalIndex = input.value.indexOf('.');
            // Limit to 9 digits before and after the decimal point
            if (decimalIndex !== -1) {
                const digitsBeforeDecimal = input.value.substring(0, decimalIndex);
                const digitsAfterDecimal = input.value.substring(decimalIndex + 1);

                // Limit to 2 digits after the decimal point
                input.value = digitsBeforeDecimal.substr(0, 7) + '.' + digitsAfterDecimal.substr(0, 2);

                // Remove additional decimal points
                if (input.value.indexOf('.', decimalIndex + 1) !== -1) {
                    const lastValidIndex = input.value.lastIndexOf('.');
                    input.value = input.value.substring(0, lastValidIndex) + input.value.substring(lastValidIndex + 1);
                }
            } else {
                // Limit to 7 digits before the decimal point
                input.value = input.value.substr(0, 7);
            }
        }
        function CheckIfCanPayLessThanTotalAmount() {
            var userAuthAmount = @Html.Raw(Json.Serialize(userInfo?.CrMasUserContractValidity?.CrMasUserContractValidityLessContractValue));
            var AmountPayed = document.getElementById("AmountPayed").value;
            if (userAuthAmount == false && TotalAmount > AmountPayed) {
                toastr.options = { "positionClass": '@localizer["toastPostion"]', };
                toastr.error('@localizer["DontHaveAuthPayLessThanTotalAmount"]');
                $("#AmountPayed").css({ "border": "2px solid red" });    //This For last Check When i submit Form
                somethingIsNotOkay = false;
            }
            else {
                $("#AmountPayed").css({ "border": "1px solid #faa64d" }); //This For last Check When i submit Form
                somethingIsNotOkay = true;
            }
        }
    </script>

    <script>
        $(document).ready(function () {
            $("#AmountPayed").focusout(function () {
                var payed = document.getElementById('AmountPayed').value;
                CheckIfCanPayLessThanTotalAmount();
                if (parseFloat(payed) > 0 && somethingIsNotOkay) {
                    document.getElementById('Contract_PaymentMethod').disabled = false;
                    // document.getElementById('Contract_PaymentMethod').selectedIndex = 0;
                    document.getElementById('Contract_SalesPoint').disabled = false;
                    document.getElementById('Contract_SalesPoint').selectedIndex = 0;
                } else {
                    document.getElementById('Contract_PaymentMethod').disabled = true;
                    document.getElementById('Contract_PaymentMethod').selectedIndex = 0;
                    document.getElementById('Contract_SalesPoint').disabled = true;
                    document.getElementById('Contract_SalesPoint').selectedIndex = 0;
                    $("#Contract_SalesPoint").empty();
                }
            })
        });
    </script>
    <script>
        // Function to send a static image file to WhatsApp
        async function sendStaticImageToWhatsApp() {
            const imageLessor = "@user.CrMasUserInformationLessorNavigation.CrMasLessorImage.CrMasLessorImageContractCard";
            const imagePath = imageLessor.replace('~', '');
            const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJudW1iZXIiOiJKYXNlcjExIiwic2VyaWFsIjoiMTk5ZmUzYjFlYjc2MjNlIiwiaWF0IjoxNzA3NzMxNjI4LCJleHAiOjE3OTQxMzE2Mjh9.O_4RW4vYAays1ZL7D-OlOQh6C5P5xVYrT3pZ2Oi9Yak"; // Your WhatsApp API token
            const callingKey = '@user.CrMasUserInformationCallingKey'; // Assuming this variable contains the calling key
            const mobileNo = '@user.CrMasUserInformationMobileNo'; // Assuming this variable contains the mobile number
            const phoneNumber = callingKey + mobileNo;
            const messageText = " "; // Replace with your message
            const contractNo = "@ViewBag.ContractNo";

            try {
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                // Prepare form data
                const formData = new FormData();
                formData.append("number", phoneNumber); // Append the recipient's phone number
                formData.append("message", messageText); // Append the message

                // Create a canvas element
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                // Create an image element
                const img = new Image();

                // When the image is loaded, draw it on the canvas
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);

                    const CarEn = CarInformation.carInformation.crCasCarInformationConcatenateEnName;
                    const CarAr = CarInformation.carInformation.crCasCarInformationConcatenateArName;
                    var daysNo = parseInt(document.getElementById('dayNo').value);
                    var dateTimeNow = decodeHTMLEntities('@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fffK")');
                    var startDate = new Date(dateTimeNow);
                    var endDate = new Date(startDate);
                    endDate.setDate(endDate.getDate() + daysNo);
                    const startHijriDate = formatHijriDate(startDate);
                    const endHijriDate = formatHijriDate(endDate);
                    const branch = '@Html.Raw(Model.CrCasBranchInformation?.CrCasBranchPost.CrCasBranchPostCityNavigation.CrMasSupPostCityConcatenateArName)' + ' - ' + '@Html.Raw(Model.CrCasBranchInformation?.CrCasBranchInformationArShortName)';
                    // Define text properties
                    ctx.font = "bold 25px serif";
                    ctx.textAlign = "right";
                    ctx.fillStyle = "black";
                    ctx.fillText(RenterInformation.personalArName, canvas.width - 75, 170);
                    ctx.fillText(CarAr, canvas.width - 75, 205);
                    ctx.fillText(startHijriDate, canvas.width - 190, 358);
                    ctx.fillText(endHijriDate, canvas.width - 190, 395);
                    ctx.fillText(branch, canvas.width - 75, 450);

                    ctx.textAlign = "left";
                    ctx.fillText(RenterInformation.personalEnName, canvas.width - 960, 270);
                    ctx.fillText(CarEn, canvas.width - 960, 305);
                    ctx.fillText($("#StartDate").text(), canvas.width - 850, 358);
                    ctx.fillText($("#EndDate").text(), canvas.width - 850, 395);
                    ctx.fillText($("#ContractNo").val(), canvas.width - 960, 585);
                    canvas.toBlob(async function (blob) {
                        const base64String = await blobToBase64(blob);
                        document.getElementById("StaticContractCardImg").value = base64String;
                    }, 'image/png');
                };
                img.src = URL.createObjectURL(blob);
            } catch (error) {
                console.log('SendImageError', error);
            }
        };
        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    resolve(reader.result);
                };
                reader.onerror = error => reject(error);
                reader.readAsDataURL(blob);
            });
        }
        // Function to send an image and Ar PDF to WhatsApp
        async function sendArInvoiceToWhatsApp() {
            try {
                const imageLessor = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArInitialInvoice";
                const imagePath = imageLessor.replace('~', '');
                const dates = getFormattedDatesMiliadiAndHijri("ar");
                const miladiDateString = dates.miladiDate;
                const hijriDateString = dates.hijriDate;
                // First In Page
                const contractNo = "@ViewBag.ContractNo";
                const InvoiceAccountNo = "@ViewBag.InvoiceAccount";
                const referenceType = "انشاء عقد";
                const CarName = CarInformation.carInformation.crCasCarInformationConcatenateArName;
                // last in page
                var DiscountInput = document.getElementById("Discount_Input").value;
                const discountRate = parseFloat(DiscountInput).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                const TaxPercent = parseFloat(CarInformation.carPrice.crCasPriceCarBasicRentalTaxRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                const balance = RenterInformation.availableBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                const AmountRequired = TotalAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                var AmountPayedInput = document.getElementById("AmountPayed").value;
                let AmountPayed = parseFloat(AmountPayedInput);

                // Check if AmountPayed is null, NaN, or empty
                if (isNaN(AmountPayed) || !AmountPayedInput.trim()) {
                    AmountPayed = "0.00"; // Setting it as a string
                } else {
                    // Convert to formatted string with 2 decimal places
                    AmountPayed = AmountPayed.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                }
                var selectElement = document.getElementById("Contract_PaymentMethod");
                var selectedOption = selectElement.options[selectElement.selectedIndex];
                // Get the text of the selected option
                var selectedArabicName = selectedOption.dataset.ar;
                if (selectedArabicName == "" || selectedArabicName == undefined || selectedArabicName == NaN) {
                    selectedArabicName = "";
                }
                var reasonPayment = document.getElementById("FormControl-last-Textarea").value;
                // Signture Image
                const RenterName = decodeHTMLEntities(RenterInformation.personalArName);
                var renterSignture = RenterInformation.signture.replace('~', '');
                var userName = decodeHTMLEntities("@user.CrMasUserInformationArName");
                var userSignture = decodeHTMLEntities("@user.CrMasUserInformationSignature").replace('~', '');
                var directorOfLessor = decodeHTMLEntities("@user.CrMasUserInformationLessorNavigation.CrMasLessorInformationDirectorArName");
                var directorOfLessorSignture = decodeHTMLEntities("@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageSignatureDirector").replace('~', '');
                var directorOfBranch = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorArName");
                var directorOfBranchSignture = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorSignature").replace('~', '');
                const signatureImg1 = await loadImage(directorOfLessorSignture);
                const signatureImg2 = await loadImage(userSignture);
                const signatureImg3 = await loadImage(directorOfBranchSignture);
                var signatureImg4 = "";
                if (renterSignture) {
                    signatureImg4 = await loadImage(renterSignture);
                }                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);
                    ctx.font = "bold 50px serif";
                    ctx.textAlign = "right";
                    ctx.fillStyle = "black";
                    // Receipt and type and renter and car name
                    ctx.fillText(InvoiceAccountNo, canvas.width - 110, 610);
                    ctx.fillText(RenterName, canvas.width - 125, 1075);
                    ctx.fillText(CarName, canvas.width - 125, 1175);

                    ctx.font = "bold 42px serif";
                    ctx.fillText(referenceType, canvas.width - 250, 895);
                    ctx.fillText(contractNo, canvas.width - 320, 985);
                    // The Table
                    var YHeight = 1380;
                    var DiscountInput = document.getElementById("Discount_Input").value;
                    var daysNo = document.getElementById('dayNo').value;
                    var TaxPercent = parseInt(CarInformation.carPrice.crCasPriceCarBasicRentalTaxRate);
                    // The payed Information
                    const discountText = '%' + DiscountInput.toString();
                    const taxText = '%' + TaxPercent.toString();

                    ctx.fillText(balance, canvas.width - 330, 2392);
                    ctx.fillText(discountText, canvas.width - 360, 2485);
                    ctx.fillText(taxText, canvas.width - 367, 2573);
                    ctx.fillText(AmountRequired, canvas.width - 360, 2660);
                    ctx.fillText(AmountPayed, canvas.width - 360, 2750);
                    ctx.fillText(selectedArabicName, canvas.width - 360, 2840);
                    ctx.fillText(reasonPayment, canvas.width - 360, 2930);
                    ctx.font = "bold 35px serif";
                    //Date and contract no
                    ctx.fillText(hijriDateString, canvas.width - 228, 668);
                    ctx.fillText(miladiDateString, canvas.width - 228, 722);
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Rent
                    if (parseFloat(CarInformation.carPrice.crCasPriceCarBasicDailyRent) > 0) {
                        YHeight = calculateAndDrawAr(ctx, canvas, "الايجار", CarInformation.carPrice.crCasPriceCarBasicDailyRent, daysNo, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Rent


                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Auth
                    var InFeesTamm = CarInformation.carPrice.crCasCarPriceBasicInFeesTamm;
                    var OutFeesTamm = CarInformation.carPrice.crCasCarPriceBasicOutFeesTamm;
                    var OutFeesTammInput = document.getElementById('Delegate-out');
                    var FeesTammValue = 0;
                    if (OutFeesTammInput.checked) {
                        if (parseFloat(OutFeesTamm) != null) {
                            FeesTammValue = parseFloat(OutFeesTamm);
                        }
                        else {
                            FeesTammValue = 0;
                        }
                    }
                    else {
                        if (parseFloat(InFeesTamm) != null) {
                            FeesTammValue = parseFloat(InFeesTamm);
                        }
                        else {
                            FeesTammValue = 0;
                        }
                    }
                    if (parseFloat(FeesTammValue) > 0) {
                        YHeight = calculateAndDrawAr(ctx, canvas, "التفويض", FeesTammValue, 1, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Auth

                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Advantages
                    if (parseFloat(AdvantagesValue) > 0) {
                        YHeight = calculateAndDrawAr(ctx, canvas, "المميزات الاضافية", AdvantagesValue, daysNo, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Advantages

                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Additional Driver
                    var additionalDriver = document.getElementById("addational-driver");
                    var additionalDriverValue = 0;
                    if (additionalDriver.checked) {
                        var AddDriverValue = CarInformation.carPrice.crCasPriceCarBasicAdditionalDriverValue;
                        if (parseInt(AddDriverValue) != null) {
                            additionalDriverValue = parseFloat(AddDriverValue);
                        }
                        else {
                            additionalDriverValue = 0;
                        }
                    }
                    if (additionalDriverValue > 0) {
                        YHeight = calculateAndDrawAr(ctx, canvas, "سائق اضافي", additionalDriverValue, 1, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Additional Driver

                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Private Driver
                    var privateDriverRadio1 = document.getElementById("PrivateDriver");
                    var privateDriverID = $("#Private-Driver-selectt").val();
                    var privateDriverValue = 0;
                    if (privateDriverRadio1.checked && privateDriverID != null) {
                        var privateDriver = CarInformation.carPrice.crCasPriceCarBasicPrivateDriverValue;
                        if (privateDriver != null) {
                            privateDriverValue = parseFloat(privateDriver);
                        }
                        else {
                            privateDriverValue = 0;
                        }
                    }
                    else {
                        privateDriverValue = 0;
                    }
                    if (privateDriverValue > 0) {
                        YHeight = calculateAndDrawAr(ctx, canvas, "سائق خاص", privateDriverValue, daysNo, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Private Driver

                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// TotalChoices
                    var TotalChoices = $("#TotalChoices").text();
                    var choicesValue = 0;
                    if (TotalChoices != null && TotalChoices != 0 && TotalChoices != "" && TotalChoices != undefined) {
                        choicesValue = parseFloat(TotalChoices);
                    }
                    else {
                        choicesValue = 0;
                    }
                    if (choicesValue > 0) {
                        YHeight = calculateAndDrawAr(ctx, canvas, "الخيارات", choicesValue, daysNo, DiscountInput, TaxPercent, YHeight);
                    }
                    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////TotalChoices

                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// TotalAdditional

                    var TotalAdditionals = $("#TotalAdditionals").text();
                    var additionalValue = 0;
                    if (TotalAdditionals != null && TotalAdditionals != 0 && TotalAdditionals != "" && TotalAdditionals != undefined) {
                        additionalValue = parseFloat(TotalAdditionals);
                    }
                    else {
                        additionalValue = 0;
                    }
                    if (additionalValue > 0) {
                        YHeight = calculateAndDrawAr(ctx, canvas, "الاضافات", additionalValue, 1, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// TotalAdditional


                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Total
                    var tTotal = calculateTotalAmountPerDay(parseFloat(CarInformation.carPrice.crCasPriceCarBasicDailyRent), parseFloat(FeesTammValue), parseFloat(AdvantagesValue), parseFloat(privateDriverValue), parseFloat(additionalDriverValue), parseFloat(additionalValue), parseFloat(choicesValue), daysNo);
                    var tTotalDiscount = calculateTotalDiscountAmount(tTotal, DiscountInput);
                    var tTotalAfterDiscount = tTotal - tTotalDiscount;
                    var tTotalTax = (tTotalAfterDiscount) * (TaxPercent / 100);
                    var TotalAmount = parseFloat(TotalActualContract)
                    // // الاجمالي
                    ctx.fillText(tTotal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 970, 2250);
                    ctx.fillText(tTotalDiscount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 1270, 2250);
                    ctx.fillText(tTotalAfterDiscount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 1560, 2250);
                    ctx.fillText(tTotalTax.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 1880, 2250);
                    ctx.fillText(TotalAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 2180, 2250);
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Total
                    // director and renter and user
                    ctx.fillText(directorOfLessor, canvas.width - 340, 3050);
                    ctx.fillText(userName, canvas.width - 1140, 3050);
                    ctx.fillText(directorOfBranch, canvas.width - 340, 3190);
                    ctx.fillText(RenterName, canvas.width - 1140, 3200);
                    if (signatureImg4) {
                        ctx.drawImage(signatureImg4, canvas.width - 1350, 3125, 200, 100);
                    }
                    canvas.toBlob(async function (blob) {
                        var message = ` عزيزي / ${RenterName} , يمكنك مراجعة الفاتورة عن طريق تحميل الملف المرفق `
                        createPdfAndSendToWhatsApp(null, InvoiceAccountNo, blob, "SavePdfArInvoice", "ar");
                    }, 'image/png');
                };
                img.src = URL.createObjectURL(blob);
            } catch (error) {
                console.error("Error creating Arabic Invoice contract:", error);
                window.location.href = "/BS/Contract/FailedToast?type=arinvoice";
            }
        };
        function calculateAndDrawAr(ctx, canvas, itemName, itemValue, days, discountInput, taxPercent, yHeight) {
            var itemTotal = parseFloat(itemValue) * parseInt(days);
            var discountValue = itemTotal * (parseFloat(discountInput) / 100);
            var totalAfterDiscount = itemTotal - discountValue;
            var taxValue = totalAfterDiscount * (taxPercent / 100);
            var totalActual = parseFloat(totalAfterDiscount) + parseFloat(taxValue);
            ctx.fillText(itemName, canvas.width - 230, yHeight);
            ctx.fillText(itemValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 540, yHeight);
            ctx.fillText(days, canvas.width - 775, yHeight);
            ctx.fillText(itemTotal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 970, yHeight);
            ctx.fillText(discountValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 1270, yHeight);
            ctx.fillText(totalAfterDiscount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 1560, yHeight);
            ctx.fillText(taxValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 1880, yHeight);
            ctx.fillText(totalActual.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 2180, yHeight);

            return yHeight + 88; // Update yHeight for the next item
        }
        // Function to send an image and En PDF to WhatsApp
        async function sendEnInvoiceToWhatsApp() {
            try {
                const imageLessor = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnInitialInvoice";
                const imagePath = imageLessor.replace('~', '');
                const dates = getFormattedDatesMiliadiAndHijri("en");
                const miladiDateString = dates.miladiDate;
                const hijriDateString = dates.hijriDate;
                // First In Page
                const contractNo = "@ViewBag.ContractNo";
                const InvoiceAccountNo = "@ViewBag.InvoiceAccount";
                const referenceType = "Create Contract";
                const CarName = CarInformation.carInformation.crCasCarInformationConcatenateEnName;
                // last in page
                const balance = RenterInformation.availableBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                var DiscountInput = document.getElementById("Discount_Input").value;
                const discountRate = parseFloat(DiscountInput).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                const TaxPercent = parseFloat(CarInformation.carPrice.crCasPriceCarBasicRentalTaxRate).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                const AmountRequired = TotalAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                var AmountPayedInput = document.getElementById("AmountPayed").value;
                let AmountPayed = parseFloat(AmountPayedInput);

                // Check if AmountPayed is null, NaN, or empty
                if (isNaN(AmountPayed) || !AmountPayedInput.trim()) {
                    AmountPayed = "0.00"; // Setting it as a string
                } else {
                    // Convert to formatted string with 2 decimal places
                    AmountPayed = AmountPayed.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                }
                var selectElement = document.getElementById("Contract_PaymentMethod");
                var selectedOption = selectElement.options[selectElement.selectedIndex];
                // Get the text of the selected option
                var selectedText = selectedOption.textContent || selectedOption.innerText;
                var selectedEnglishName = selectedOption.dataset.en;
                if (selectedEnglishName == "" || selectedEnglishName == undefined || selectedEnglishName == NaN) {
                    selectedEnglishName = "";
                }
                var reasonPayment = document.getElementById("FormControl-last-Textarea").value;
                // Signture Image
                const RenterName = decodeHTMLEntities(RenterInformation.personalEnName);
                var renterSignture = RenterInformation.signture.replace('~', '');
                var userName = decodeHTMLEntities("@user.CrMasUserInformationEnName");
                var userSignture = decodeHTMLEntities("@user.CrMasUserInformationSignature").replace('~', '');
                var directorOfLessor = decodeHTMLEntities("@user.CrMasUserInformationLessorNavigation.CrMasLessorInformationDirectorEnName");
                var directorOfLessorSignture = decodeHTMLEntities("@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageSignatureDirector").replace('~', '');
                var directorOfBranch = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorEnName");
                var directorOfBranchSignture = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorSignature").replace('~', '');
                const signatureImg1 = await loadImage(directorOfLessorSignture);
                const signatureImg2 = await loadImage(userSignture);
                const signatureImg3 = await loadImage(directorOfBranchSignture);
                var signatureImg4 = "";
                if (renterSignture) {
                    signatureImg4 = await loadImage(renterSignture);
                }


                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);
                    ctx.font = "bold 50px serif";
                    ctx.textAlign = "left";
                    ctx.fillStyle = "black";
                    // Receipt and type and renter and car name
                    ctx.fillText(InvoiceAccountNo, canvas.width - 2370, 610);
                    ctx.fillText(RenterName, canvas.width - 2360, 1070);
                    ctx.fillText(CarName, canvas.width - 2360, 1180);

                    ctx.font = "bold 42px serif";
                    ctx.fillText(referenceType, canvas.width - 2160, 895);
                    ctx.fillText(contractNo, canvas.width - 2000, 980);
                    // The Table
                    var YHeight = 1380;
                    var DiscountInput = document.getElementById("Discount_Input").value;
                    var daysNo = document.getElementById('dayNo').value;
                    var TaxPercent = parseInt(CarInformation.carPrice.crCasPriceCarBasicRentalTaxRate);
                    // The payed Information
                    const discountText = '%' + DiscountInput.toString();
                    const taxText = '%' + TaxPercent.toString();

                    ctx.fillText(balance, canvas.width - 2040, 2392);
                    ctx.fillText(discountText, canvas.width - 2090, 2485);
                    ctx.fillText(taxText, canvas.width - 2180, 2573);
                    ctx.fillText(AmountRequired, canvas.width - 2020, 2660);
                    ctx.fillText(AmountPayed, canvas.width - 2100, 2750);
                    ctx.fillText(selectedEnglishName, canvas.width - 2010, 2840);
                    ctx.fillText(reasonPayment, canvas.width - 2170, 2920);
                    ctx.font = "bold 35px serif";
                    //Date and contract no
                    ctx.fillText(hijriDateString, canvas.width - 2300, 668);
                    ctx.fillText(miladiDateString, canvas.width - 2270, 722);
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Rent
                    if (parseFloat(CarInformation.carPrice.crCasPriceCarBasicDailyRent) > 0) {
                        YHeight = calculateAndDrawEn(ctx, canvas, "Rent", CarInformation.carPrice.crCasPriceCarBasicDailyRent, daysNo, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Rent


                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Auth
                    var InFeesTamm = CarInformation.carPrice.crCasCarPriceBasicInFeesTamm;
                    var OutFeesTamm = CarInformation.carPrice.crCasCarPriceBasicOutFeesTamm;
                    var OutFeesTammInput = document.getElementById('Delegate-out');
                    var FeesTammValue = 0;
                    if (OutFeesTammInput.checked) {
                        if (parseFloat(OutFeesTamm) != null) {
                            FeesTammValue = parseFloat(OutFeesTamm);
                        }
                        else {
                            FeesTammValue = 0;
                        }
                    }
                    else {
                        if (parseFloat(InFeesTamm) != null) {
                            FeesTammValue = parseFloat(InFeesTamm);
                        }
                        else {
                            FeesTammValue = 0;
                        }
                    }
                    if (parseFloat(FeesTammValue) > 0) {
                        YHeight = calculateAndDrawEn(ctx, canvas, "Delegation", FeesTammValue, 1, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Auth

                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Advantages
                    if (parseFloat(AdvantagesValue) > 0) {
                        YHeight = calculateAndDrawEn(ctx, canvas, "Features", AdvantagesValue, daysNo, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Advantages

                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Additional Driver
                    var additionalDriver = document.getElementById("addational-driver");
                    var additionalDriverValue = 0;
                    if (additionalDriver.checked) {
                        var AddDriverValue = CarInformation.carPrice.crCasPriceCarBasicAdditionalDriverValue;
                        if (parseInt(AddDriverValue) != null) {
                            additionalDriverValue = parseFloat(AddDriverValue);
                        }
                        else {
                            additionalDriverValue = 0;
                        }
                    }
                    if (additionalDriverValue > 0) {
                        YHeight = calculateAndDrawEn(ctx, canvas, "Add Driver", additionalDriverValue, 1, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Additional Driver

                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Private Driver
                    var privateDriverRadio1 = document.getElementById("PrivateDriver");
                    var privateDriverID = $("#Private-Driver-selectt").val();
                    var privateDriverValue = 0;
                    if (privateDriverRadio1.checked && privateDriverID != null) {
                        var privateDriver = CarInformation.carPrice.crCasPriceCarBasicPrivateDriverValue;
                        if (privateDriver != null) {
                            privateDriverValue = parseFloat(privateDriver);
                        }
                        else {
                            privateDriverValue = 0;
                        }
                    }
                    else {
                        privateDriverValue = 0;
                    }
                    if (privateDriverValue > 0) {
                        YHeight = calculateAndDrawEn(ctx, canvas, "Private Driver", privateDriverValue, daysNo, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Private Driver

                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// TotalChoices
                    var TotalChoices = $("#TotalChoices").text();
                    var choicesValue = 0;
                    if (TotalChoices != null && TotalChoices != 0 && TotalChoices != "" && TotalChoices != undefined) {
                        choicesValue = parseFloat(TotalChoices);
                    }
                    else {
                        choicesValue = 0;
                    }
                    if (choicesValue > 0) {
                        YHeight = calculateAndDrawEn(ctx, canvas, "Options", choicesValue, daysNo, DiscountInput, TaxPercent, YHeight);
                    }
                    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////TotalChoices

                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// TotalAdditional

                    var TotalAdditionals = $("#TotalAdditionals").text();
                    var additionalValue = 0;
                    if (TotalAdditionals != null && TotalAdditionals != 0 && TotalAdditionals != "" && TotalAdditionals != undefined) {
                        additionalValue = parseFloat(TotalAdditionals);
                    }
                    else {
                        additionalValue = 0;
                    }
                    if (additionalValue > 0) {
                        YHeight = calculateAndDrawEn(ctx, canvas, "Additionals", additionalValue, 1, DiscountInput, TaxPercent, YHeight);
                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// TotalAdditional


                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Total
                    var tTotal = calculateTotalAmountPerDay(parseFloat(CarInformation.carPrice.crCasPriceCarBasicDailyRent), parseFloat(FeesTammValue), parseFloat(AdvantagesValue), parseFloat(privateDriverValue), parseFloat(additionalDriverValue), parseFloat(additionalValue), parseFloat(choicesValue), daysNo);
                    var tTotalDiscount = calculateTotalDiscountAmount(tTotal, DiscountInput);
                    var tTotalAfterDiscount = tTotal - tTotalDiscount;
                    var tTotalTax = (tTotalAfterDiscount) * (TaxPercent / 100);
                    var TotalAmount = parseFloat(TotalActualContract)
                    // // الاجمالي
                    ctx.fillText(tTotal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 1510, 2250);
                    ctx.fillText(tTotalDiscount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 1200, 2250);
                    ctx.fillText(tTotalAfterDiscount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 910, 2250);
                    ctx.fillText(tTotalTax.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 620, 2250);
                    ctx.fillText(TotalAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 310, 2250);
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// Total





                    // director and renter and user
                    ctx.fillText(directorOfLessor, canvas.width - 1980, 3050);
                    ctx.fillText(directorOfBranch, canvas.width - 2020, 3180);
                    ctx.fillText(userName, canvas.width - 1275, 3050);
                    ctx.fillText(RenterName, canvas.width - 1275, 3180);
                    if (signatureImg4) {
                        ctx.drawImage(signatureImg4, canvas.width - 1250, 3125, 200, 100);
                    }
                    canvas.toBlob(async function (blob) {
                        var message = `Dear / ${RenterName}, you can review the invoice by downloading the attached file.`
                        createPdfAndSendToWhatsApp(null, InvoiceAccountNo, blob, "SavePdfEnInvoice", "en");
                    }, 'image/png');
                };
                img.src = URL.createObjectURL(blob);
            } catch (error) {
                console.error("Error creating English Invoice:", error);
                window.location.href = "/BS/Contract/FailedToast?type=eninvoice";
            }
        };
        function calculateAndDrawEn(ctx, canvas, itemName, itemValue, days, discountInput, taxPercent, yHeight) {
            var itemTotal = parseFloat(itemValue) * parseInt(days);
            var discountValue = itemTotal * (parseFloat(discountInput) / 100);
            var totalAfterDiscount = itemTotal - discountValue;
            var taxValue = totalAfterDiscount * (taxPercent / 100);
            var totalActual = parseFloat(totalAfterDiscount) + parseFloat(taxValue);
            ctx.fillText(itemName, canvas.width - 2300, yHeight);
            ctx.fillText(itemValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 1950, yHeight);
            ctx.fillText(days, canvas.width - 1700, yHeight);
            ctx.fillText(itemTotal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 1510, yHeight);
            ctx.fillText(discountValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 1200, yHeight);
            ctx.fillText(totalAfterDiscount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 910, yHeight);
            ctx.fillText(taxValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 620, yHeight);
            ctx.fillText(totalActual.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }), canvas.width - 310, yHeight);

            return yHeight + 88; // Update yHeight for the next item
        }
        async function sendArReceiptToWhatsApp() {
            try {
                const imageLessor = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArExternalCatchReceipt";
                const imagePath = imageLessor.replace('~', '');
                const dates = getFormattedDatesMiliadiAndHijri("ar");
                const miladiDateString = dates.miladiDate;
                const hijriDateString = dates.hijriDate;
                // First In Page
                const contractNo = "@ViewBag.ContractNo";
                const accountReceiptNo = "@ViewBag.AccountReceiptNo";
                var selectElement = document.getElementById("Contract_PaymentMethod");
                var selectedOption = selectElement.options[selectElement.selectedIndex];
                // Get the text of the selected option
                const selectedText = selectedOption.textContent || selectedOption.innerText;
                var selectedArabicName = selectedOption.dataset.ar;
                //get Data Director lessor and branch and get renter and user
                var reasonPayment = document.getElementById("FormControl-last-Textarea").value;
                var AmountPayedInput = document.getElementById("AmountPayed").value;
                const AmountPayed = parseFloat(AmountPayedInput).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                const [beforeDecimal, afterDecimal] = splitNumberbeforeAndafterDecimal(AmountPayed);
                const numberToText = await dataChanged(AmountPayed);
                const [firstHalf, secondHalf] = splitTextInHalf(numberToText.ar_concatenate)
                var phaseFor = `${contractNo}  دفعة تحت الحساب لعقد ايجار السيارة لعقد`;

                // Signture Image
                const RenterName = decodeHTMLEntities(RenterInformation.personalArName);
                var renterSignture = RenterInformation.signture.replace('~', '');
                var userName = decodeHTMLEntities("@user.CrMasUserInformationArName");
                var userSignture = decodeHTMLEntities("@user.CrMasUserInformationSignature").replace('~', '');
                var directorOfLessor = decodeHTMLEntities("@user.CrMasUserInformationLessorNavigation.CrMasLessorInformationDirectorArName");
                var directorOfLessorSignture = decodeHTMLEntities("@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageSignatureDirector").replace('~', '');
                var directorOfBranch = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorArName");
                var directorOfBranchSignture = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorSignature").replace('~', '');
                const signatureImg1 = await loadImage(directorOfLessorSignture);
                const signatureImg2 = await loadImage(userSignture);
                const signatureImg3 = await loadImage(directorOfBranchSignture);
                var signatureImg4 = "";
                if (renterSignture) {
                    signatureImg4 = await loadImage(renterSignture);
                }
                // Get Image And Text On
                // Read the image file as a Blob
                let canvas_width = 2481;
                let texts = [
                    { content: accountReceiptNo, x: canvas_width - 1860, y: 624 },
                    { content: hijriDateString, x: canvas_width - 300, y: 624 },
                    { content: miladiDateString, x: canvas_width - 305, y: 685 },
                    { content: beforeDecimal, x: canvas_width - 2005, y: 720 },
                    { content: afterDecimal, x: canvas_width - 1940, y: 720 },
                    { content: RenterName, x: canvas_width - 480, y: 905 },
                    { content: firstHalf, x: canvas_width - 380, y: 1005 },
                    { content: secondHalf, x: canvas_width - 380, y: 1070 },
                    { content: selectedArabicName, x: canvas_width - 400, y: 1185 },
                    { content: phaseFor, x: canvas_width - 390, y: 1285 },
                    { content: reasonPayment, x: canvas_width - 350, y: 1385 },

                    { content: directorOfLessor, x: canvas_width - 320, y: 1568 },
                    { content: userName, x: canvas_width - 1120, y: 1568 },
                    { content: directorOfBranch, x: canvas_width - 290, y: 1705 },
                    { content: RenterName, x: canvas_width - 1120, y: 1705 },

                ];
                let signatures = [
                    { content: signatureImg1, x: canvas_width - 400, y: 1495, width: 200, height: 100 },
                    { content: signatureImg2, x: canvas_width - 1170, y: 1495, width: 200, height: 100 },
                    { content: signatureImg3, x: canvas_width - 400, y: 1630, width: 200, height: 100 }
                ];
                if (signatureImg4 !== "") {
                    signatures.push({ content: signatureImg4, x: canvas_width - 1170, y: 1630, width: 200, height: 100 });
                }
                let textStyleOptions = {
                    fontWeight: "bold",
                    fontSize: 37,
                    fontFamily: "serif",
                    textColor: "rgba(0, 0, 0)",
                    textAlign: "right"
                };
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                let canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    let loadedImageWidth = img.width;
                    let loadedImageHeight = img.height;

                    canvas.width = loadedImageWidth;
                    canvas_width = loadedImageWidth;
                    canvas.height = loadedImageHeight;

                    ctx.drawImage(img, 0, 0);

                    texts.forEach(text => {
                        ctx.font = `${textStyleOptions.fontWeight} ${textStyleOptions.fontSize}px ${textStyleOptions.fontFamily}`;
                        ctx.fillStyle = textStyleOptions.textColor;

                        let textWidth = ctx.measureText(text.content).width;

                        let x = text.x;
                        if (textStyleOptions.textAlign === "right") {
                            x -= textWidth;
                        } else if (textStyleOptions.textAlign === "center") {
                            x -= textWidth / 2;
                        }

                        ctx.fillText(text.content, x, text.y);

                    });

                    signatures.forEach(signature => {
                        let signatureWidth = ctx.measureText(signature.content).width;
                        let x = signature.x;
                        if (textStyleOptions.textAlign === "right") {
                            x -= signatureWidth;
                        } else if (textStyleOptions.textAlign === "center") {
                            x -= signatureWidth / 2;
                        }
                        ctx.drawImage(signature.content, x, signature.y, signature.width, signature.height);
                    });

                    canvas.toBlob(async function (blob) {
                        createPdfAndSendToWhatsApp(accountReceiptNo, null, blob, "SavePdfArReceipt", "ar");
                    }, 'image/png');
                };
                img.src = URL.createObjectURL(blob);
            } catch (error) {
                console.error("Error creating Arabic Receipt:", error);
                window.location.href = "/BS/Contract/FailedToast?type=arreceipt";
            }
        };
        async function sendEnReceiptToWhatsApp() {
            try {
                const imageLessor = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnExternalCatchReceipt";
                const imagePath = imageLessor.replace('~', '');
                const dates = getFormattedDatesMiliadiAndHijri("en");
                const miladiDateString = dates.miladiDate;
                const hijriDateString = dates.hijriDate;
                // First In Page
                const contractNo = "@ViewBag.ContractNo";
                const accountReceiptNo = "@ViewBag.AccountReceiptNo";

                var selectElement = document.getElementById("Contract_PaymentMethod");
                var selectedOption = selectElement.options[selectElement.selectedIndex];
                // Get the text of the selected option
                const selectedText = selectedOption.textContent || selectedOption.innerText;
                var selectedEnglishName = selectedOption.dataset.en;
                //get Data Director lessor and branch and get renter and user
                var reasonPayment = document.getElementById("FormControl-last-Textarea").value;
                var AmountPayedInput = document.getElementById("AmountPayed").value;
                const AmountPayed = parseFloat(AmountPayedInput).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                const numberToText = await dataChanged(AmountPayed);
                // Signture Image
                const RenterName = decodeHTMLEntities(RenterInformation.personalEnName);
                var renterSignture = RenterInformation.signture.replace('~', '');
                var userName = decodeHTMLEntities("@user.CrMasUserInformationEnName");
                var userSignture = decodeHTMLEntities("@user.CrMasUserInformationSignature").replace('~', '');
                var directorOfLessor = decodeHTMLEntities("@user.CrMasUserInformationLessorNavigation.CrMasLessorInformationDirectorEnName");
                var directorOfLessorSignture = decodeHTMLEntities("@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageSignatureDirector").replace('~', '');
                var directorOfBranch = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorEnName");
                var directorOfBranchSignture = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorSignature").replace('~', '');
                const signatureImg1 = await loadImage(directorOfLessorSignture);
                const signatureImg2 = await loadImage(userSignture);
                const signatureImg3 = await loadImage(directorOfBranchSignture);
                var signatureImg4 = "";
                if (renterSignture) {
                    signatureImg4 = await loadImage(renterSignture);
                }
                //////////////////////////////////////////////////////////////////////////////////////////////////////////


                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);
                    ctx.font = "bold 33px serif";
                    ctx.textAlign = "left";
                    ctx.fillStyle = "black";


                    ctx.fillText(miladiDateString, canvas.width - 2215, 700);
                    ctx.fillText(hijriDateString, canvas.width - 2235, 630);

                    ctx.font = "bold 37px serif";
                    ctx.fillText(accountReceiptNo, canvas.width - 620, 625);

                    var [beforeDecimalNumber, afterDecimalNumber] = splitNumberbeforeAndafterDecimal(AmountPayed);

                    // Assuming `ctx` is your canvas context
                    ctx.fillText(beforeDecimalNumber, canvas.width - 450, 720);
                    ctx.fillText(afterDecimalNumber, canvas.width - 270, 720);

                    ctx.fillText(RenterName, canvas.width - 2050, 900);
                    ctx.fillText(numberToText.en_concatenate, canvas.width - 2100, 1013);
                    ctx.fillText(selectedEnglishName, canvas.width - 2000, 1200);

                    // //Total
                    var phaseFor = `Payment to extend the car rental contract ${contractNo}`;
                    ctx.fillText(phaseFor, canvas.width - 2250, 1310);
                    ctx.fillText(reasonPayment, canvas.width - 2050, 1420);
                    ctx.font = "bold 37px serif";

                    ctx.fillText(directorOfLessor, canvas.width - 1990, 1560);
                    ctx.drawImage(signatureImg1, canvas.width - 1700, 1505, 200, 100);

                    ctx.fillText(userName, canvas.width - 1300, 1560);
                    ctx.drawImage(signatureImg2, canvas.width - 900, 1505, 200, 100);

                    ctx.fillText(directorOfBranch, canvas.width - 2020, 1690);
                    ctx.drawImage(signatureImg3, canvas.width - 1700, 1630, 200, 100);
                    ctx.fillText(RenterName, canvas.width - 1300, 1690);
                    if (signatureImg4 !== "") {
                        ctx.drawImage(signatureImg4, canvas.width - 900, 1630, 200, 100);
                    }
                    canvas.toBlob(async function (blob) {
                        createPdfAndSendToWhatsApp(accountReceiptNo, null, blob, "SavePdfEnReceipt", "en");
                    }, 'image/png');
                };
                img.src = URL.createObjectURL(blob);
            } catch (error) {
                console.error("Error creating English Receipt:", error);
                window.location.href = "/BS/Contract/FailedToast?type=enreceipt";
            }
        };
        function calculateTotalAmountPerDay(rent, auth, feature, privateDriver, additionalDriver, additionals, choices, days) {
            var daysNo = parseInt(days);
            var total = (rent * daysNo) + (auth) + (feature * daysNo) + (additionalDriver) + (privateDriver * daysNo) + (additionals) + (choices * daysNo);
            return total;
        }
        function calculateTotalDiscountAmount(total, discount) {
            var discountValue = parseFloat(discount) / 100;
            var totalDiscount = total * discountValue;
            return totalDiscount;
        }
    </script>
    <!--Create Ar Contract Pdf-->
    <script>
        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = () => reject(new Error(`Failed to load image: ${src}`));
                img.src = src;
            });
        }
        async function loadArSignatures() {
            console.log("RenterInformation.signture", RenterInformation.signture);
            var renterName = RenterInformation.personalArName;
            var renterSignature = RenterInformation.signture.replace('~', '');
            var userName = decodeHTMLEntities("@user.CrMasUserInformationArName");
            var userSignature = decodeHTMLEntities("@user.CrMasUserInformationSignature").replace('~', '');
            var directorOfLessor = decodeHTMLEntities("@user.CrMasUserInformationLessorNavigation.CrMasLessorInformationDirectorArName");
            var directorOfLessorSignature = decodeHTMLEntities("@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageSignatureDirector").replace('~', '');
            var directorOfBranch = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorArName");
            var directorOfBranchSignature = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorSignature").replace('~', '');

            const promises = [
                loadImage(directorOfLessorSignature),
                loadImage(userSignature),
                loadImage(directorOfBranchSignature)
            ];

            if (renterSignature) {
                promises.push(loadImage(renterSignature));
            }

            const [signatureImg1, signatureImg2, signatureImg3, signatureImg4] = await Promise.all(promises);

            return {
                renterName: renterName,
                userName: userName,
                directorOfLessor: directorOfLessor,
                directorOfBranch: directorOfBranch,
                signatureImg1: signatureImg1,
                signatureImg2: signatureImg2,
                signatureImg3: signatureImg3,
                signatureImg4: renterSignature ? signatureImg4 : null
            };
        }
        function DrawArNameAndSignture(signatures, ctx, canvas) {
            ctx.fillText(signatures.directorOfLessor, canvas.width - 315, 3055);
            ctx.drawImage(signatures.signatureImg1, canvas.width - 820, 2980, 200, 100);
            ctx.fillText(signatures.userName, canvas.width - 1120, 3055);
            ctx.drawImage(signatures.signatureImg2, canvas.width - 1620, 2980, 200, 100);
            ctx.fillText(signatures.directorOfBranch, canvas.width - 280, 3190);
            ctx.drawImage(signatures.signatureImg3, canvas.width - 820, 3120, 200, 100);
            ctx.fillText(signatures.renterName, canvas.width - 1140, 3190);
            if (signatures.signatureImg4) {
                ctx.drawImage(signatures.signatureImg4, canvas.width - 1620, 3120, 200, 100);
            }
        }
        //Page1
        const getArDataOfPage1 = () => {
            // Contract Info
            const contractNo = "@ViewBag.ContractNo";
            var dateTimeNow = decodeHTMLEntities('@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fffK")');
            var startDate = new Date(dateTimeNow);
            var daysNo = parseInt(document.getElementById('dayNo').value);
            var endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + daysNo);
            const miladiDate = new Date(dateTimeNow);
            return {
                contractNo: "@ViewBag.ContractNo" || "",
                miladiDateString: getFormatDate(miladiDate) || "",
                startMiladiDate: getFormatDate(startDate) || "",
                endMiladiDate: getFormatDate(endDate) || "",
                currentHijriDate: formatHijriDate(miladiDate) || "",
                startHijriDate: formatHijriDate(startDate) || "",
                endHijriDate: formatHijriDate(endDate) || "",
                status: "جديد",
                branchName: decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationArName") || "",
                branchPhone: (decodeHTMLEntities("@Model.CrCasBranchInformation.CrMasBranchInformationTeleKey") + decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationTelephone")) || "",
                branchMobile: (decodeHTMLEntities("@Model.CrCasBranchInformation.CrMasBranchInformationMobileKey") + decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationMobile")) || "",
                branchEmail: decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationLessorNavigation.CrMasLessorInformationEmail") || "",
                branchPost: decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchPost.CrCasBranchPostArConcatenate") || "",
                CarName: CarInformationForContract.crCasCarInformationConcatenateArName || "",
                CarSerialNo: CarInformationForContract.crCasCarInformationSerailNo || "",
                CarRegistration: CarInformationForContract.registerationAr || "",
                CarFuel: CarInformationForContract.fuelAr || "",
                CarCVT: CarInformationForContract.cvtAr || "",
                RunningCardNo: CarInformationForContract.runningCardNo || "",
                RunningCardEndDate: CarInformationForContract.runningCardEndDate || "",
                InsurancePolicyNo: CarInformationForContract.insurancePolicyNo || "",
                InsurancePolicyEndDate: CarInformationForContract.insurancePolicyEndDate || "",
                PeriodicInspectionNo: CarInformationForContract.periodicInspectionNo || "",
                RenterName: RenterInformation.personalArName || "",
                RenterId: RenterInformation.renterID || "",
                RenterMembership: RenterInformation.arMembership || "",
                RenterEmail: RenterInformation.personalEmail || "",
                RenterPost: RenterInformation.postArNameConcenate || "",
                RenterReasons: $("#Contract_RenterReasons").val() || ""
            };
        };
        const CreateArPageContract1 = async () => {
            return new Promise(async (resolve, reject) => {
                try {
                    console.log("RenterInformation FirstPage", RenterInformation);
                    var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage1";
                    var imagePath = image.replace('~', '');
                    // Contract Info
                    const contractNo = "@ViewBag.ContractNo";
                    // get data For Page 1
                    var Data = getArDataOfPage1();
                    var signtures = await loadArSignatures();
                    const responseImage = await fetch(imagePath);
                    const blob = await responseImage.blob();
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    var url;
                    var img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = function () {
                        canvas.width = img.width;
                        canvas.height = img.height;

                        ctx.drawImage(img, 0, 0);

                        ctx.font = "bold 35px serif";
                        ctx.textAlign = "right";
                        ctx.fillStyle = "black";
                        //Contract
                        ctx.fillText(Data.contractNo, canvas.width - 380, 790);
                        ctx.fillText(Data.currentHijriDate, canvas.width - 300, 870);
                        ctx.fillText(Data.miladiDateString, canvas.width - 1120, 870);
                        ctx.fillText(Data.startHijriDate, canvas.width - 390, 945);
                        ctx.fillText(Data.startMiladiDate, canvas.width - 1120, 945);
                        ctx.fillText(Data.endHijriDate, canvas.width - 430, 1025);
                        ctx.fillText(Data.endMiladiDate, canvas.width - 1120, 1025);
                        ctx.fillText(Data.status, canvas.width - 390, 1105);
                        //Branch
                        ctx.font = "bold 50px serif";
                        ctx.fillText(Data.branchName, canvas.width - 175, 1275);
                        ctx.font = "bold 35px serif";
                        ctx.fillText(Data.branchMobile, canvas.width - 325, 1390);
                        ctx.fillText(Data.branchPhone, canvas.width - 1090, 1390);
                        ctx.fillText(Data.branchEmail, canvas.width - 460, 1475);
                        ctx.fillText(Data.branchPost, canvas.width - 330, 1560);
                        //Car
                        ctx.font = "bold 50px serif";
                        ctx.fillText(Data.CarName, canvas.width - 175, 1750);
                        ctx.font = "bold 35px serif";
                        ctx.fillText(Data.CarSerialNo, canvas.width - 455, 1870);
                        ctx.fillText(Data.CarRegistration, canvas.width - 360, 1955);
                        ctx.fillText(Data.CarFuel, canvas.width - 1150, 1955);
                        ctx.fillText(Data.CarCVT, canvas.width - 1685, 1955);
                        ctx.fillText(Data.PeriodicInspectionNo, canvas.width - 470, 2040);
                        ctx.fillText(Data.RunningCardNo, canvas.width - 455, 2122)
                        ctx.fillText(Data.RunningCardEndDate, canvas.width - 1630, 2122);
                        ctx.fillText(Data.InsurancePolicyNo, canvas.width - 420, 2207);
                        ctx.fillText("", canvas.width - 1160, 2207);
                        ctx.fillText(Data.InsurancePolicyEndDate, canvas.width - 1630, 2207);
                        // Renter
                        ctx.font = "bold 50px serif";
                        ctx.fillText(Data.RenterName, canvas.width - 175, 2390);
                        ctx.font = "bold 35px serif";
                        ctx.fillText(Data.RenterId, canvas.width - 300, 2505);
                        ctx.fillText("", canvas.width - 420, 2590);
                        ctx.fillText(Data.RenterMembership, canvas.width - 1160, 2590);
                        ctx.fillText(Data.RenterEmail, canvas.width - 460, 2675);
                        ctx.fillText(Data.RenterPost, canvas.width - 330, 2770);
                        ctx.fillText(Data.RenterReasons, canvas.width - 355, 2850);
                        // Last
                        DrawArNameAndSignture(signtures, ctx, canvas);
                        canvas.toBlob(async function (blob) {
                            // Return the blob

                            resolve(blob);
                        }, "image/png");
                    };
                    img.src = imagePath;
                } catch (error) {
                    reject(error);
                }
            });
        };
        //Page2
        const getDataOfPage2 = () => {
            const getFormattedDate = (date) => date ? getFormatDate(date) : "";
            return {
                DriverName: DriverInformation?.personalArName || "",
                DriverId: DriverInformation?.renterID || "",
                DriverBirthDate: getFormattedDate(DriverInformation?.birthDate),
                DriverGender: DriverInformation?.personalArGender || "",
                DriverNationality: DriverInformation?.personalArNationality || "",
                DriverLicense: DriverInformation?.licenseArName || "",
                DriverLicenseNo: DriverInformation?.licenseCode || "",
                DriverLicenseExpiryDate: getFormattedDate(DriverInformation?.licenseExpiryDate),
                DriverEmployerName: DriverInformation?.employerArName || "",
                DriverMembership: DriverInformation?.arMembership || "",
                DriverPersonalProfessions: DriverInformation?.personalArProfessions || "",
                DriverPersonalEmail: DriverInformation?.personalEmail || "",
                DriverPostNameConcenate: DriverInformation?.postArNameConcenate || "",
                DriverReasons: $("#Contract_DriverReasons").val() || "",

                AddDriverName: AddDriverInformation?.personalArName || "",
                AddDriverId: AddDriverInformation?.renterID || "",
                AddDriverBirthDate: getFormattedDate(AddDriverInformation?.birthDate),
                AddDriverGender: AddDriverInformation?.personalArGender || "",
                AddDriverNationality: AddDriverInformation?.personalArNationality || "",
                AddDriverLicense: AddDriverInformation?.licenseArName || "",
                AddDriverLicenseNo: AddDriverInformation?.licenseCode || "",
                AddDriverLicenseExpiryDate: getFormattedDate(AddDriverInformation?.licenseExpiryDate),
                AddDriverEmployerName: AddDriverInformation?.employerArName || "",
                AddDriverMembership: AddDriverInformation?.arMembership || "",
                AddDriverPersonalProfessions: AddDriverInformation?.personalArProfessions || "",
                AddDriverPersonalEmail: AddDriverInformation?.personalEmail || "",
                AddDriverPostNameConcenate: AddDriverInformation?.postArNameConcenate || "",
                AddDriverReasons: $("#Contract_AddDriverReasons").val() || "",

                PrivateDriverName: PrivateDriverInformation?.personalArName || "",
                PrivateDriverId: PrivateDriverInformation?.renterID || "",
                PrivateDriverBirthDate: getFormattedDate(PrivateDriverInformation?.birthDate),
                PrivateDriverGender: PrivateDriverInformation?.personalArGender || "",
                PrivateDriverNationality: PrivateDriverInformation?.personalArNationality || "",
                PrivateDriverLicense: PrivateDriverInformation?.licenseArName || "",
                PrivateDriverLicenseNo: PrivateDriverInformation?.licenseCode || "",
                PrivateDriverLicenseExpiryDate: getFormattedDate(PrivateDriverInformation?.licenseExpiryDate),
                PrivateDriverEmployerName: PrivateDriverInformation?.employerArName || "",
                PrivateDriverPersonalProfessions: PrivateDriverInformation?.personalArProfessions || "",
                PrivateDriverPersonalEmail: PrivateDriverInformation?.personalEmail || "",
                PrivateDriverPostNameConcenate: PrivateDriverInformation?.postArNameConcenate || "",
            };
        };
        const CreateArPageContract2 = async () => {
            return new Promise(async (resolve, reject) => {
                try {
                    var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage2";
                    var imagePath = image.replace('~', '');
                    // Get ALl Date for Page 2
                    const Data = getDataOfPage2();
                    var signtures = await loadArSignatures();

                    // Last Director and manger and user and renter with signture

                    // Text on Image
                    // Get Image And Text On
                    // Read the image file as a Blob
                    const responseImage = await fetch(imagePath);
                    const blob = await responseImage.blob();
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    var url;
                    var img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = function () {
                        canvas.width = img.width;
                        canvas.height = img.height;

                        ctx.drawImage(img, 0, 0);

                        ctx.font = "bold 35px serif";
                        ctx.textAlign = "right";
                        ctx.fillStyle = "black";
                        // Driver
                        ctx.font = "bold 50px serif";
                        ctx.fillText(Data.DriverName, canvas.width - 220, 680);
                        ctx.font = "bold 35px serif";
                        ctx.fillText(Data.DriverId, canvas.width - 405, 790);
                        ctx.fillText(Data.DriverBirthDate, canvas.width - 420, 870);
                        ctx.fillText(Data.DriverGender, canvas.width - 1140, 870);
                        ctx.fillText(Data.DriverNationality, canvas.width - 1690, 865);
                        ctx.fillText(Data.DriverLicense, canvas.width - 470, 955);
                        ctx.fillText(Data.DriverLicenseNo, canvas.width - 1120, 952);
                        ctx.fillText(Data.DriverLicenseExpiryDate, canvas.width - 1655, 952);
                        ctx.fillText(Data.DriverPersonalProfessions, canvas.width - 340, 1040);
                        ctx.fillText(Data.DriverMembership, canvas.width - 1155, 1040);
                        ctx.fillText(Data.DriverEmployerName, canvas.width - 405, 1125);
                        ctx.fillText(Data.DriverPersonalEmail, canvas.width - 500, 1200);
                        ctx.fillText(Data.DriverPostNameConcenate, canvas.width - 370, 1290);
                        ctx.fillText(Data.DriverReasons, canvas.width - 410, 1375);
                        // Add Driver
                        ctx.font = "bold 50px serif";
                        ctx.fillText(Data.AddDriverName, canvas.width - 225, 1555);
                        ctx.font = "bold 35px serif";
                        ctx.fillText(Data.AddDriverId, canvas.width - 410, 1655);
                        ctx.fillText(Data.AddDriverBirthDate, canvas.width - 420, 1740);
                        ctx.fillText(Data.AddDriverGender, canvas.width - 1140, 1740);
                        ctx.fillText(Data.AddDriverNationality, canvas.width - 1690, 1735);
                        ctx.fillText(Data.AddDriverLicense, canvas.width - 470, 1820);
                        ctx.fillText(Data.AddDriverLicenseNo, canvas.width - 1110, 1820);
                        ctx.fillText(Data.AddDriverLicenseExpiryDate, canvas.width - 1640, 1820);
                        ctx.fillText(Data.AddDriverPersonalProfessions, canvas.width - 340, 1905);
                        ctx.fillText(Data.AddDriverMembership, canvas.width - 1150, 1905);
                        ctx.fillText(Data.AddDriverEmployerName, canvas.width - 430, 1990);
                        ctx.fillText(Data.AddDriverPersonalEmail, canvas.width - 500, 2070);
                        ctx.fillText(Data.AddDriverPostNameConcenate, canvas.width - 350, 2160);
                        ctx.fillText(Data.AddDriverReasons, canvas.width - 410, 2240);
                        // Private Driver
                        ctx.font = "bold 50px serif";
                        ctx.fillText(Data.PrivateDriverName, canvas.width - 220, 2410);
                        ctx.font = "bold 35px serif";
                        ctx.fillText(Data.PrivateDriverId, canvas.width - 400, 2510);
                        ctx.fillText(Data.PrivateDriverBirthDate, canvas.width - 420, 2590);
                        ctx.fillText(Data.PrivateDriverGender, canvas.width - 1140, 2595);
                        ctx.fillText(Data.PrivateDriverNationality, canvas.width - 1690, 2595);
                        ctx.fillText(Data.PrivateDriverLicense, canvas.width - 470, 2680);
                        ctx.fillText(Data.PrivateDriverLicenseNo, canvas.width - 1115, 2680);
                        ctx.fillText(Data.PrivateDriverLicenseExpiryDate, canvas.width - 1655, 2680);
                        ctx.fillText(Data.PrivateDriverPersonalEmail, canvas.width - 500, 2770);
                        // Last
                        DrawArNameAndSignture(signtures, ctx, canvas);
                        canvas.toBlob(async function (blob) {
                            // Return the blob

                            resolve(blob);
                        }, "image/png");
                    };
                    img.src = imagePath;
                } catch (error) {
                    reject(error);
                }
            });
        };
        //Page3
        const getDataOfPage3 = () => {
            const contractNo = "@ViewBag.ContractNo";
            const fromBranchName = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationArShortName") || "";
            var selectedOptionBrn = $("#Receiving-branch-dropdown option:selected");
            const toBranchName = selectedOptionBrn.data('ar') || '';
            const geographicDistict = document.getElementById('Delegate-out').checked ? "خارج المملكة" : "داخل المملكة";
            const freeHours = CarInformation.carPrice.crCasPriceCarBasicFreeAdditionalHours || "";
            const freeKM = CarInformation.carPrice.crCasPriceCarBasicNoDailyFreeKm || "";
            const age = `${CarInformation?.carPrice?.crCasPriceCarBasicMinAge || ""} - ${CarInformation?.carPrice?.crCasPriceCarBasicMaxAge || ""}`;
            var rentDaily = CarInformation.carPrice.crCasPriceCarBasicDailyRent || "";
            var maxHourValue = CarInformation.carPrice.crCasPriceCarBasicExtraHourValue || "";
            var addKmValue = CarInformation.carPrice.crCasPriceCarBasicAdditionalKmValue || "";
            var advatagesValue = $("#AdvatagesValue").text() || "";
            var choicesValue = $("#ChoicesValue").text() || "";
            var additionalValue = $("#AdditionalValue").text() || "";
            var addDriverValue = CarInformation.carPrice.crCasPriceCarBasicAdditionalDriverValue || "";
            var privateDriverValue = CarInformation.carPrice.crCasPriceCarBasicPrivateDriverValue || "";
            var compensationAccident = CarInformation.carPrice.crCasPriceCarBasicCompensationAccident || "";
            var compensationTheft = CarInformation.carPrice.crCasPriceCarBasicCompensationTheft || "";
            var compensationFire = CarInformation.carPrice.crCasPriceCarBasicCompensationFire || "";
            var compensationDrowning = CarInformation.carPrice.crCasPriceCarBasicCompensationDrowning || "";

            return {
                contractNo,
                fromBranchName,
                toBranchName,
                geographicDistict,
                freeHours,
                freeKM,
                age,
                rentDaily,
                maxHourValue,
                addKmValue,
                advatagesValue,
                choicesValue,
                additionalValue,
                addDriverValue,
                privateDriverValue,
                compensationAccident,
                compensationTheft,
                compensationFire,
                compensationDrowning
            };
        };
        function getAdditionalData(ctx, canvas) {
            var yOffset = 1840; // Initial y-offset for name
            var valueXOffset = canvas.width - 1460; // X-offset for value
            var nameXOffset = canvas.width - 950; // X-offset for name
            AdditionalsItems.forEach(function (item, index) {
                var nameText = item.arName.trim();
                var valueText = item.value;
                // Set fillText for name
                ctx.fillText(nameText, nameXOffset, yOffset + (index * 70));
                // Set fillText for value
                ctx.fillText(valueText, valueXOffset, yOffset + (index * 70));
            });
        };
        function getChoicesData(ctx, canvas) {
            var yOffset = 1840; // Initial y-offset for name
            var valueXOffset = canvas.width - 700; // X-offset for value
            var nameXOffset = canvas.width - 250; // X-offset for name
            ChoiceItems.forEach(function (item, index) {
                var nameText = item.arName.trim();
                var valueText = item.value;
                // Set fillText for name
                ctx.fillText(nameText, nameXOffset, yOffset + (index * 70));
                // Set fillText for value
                ctx.fillText(valueText, valueXOffset, yOffset + (index * 70));
            });
        };
        function getAdvantagesData(ctx, canvas) {
            var yOffset = 1840; // Initial y-offset for name
            var valueXOffset = canvas.width - 2220; // X-offset for value
            var nameXOffset = canvas.width - 1700; // X-offset for name
            CarAdvantages.forEach(function (item, index) {
                var nameText = item.arName;
                var valueText = item.advantagesValue;
                // Set fillText for name
                ctx.fillText(nameText, nameXOffset, yOffset + (index * 70));
                // Set fillText for value
                ctx.fillText(valueText, valueXOffset, yOffset + (index * 70));
            });
        }
        const CreateArPageContract3 = async () => {
            return new Promise(async (resolve, reject) => {
                try {
                    var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage3";
                    var imagePath = image.replace('~', '');
                    // Get ALl Date for Page 2
                    var Data = getDataOfPage3();
                    var signtures = await loadArSignatures();
                    // Last Director and manger and user and renter with signture
                    // Text on Image
                    // Get Image And Text On
                    // Read the image file as a Blob
                    const responseImage = await fetch(imagePath);
                    const blob = await responseImage.blob();
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    var url;
                    var img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = function () {
                        canvas.width = img.width;
                        canvas.height = img.height;

                        ctx.drawImage(img, 0, 0);

                        ctx.font = "bold 35px serif";
                        ctx.textAlign = "right";
                        ctx.fillStyle = "black";
                        //
                        ctx.fillText(Data.fromBranchName, canvas.width - 365, 770);
                        ctx.fillText(Data.toBranchName, canvas.width - 1250, 770);
                        ctx.fillText(Data.geographicDistict, canvas.width - 485, 860);
                        ctx.fillText(Data.freeHours, canvas.width - 1305, 860);
                        ctx.fillText(Data.freeKM, canvas.width - 430, 953);
                        ctx.fillText(Data.age, canvas.width - 1155, 953);
                        ctx.fillText(Data.rentDaily, canvas.width - 410, 1045);
                        ctx.fillText(Data.advatagesValue, canvas.width - 1340, 1045);
                        ctx.fillText(Data.maxHourValue, canvas.width - 465, 1138);
                        ctx.fillText(Data.addKmValue, canvas.width - 1280, 1138);
                        ctx.fillText(Data.choicesValue, canvas.width - 335, 1230);
                        ctx.fillText(Data.additionalValue, canvas.width - 1220, 1230);
                        ctx.fillText(Data.addDriverValue, canvas.width - 435, 1325);
                        ctx.fillText(Data.privateDriverValue, canvas.width - 1300, 1325);
                        ctx.fillText(Data.compensationAccident, canvas.width - 1290, 1415);
                        ctx.fillText(Data.compensationTheft, canvas.width - 420, 1415);
                        ctx.fillText(Data.compensationFire, canvas.width - 410, 1515);
                        ctx.fillText(Data.compensationDrowning, canvas.width - 1280, 1515);
                        // Additonals
                        if (AdditionalsItems != null && AdditionalsItems.length != 0) {
                            getAdditionalData(ctx, canvas);
                        }
                        //Choices
                        if (ChoiceItems != null && ChoiceItems.length != 0) {
                            getChoicesData(ctx, canvas);
                        }
                        //AdvantagesData
                        if (CarAdvantages != null && CarAdvantages.length != 0) {
                            getAdvantagesData(ctx, canvas);
                        }
                        // Last
                        DrawArNameAndSignture(signtures, ctx, canvas);
                        canvas.toBlob(async function (blob) {
                            // Return the blob

                            resolve(blob);
                        }, "image/png");
                    };
                    img.src = imagePath;
                } catch (error) {
                    reject(error);
                }
            });
        };
        // Page4
        function GetCheckUpItems(ctx, canvas) {
            GetCheckUp();
            var yOffset = 885; // Initial y-offset for name
            var valueXOffset = canvas.width - 1050; // X-offset for value
            var nameXOffset = canvas.width - 500; // X-offset for name
            if (CarCheckUp != null && CarCheckUp.length > 0) {
                CarCheckUp.forEach(function (item, index) {
                    var nameText = item.arName;
                    var checkupReason = item.reasonCheck + (item.reason ? " - " + item.reason : "");
                    // Set fillText for name
                    ctx.fillText(nameText, nameXOffset, yOffset + (index * 70));
                    // Set fillText for value
                    ctx.fillText(checkupReason, valueXOffset, yOffset + (index * 70));
                });
            }
        }
        const CreateArPageContract4 = async () => {
            return new Promise(async (resolve, reject) => {
                try {
                    var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage4";
                    var imagePath = image.replace('~', '');                    // Get ALl Date for Page 4
                    // Last Director and manger and user and renter with signture
                    var signtures = await loadArSignatures();
                    ///////////////////////////////////////////////////////
                    // Text on Image
                    // Get Image And Text On
                    // Read the image file as a Blob
                    const responseImage = await fetch(imagePath);
                    const blob = await responseImage.blob();
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    var url;
                    var img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = function () {
                        canvas.width = img.width;
                        canvas.height = img.height;

                        ctx.drawImage(img, 0, 0);

                        ctx.font = "bold 35px serif";
                        ctx.textAlign = "right";
                        ctx.fillStyle = "black";

                        GetCheckUpItems(ctx, canvas);

                        // Last
                        DrawArNameAndSignture(signtures, ctx, canvas);
                        canvas.toBlob(async function (blob) {
                            // Return the blob

                            resolve(blob);
                        }, "image/png");
                    };
                    img.src = imagePath;
                } catch (error) {
                    reject(error);
                }
            });
        };
        // Page5
        async function GetCheckUpPicture() {
            // Array to store the Image objects
            const images = [];
            // Iterate over the CheckUpImages list
            imgCheckUpArray.forEach(file => {
                // Create a new Image object
                const img = new Image();

                // Set the src attribute of the Image object to the file URL
                img.src = URL.createObjectURL(file.f);

                // Push the Image object to the images array
                images.push(img);
            });
            // Return the array of Image objects
            return images;
        }
        const CreateArPageContract5 = async () => {
            return new Promise(async (resolve, reject) => {
                try {
                    var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage5";
                    var imagePath = image.replace('~', '');
                    // Get ALl Date for Page 5
                    var pictures = await GetCheckUpPicture();
                    // Last Director and manger and user and renter with signture
                    var signtures = await loadArSignatures();
                    ///////////////////////////////////////////////////////
                    // Text on Image
                    // Get Image And Text On
                    // Read the image file as a Blob
                    const responseImage = await fetch(imagePath);
                    const blob = await responseImage.blob();
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    var url;
                    var img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = function () {
                        canvas.width = img.width;
                        canvas.height = img.height;

                        ctx.drawImage(img, 0, 0);

                        ctx.font = "bold 35px serif";
                        ctx.textAlign = "right";
                        ctx.fillStyle = "black";
                        //
                        if (pictures[0]) {
                            ctx.drawImage(pictures[0], canvas.width - 1015, 750, 650, 650);
                        }
                        if (pictures[1]) {
                            ctx.drawImage(pictures[1], canvas.width - 1015, 1470, 650, 650);
                        }
                        if (pictures[2]) {
                            ctx.drawImage(pictures[2], canvas.width - 1015, 2185, 650, 650);
                        }
                        if (pictures[3]) {
                            ctx.drawImage(pictures[3], canvas.width - 2015, 750, 650, 650);
                        }
                        if (pictures[4]) {
                            ctx.drawImage(pictures[4], canvas.width - 2015, 1470, 650, 650);
                        }
                        if (pictures[5]) {
                            ctx.drawImage(pictures[5], canvas.width - 2015, 2185, 650, 650);
                        }
                        // Last
                        DrawArNameAndSignture(signtures, ctx, canvas);
                        canvas.toBlob(async function (blob) {
                            // Return the blob

                            resolve(blob);
                        }, "image/png");
                    };
                    img.src = imagePath;
                } catch (error) {
                    reject(error);
                }
            });
        };
        // Page6
        const CreateArPageContract6 = async () => {
            return new Promise(async (resolve, reject) => {
                try {
                    var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage6";
                    var imagePath = image.replace('~', '');
                    // Get ALl Date for Page 6
                    var pictures = await GetCheckUpPicture();
                    // Last Director and manger and user and renter with signture
                    var signtures = await loadArSignatures();
                    ///////////////////////////////////////////////////////
                    // Text on Image
                    // Get Image And Text On
                    // Read the image file as a Blob
                    const responseImage = await fetch(imagePath);
                    const blob = await responseImage.blob();
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    var url;
                    var img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = function () {
                        canvas.width = img.width;
                        canvas.height = img.height;

                        ctx.drawImage(img, 0, 0);

                        ctx.font = "bold 35px serif";
                        ctx.textAlign = "right";
                        ctx.fillStyle = "black";
                        ////////////
                        if (pictures[6]) {
                            ctx.drawImage(pictures[6], canvas.width - 1015, 750, 650, 650);
                        }
                        if (pictures[7]) {
                            ctx.drawImage(pictures[7], canvas.width - 1015, 1470, 650, 650);
                        }
                        if (pictures[8]) {
                            ctx.drawImage(pictures[8], canvas.width - 1015, 2185, 650, 650);
                        }
                        if (pictures[9]) {
                            ctx.drawImage(pictures[9], canvas.width - 2015, 750, 650, 650);
                        }
                        if (pictures[10]) {
                            ctx.drawImage(pictures[10], canvas.width - 2015, 1470, 650, 650);
                        }
                        if (pictures[11]) {
                            ctx.drawImage(pictures[11], canvas.width - 2015, 2185, 650, 650);
                        }
                        // Last
                        DrawArNameAndSignture(signtures, ctx, canvas);
                        canvas.toBlob(async function (blob) {
                            // Return the blob

                            resolve(blob);
                        }, "image/png");
                    };
                    img.src = imagePath;
                } catch (error) {
                    reject(error);
                }
            });
        };
        // Page7
        async function getContractConditionPic1() {
            const mainImg = new Image();
            var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractTerms1";
            var imagePath = image.replace('~', '');
            mainImg.src = imagePath;
            return mainImg;
        }
        const CreateArPageContract7 = async () => {
            return new Promise(async (resolve, reject) => {
                try {
                    var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage7";
                    var imagePath = image.replace('~', '');
                    // Last Director and manger and user and renter with signture
                    //Get Pic
                    // var mainImg = await getContractConditionPic1();
                    var signtures = await loadArSignatures();
                    ///////////////////////////////////////////////////////
                    // Text on Image
                    // Get Image And Text On
                    // Read the image file as a Blob
                    const responseImage = await fetch(imagePath);
                    const blob = await responseImage.blob();
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    var url;
                    var img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = function () {
                        canvas.width = img.width;
                        canvas.height = img.height;

                        ctx.drawImage(img, 0, 0);

                        ctx.font = "bold 35px serif";
                        ctx.textAlign = "right";
                        ctx.fillStyle = "black";
                        // //Get Pic
                        // ctx.drawImage(mainImg, canvas.width - 2190, 720, 1900, 2120);
                        // // Last
                        DrawArNameAndSignture(signtures, ctx, canvas);
                        canvas.toBlob(async function (blob) {
                            // Return the blob

                            resolve(blob);
                        }, "image/png");
                    };
                    img.src = imagePath;
                } catch (error) {
                    reject(error);
                }
            });
        };
        // Page8
        async function getContractConditionPic2() {
            const mainImg = new Image();
            var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractTerms2";
            var imagePath = image.replace('~', '');
            mainImg.src = imagePath;
            return mainImg;
        }
        const CreateArPageContract8 = async () => {
            return new Promise(async (resolve, reject) => {
                try {
                    var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage8";
                    var imagePath = image.replace('~', '');
                    // Last Director and manger and user and renter with signture
                    //Get Pic
                    // var mainImg = await getContractConditionPic2();
                    var signtures = await loadArSignatures();
                    // Text on Image
                    // Get Image And Text On
                    // Read the image file as a Blob
                    const responseImage = await fetch(imagePath);
                    const blob = await responseImage.blob();
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    var url;
                    var img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = function () {
                        canvas.width = img.width;
                        canvas.height = img.height;

                        ctx.drawImage(img, 0, 0);

                        ctx.font = "bold 35px serif";
                        ctx.textAlign = "right";
                        ctx.fillStyle = "black";

                        // ctx.drawImage(mainImg, canvas.width - 2190, 720, 1900, 2120);
                        // Last
                        DrawArNameAndSignture(signtures, ctx, canvas);
                        canvas.toBlob(async function (blob) {
                            // Return the blob

                            resolve(blob);
                        }, "image/png");
                    };
                    img.src = imagePath;
                } catch (error) {
                    reject(error);
                }
            });
        };
        // Page9
        async function getContractConditionPic3() {
            const mainImg = new Image();
            var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractTerms3";
            var imagePath = image.replace('~', '');
            mainImg.src = imagePath;
            return mainImg;
        }
        const CreateArPageContract9 = async () => {
            return new Promise(async (resolve, reject) => {
                try {
                    var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage9";
                    var imagePath = image.replace('~', '');
                    // Get ALl Date for Page 9
                    // var mainImg = await getContractConditionPic3();
                    var signtures = await loadArSignatures();
                    // Last Director and manger and user and renter with signture
                    // Text on Image
                    // Get Image And Text On
                    // Read the image file as a Blob
                    const responseImage = await fetch(imagePath);
                    const blob = await responseImage.blob();
                    var canvas = document.createElement("canvas");
                    var ctx = canvas.getContext("2d");
                    var url;
                    var img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = function () {
                        canvas.width = img.width;
                        canvas.height = img.height;

                        ctx.drawImage(img, 0, 0);

                        ctx.font = "bold 35px serif";
                        ctx.textAlign = "right";
                        ctx.fillStyle = "black";
                        // //Get Pic
                        // ctx.drawImage(mainImg, canvas.width - 2190, 720, 1900, 2120);
                        // // Last
                        DrawArNameAndSignture(signtures, ctx, canvas);
                        canvas.toBlob(async function (blob) {
                            // Return the blob

                            resolve(blob);
                        }, "image/png");
                    };
                    img.src = imagePath;
                } catch (error) {
                    reject(error);
                }
            });
        };
        async function getPictureAndCreateArPdfContract() {
            try {
                console.log("Starting getPictureAndCreateArPdfContract");
                // Function to check if the image exists
                async function imageExists(imagePath) {
                    try {
                        const response = await fetch(imagePath);
                        return response.ok;
                    } catch (error) {
                        console.error(`Error checking image at ${imagePath}:`, error);
                        return false;
                    }
                }
                const createPageFunctions = [
                    { func: CreateArPageContract1, order: 1 },
                    { func: CreateArPageContract2, order: 2 },
                    { func: CreateArPageContract3, order: 3 },
                    { func: CreateArPageContract4, order: 4 },
                    { func: CreateArPageContract5, order: 5 },
                ];

                if (imgCheckUpArray.length > 6) {
                    createPageFunctions.push({ func: CreateArPageContract6, order: 6 });
                }
                // Paths to the terms images
                // const termsImagePaths = [
                //     "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractTerms1",
                //     "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractTerms2",
                //     "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractTerms3"
                // ];

                // Corresponding create page functions for termsImagePaths
                const termsCreatePageFunctions = [
                    CreateArPageContract7,
                    CreateArPageContract8,
                    CreateArPageContract9
                ];

                // Paths to the pages images
                const pageImagePaths = [
                    "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage7",
                    "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage8",
                    "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageArContractPage9"
                ];

                // Check if the terms images exist and add corresponding functions
                for (let i = 0; i < pageImagePaths.length; i++) {
                    const pageImagePath = pageImagePaths[i];
                    if (pageImagePath && pageImagePath.trim() !== "") {
                        const pageExists = await imageExists(pageImagePath);
                        if (pageExists) {
                            createPageFunctions.push({ func: termsCreatePageFunctions[i], order: 7 + i });
                        }
                    }
                }

                createPageFunctions.sort((a, b) => a.order - b.order);
                console.log("Sorted createPageFunctions:", createPageFunctions);
                const imageBlobs = [];
                for (const { func, order } of createPageFunctions) {
                    console.log(`Executing ${func.name} (order ${order})`);
                    // Wait for a specified delay before executing the function
                    try {
                        const blob = await func();
                        imageBlobs.push(blob);
                        console.log(`Successfully executed ${func.name} (order ${order})`);
                    } catch (error) {
                        console.error(`Error executing ${func.name} (order ${order}):`, error);
                        throw error;
                    }
                }
                // التأكد من عدد الصفحات
                const pageCount = imageBlobs.length;
                console.log("pageCount", pageCount);
                // if (pageCount < 8 || pageCount > 9) {
                //     throw new Error(`Invalid number of pages: ${pageCount}. Expected 8 or 9 pages.`);
                // }
                // إنشاء عقد PDF باستخدام الصور المجمعة
                await createPdfContract(imageBlobs, "SavePdfArContract");
            } catch (error) {
                console.error("Error creating Arabic PDF contract:", error);
                // window.location.href = "/BS/Contract/FailedToast?type=arcontract";
            }
        }

    </script>
    <!--Create En Contract Pdf-->
    <script>
        async function loadEnSignatures() {
            console.log("RenterInformation.signture", RenterInformation.signture)
            var renterName = RenterInformation.personalEnName;
            var renterSignature = RenterInformation.signture.replace('~', '');
            var userName = decodeHTMLEntities("@user.CrMasUserInformationEnName");
            var userSignature = decodeHTMLEntities("@user.CrMasUserInformationSignature").replace('~', '');
            var directorOfLessor = decodeHTMLEntities("@user.CrMasUserInformationLessorNavigation.CrMasLessorInformationDirectorEnName");
            var directorOfLessorSignature = decodeHTMLEntities("@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageSignatureDirector").replace('~', '');
            var directorOfBranch = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorEnName");
            var directorOfBranchSignature = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationDirectorSignature").replace('~', '');
            // Adding console logs for debugging
            console.log("Loading signatures...");
            const promises = [
                loadImage(directorOfLessorSignature),
                loadImage(userSignature),
                loadImage(directorOfBranchSignature)
            ];

            if (renterSignature) {
                promises.push(loadImage(renterSignature));
            }
            const [signatureImg1, signatureImg2, signatureImg3, signatureImg4] = await Promise.all(promises);
            return {
                renterName: renterName,
                userName: userName,
                directorOfLessor: directorOfLessor,
                directorOfBranch: directorOfBranch,
                signatureImg1: signatureImg1,
                signatureImg2: signatureImg2,
                signatureImg3: signatureImg3,
                signatureImg4: renterSignature ? signatureImg4 : ""
            };
        }
        function DrawEnNameAndSignture(signatures, ctx, canvas) {
            ctx.fillText(signatures.directorOfLessor, canvas.width - 2000, 3055);
            ctx.drawImage(signatures.signatureImg1, canvas.width - 1700, 2980, 200, 100);
            ctx.fillText(signatures.userName, canvas.width - 1300, 3055);
            ctx.drawImage(signatures.signatureImg2, canvas.width - 900, 2980, 200, 100);
            ctx.fillText(signatures.directorOfBranch, canvas.width - 2000, 3190);
            ctx.drawImage(signatures.signatureImg3, canvas.width - 1700, 3120, 200, 100);
            ctx.fillText(signatures.renterName, canvas.width - 1300, 3190);

            if (signatures.signatureImg4) {
                ctx.drawImage(signatures.signatureImg4, canvas.width - 900, 3120, 200, 100);
            }
        }
        //Page1
        const getEnDataOfPage1 = () => {
            // Contract Info
            const contractNo = "@ViewBag.ContractNo";
            var dateTimeNow = decodeHTMLEntities('@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fffK")');
            var startDate = new Date(dateTimeNow);
            var daysNo = parseInt(document.getElementById('dayNo').value);
            var endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + daysNo);
            const miladiDate = new Date(dateTimeNow);
            return {
                contractNo: "@ViewBag.ContractNo" || "",
                miladiDateString: getFormatDate(miladiDate) || "",
                startMiladiDate: getFormatDate(startDate) || "",
                endMiladiDate: getFormatDate(endDate) || "",
                currentHijriDate: formatHijriEnDate(miladiDate) || "",
                startHijriDate: formatHijriEnDate(startDate) || "",
                endHijriDate: formatHijriEnDate(endDate) || "",
                status: "New",
                branchName: decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationEnName") || "",
                branchPhone: (decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationTelephone") + decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationTelephone")) || "",
                branchMobile: (decodeHTMLEntities("@Model.CrCasBranchInformation.CrMasBranchInformationMobileKey") + decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationMobile")) || "",
                branchEmail: decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationLessorNavigation.CrMasLessorInformationEmail") || "",
                branchPost: decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchPost.CrCasBranchPostEnConcatenate") || "",
                CarName: CarInformationForContract.crCasCarInformationConcatenateEnName || "",
                CarSerialNo: CarInformationForContract.crCasCarInformationSerailNo || "",
                CarRegistration: CarInformationForContract.registerationEn || "",
                CarFuel: CarInformationForContract.fuelEn || "",
                CarCVT: CarInformationForContract.cvtEn || "",
                RunningCardNo: CarInformationForContract.runningCardNo || "",
                RunningCardEndDate: CarInformationForContract.runningCardEndDate || "",
                InsurancePolicyNo: CarInformationForContract.insurancePolicyNo || "",
                InsurancePolicyEndDate: CarInformationForContract.insurancePolicyEndDate || "",
                PeriodicInspectionNo: CarInformationForContract.periodicInspectionNo || "",
                RenterName: RenterInformation.personalEnName || "",
                RenterId: RenterInformation.renterID || "",
                RenterMembership: RenterInformation.enMembership || "",
                RenterEmail: RenterInformation.personalEmail || "",
                RenterPost: RenterInformation.postEnNameConcenate || "",
                RenterReasons: $("#Contract_RenterReasons").val() || ""
            };
        };
        const CreateEnPageContract1 = async () => {
            return new Promise(async (resolve, reject) => {
                var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage1";
                var imagePath = image.replace('~', '');
                // Contract Info
                const contractNo = "@ViewBag.ContractNo";
                // get data For Page 1
                var Data = getEnDataOfPage1();
                var signtures = await loadEnSignatures();
                // Last Director and manger and user and renter with signture
                // Text on Image
                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var url;
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);

                    ctx.font = "bold 35px serif";
                    ctx.textAlign = "left";
                    ctx.fillStyle = "black";
                    //Contract
                    ctx.fillText(Data.contractNo, canvas.width - 1990, 790);
                    ctx.fillText(Data.currentHijriDate, canvas.width - 2200, 870);
                    ctx.fillText(Data.miladiDateString, canvas.width - 1300, 870);
                    ctx.fillText(Data.startHijriDate, canvas.width - 2100, 945);
                    ctx.fillText(Data.startMiladiDate, canvas.width - 1300, 945);
                    ctx.fillText(Data.endHijriDate, canvas.width - 2100, 1025);
                    ctx.fillText(Data.endMiladiDate, canvas.width - 1300, 1025);
                    ctx.fillText(Data.status, canvas.width - 2030, 1105);
                    //Branch
                    ctx.font = "bold 50px serif";
                    ctx.fillText(Data.branchName, canvas.width - 2310, 1275);
                    ctx.font = "bold 35px serif";
                    ctx.fillText(Data.branchMobile, canvas.width - 2110, 1388);
                    ctx.fillText(Data.branchPhone, canvas.width - 1220, 1388);
                    ctx.fillText(Data.branchEmail, canvas.width - 2182, 1472);
                    ctx.fillText(Data.branchPost, canvas.width - 2150, 1558);
                    //Car
                    ctx.font = "bold 50px serif";
                    ctx.fillText(Data.CarName, canvas.width - 2310, 1750);
                    ctx.font = "bold 35px serif";
                    ctx.fillText(Data.CarSerialNo, canvas.width - 2120, 1870);
                    ctx.fillText(Data.CarRegistration, canvas.width - 2140, 1955);
                    ctx.fillText(Data.CarFuel, canvas.width - 1235, 1955);
                    ctx.fillText(Data.CarCVT, canvas.width - 660, 1955);
                    ctx.fillText(Data.PeriodicInspectionNo, canvas.width - 1950, 2040);

                    ctx.fillText(Data.RunningCardNo, canvas.width - 2020, 2122)
                    ctx.fillText(Data.RunningCardEndDate, canvas.width - 740, 2122);

                    ctx.fillText(Data.InsurancePolicyNo, canvas.width - 1920, 2207);
                    ctx.fillText(Data.InsurancePolicyEndDate, canvas.width - 740, 2207);

                    // Renter
                    ctx.font = "bold 50px serif";
                    ctx.fillText(Data.RenterName, canvas.width - 2310, 2390);
                    ctx.font = "bold 35px serif";
                    ctx.fillText(Data.RenterId, canvas.width - 2150, 2505);
                    ctx.fillText("", canvas.width - 2150, 2590);
                    ctx.fillText(Data.RenterMembership, canvas.width - 1175, 2588);
                    ctx.fillText(Data.RenterEmail, canvas.width - 2182, 2675);
                    ctx.fillText(Data.RenterPost, canvas.width - 2150, 2768);
                    ctx.fillText(Data.RenterReasons, canvas.width - 2150, 2850);
                    // Last
                    DrawEnNameAndSignture(signtures, ctx, canvas);
                    canvas.toBlob(async function (blob) {
                        // Return the blob
                        resolve(blob);
                    }, "image/png");
                };
                img.src = imagePath;
            });
        };
        //Page2
        const getEnDataOfPage2 = () => {
            const getFormattedDate = (date) => date ? getFormatDate(date) : "";
            return {
                DriverName: DriverInformation?.personalEnName || "",
                DriverId: DriverInformation?.renterID || "",
                DriverBirthDate: getFormattedDate(DriverInformation?.birthDate),
                DriverGender: DriverInformation?.personalEnGender || "",
                DriverNationality: DriverInformation?.personalEnNationality || "",
                DriverLicense: DriverInformation?.licenseEnName || "",
                DriverLicenseNo: DriverInformation?.licenseCode || "",
                DriverLicenseExpiryDate: getFormattedDate(DriverInformation?.licenseExpiryDate),
                DriverEmployerName: DriverInformation?.employerEnName || "",
                DriverMembership: DriverInformation?.enMembership || "",
                DriverPersonalProfessions: DriverInformation?.personalEnProfessions || "",
                DriverPersonalEmail: DriverInformation?.personalEmail || "",
                DriverPostNameConcenate: DriverInformation?.postEnNameConcenate || "",
                DriverReasons: $("#Contract_DriverReasons").val() || "",

                AddDriverName: AddDriverInformation?.personalEnName || "",
                AddDriverId: AddDriverInformation?.renterID || "",
                AddDriverBirthDate: getFormattedDate(AddDriverInformation?.birthDate),
                AddDriverGender: AddDriverInformation?.personalEnGender || "",
                AddDriverNationality: AddDriverInformation?.personalEnNationality || "",
                AddDriverLicense: AddDriverInformation?.licenseEnName || "",
                AddDriverLicenseNo: AddDriverInformation?.licenseCode || "",
                AddDriverLicenseExpiryDate: getFormattedDate(AddDriverInformation?.licenseExpiryDate),
                AddDriverEmployerName: AddDriverInformation?.employerEnName || "",
                AddDriverMembership: AddDriverInformation?.enMembership || "",
                AddDriverPersonalProfessions: AddDriverInformation?.personalEnProfessions || "",
                AddDriverPersonalEmail: AddDriverInformation?.personalEmail || "",
                AddDriverPostNameConcenate: AddDriverInformation?.postEnNameConcenate || "",
                AddDriverReasons: $("#Contract_AddDriverReasons").val() || "",

                PrivateDriverName: PrivateDriverInformation?.personalEnName || "",
                PrivateDriverId: PrivateDriverInformation?.renterID || "",
                PrivateDriverBirthDate: getFormattedDate(PrivateDriverInformation?.birthDate),
                PrivateDriverGender: PrivateDriverInformation?.personalEnGender || "",
                PrivateDriverNationality: PrivateDriverInformation?.personalEnNationality || "",
                PrivateDriverLicense: PrivateDriverInformation?.licenseEnName || "",
                PrivateDriverLicenseNo: PrivateDriverInformation?.licenseCode || "",
                PrivateDriverLicenseExpiryDate: getFormattedDate(PrivateDriverInformation?.licenseExpiryDate),
                PrivateDriverEmployerName: PrivateDriverInformation?.employerEnName || "",
                PrivateDriverPersonalProfessions: PrivateDriverInformation?.personalEnProfessions || "",
                PrivateDriverPersonalEmail: PrivateDriverInformation?.personalEmail || "",
                PrivateDriverPostNameConcenate: PrivateDriverInformation?.postEnNameConcenate || "",
            };
        };
        const CreateEnPageContract2 = async () => {
            return new Promise(async (resolve, reject) => {
                var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage2";
                var imagePath = image.replace('~', '');
                // Get ALl Date for Page 2
                const Data = getEnDataOfPage2();
                var signtures = await loadEnSignatures();

                // Last Director and manger and user and renter with signture

                // Text on Image
                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var url;
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);

                    ctx.font = "bold 35px serif";
                    ctx.textAlign = "left";
                    ctx.fillStyle = "black";
                    // Driver
                    ctx.font = "bold 50px serif";
                    ctx.fillText(Data.DriverName, canvas.width - 2300, 680);
                    ctx.font = "bold 35px serif";
                    ctx.fillText(Data.DriverId, canvas.width - 2090, 795);
                    ctx.fillText(Data.DriverBirthDate, canvas.width - 2050, 880);
                    ctx.fillText(Data.DriverGender, canvas.width - 1310, 880);
                    ctx.fillText(Data.DriverNationality, canvas.width - 650, 880);
                    ctx.fillText(Data.DriverLicense, canvas.width - 2010, 965);
                    ctx.fillText(Data.DriverLicenseNo, canvas.width - 1300, 965);
                    ctx.fillText(Data.DriverLicenseExpiryDate, canvas.width - 740, 965);
                    ctx.fillText(Data.DriverPersonalProfessions, canvas.width - 2080, 1045);
                    ctx.fillText(Data.DriverMembership, canvas.width - 1120, 1045);
                    ctx.fillText(Data.DriverEmployerName, canvas.width - 2130, 1130);
                    ctx.fillText(Data.DriverPersonalEmail, canvas.width - 2130, 1215);
                    ctx.fillText(Data.DriverPostNameConcenate, canvas.width - 2130, 1300);
                    ctx.fillText(Data.DriverReasons, canvas.width - 2130, 1375);
                    // Add Driver
                    ctx.font = "bold 50px serif";
                    ctx.fillText(Data.AddDriverName, canvas.width - 2300, 1555);
                    ctx.font = "bold 35px serif";
                    ctx.fillText(Data.AddDriverId, canvas.width - 2070, 1655);
                    ctx.fillText(Data.AddDriverBirthDate, canvas.width - 2050, 1740);
                    ctx.fillText(Data.AddDriverGender, canvas.width - 1310, 1740);
                    ctx.fillText(Data.AddDriverNationality, canvas.width - 650, 1740);
                    ctx.fillText(Data.AddDriverLicense, canvas.width - 2010, 1820);
                    ctx.fillText(Data.AddDriverLicenseNo, canvas.width - 1300, 1820);
                    ctx.fillText(Data.AddDriverLicenseExpiryDate, canvas.width - 740, 1820);
                    ctx.fillText(Data.AddDriverPersonalProfessions, canvas.width - 2080, 1905);
                    ctx.fillText(Data.AddDriverMembership, canvas.width - 1120, 1905);
                    ctx.fillText(Data.AddDriverEmployerName, canvas.width - 2130, 1990);
                    ctx.fillText(Data.AddDriverPersonalEmail, canvas.width - 2130, 2070);
                    ctx.fillText(Data.AddDriverPostNameConcenate, canvas.width - 2130, 2160);
                    ctx.fillText(Data.AddDriverReasons, canvas.width - 2130, 2240);
                    // Private Driver
                    ctx.font = "bold 50px serif";
                    ctx.fillText(Data.PrivateDriverName, canvas.width - 2300, 2410);
                    ctx.font = "bold 35px serif";
                    ctx.fillText(Data.PrivateDriverId, canvas.width - 2070, 2525);
                    ctx.fillText(Data.PrivateDriverBirthDate, canvas.width - 2050, 2610);
                    ctx.fillText(Data.PrivateDriverGender, canvas.width - 1310, 2610);
                    ctx.fillText(Data.PrivateDriverNationality, canvas.width - 650, 2610);

                    ctx.fillText(Data.PrivateDriverLicense, canvas.width - 2010, 2700);
                    ctx.fillText(Data.PrivateDriverLicenseNo, canvas.width - 1300, 2700);
                    ctx.fillText(Data.PrivateDriverLicenseExpiryDate, canvas.width - 740, 2700);
                    ctx.fillText(Data.PrivateDriverPersonalEmail, canvas.width - 2130, 2785);
                    // Last
                    DrawEnNameAndSignture(signtures, ctx, canvas);
                    canvas.toBlob(async function (blob) {
                        // Return the blob
                        resolve(blob);
                    }, "image/png");
                };
                img.src = imagePath;
            });
        };
        //Page3
        const getEnDataOfPage3 = () => {
            const contractNo = "@ViewBag.ContractNo";
            const fromBranchName = decodeHTMLEntities("@Model.CrCasBranchInformation.CrCasBranchInformationEnShortName") || "";
            var selectedOptionBrn = $("#Receiving-branch-dropdown option:selected");
            const toBranchName = selectedOptionBrn.data('en') || '';
            const geographicDistict = document.getElementById('Delegate-out').checked ? "Outside the kingdom" : "Inside the kingdom";
            const freeHours = CarInformation.carPrice.crCasPriceCarBasicFreeAdditionalHours || "";
            const freeKM = CarInformation.carPrice.crCasPriceCarBasicNoDailyFreeKm || "";
            const age = `${CarInformation?.carPrice?.crCasPriceCarBasicMinAge || ""} - ${CarInformation?.carPrice?.crCasPriceCarBasicMaxAge || ""}`;
            var rentDaily = CarInformation.carPrice.crCasPriceCarBasicDailyRent || "";
            var maxHourValue = CarInformation.carPrice.crCasPriceCarBasicExtraHourValue || "";
            var addKmValue = CarInformation.carPrice.crCasPriceCarBasicAdditionalKmValue || "";
            var advatagesValue = $("#AdvatagesValue").text() || "";
            var choicesValue = $("#ChoicesValue").text() || "";
            var additionalValue = $("#AdditionalValue").text() || "";
            var addDriverValue = CarInformation.carPrice.crCasPriceCarBasicAdditionalDriverValue || "";
            var privateDriverValue = CarInformation.carPrice.crCasPriceCarBasicPrivateDriverValue || "";
            var compensationAccident = CarInformation.carPrice.crCasPriceCarBasicCompensationAccident || "";
            var compensationTheft = CarInformation.carPrice.crCasPriceCarBasicCompensationTheft || "";
            var compensationFire = CarInformation.carPrice.crCasPriceCarBasicCompensationFire || "";
            var compensationDrowning = CarInformation.carPrice.crCasPriceCarBasicCompensationDrowning || "";

            return {
                contractNo,
                fromBranchName,
                toBranchName,
                geographicDistict,
                freeHours,
                freeKM,
                age,
                rentDaily,
                maxHourValue,
                addKmValue,
                advatagesValue,
                choicesValue,
                additionalValue,
                addDriverValue,
                privateDriverValue,
                compensationAccident,
                compensationTheft,
                compensationFire,
                compensationDrowning
            };
        };
        function getEnAdditionalData(ctx, canvas) {
            var yOffset = 1840; // Initial y-offset for name
            var valueXOffset = canvas.width - 1020; // X-offset for value
            var nameXOffset = canvas.width - 1500; // X-offset for name
            AdditionalsItems.forEach(function (item, index) {
                var nameText = item.enName.trim();
                var valueText = item.value;
                // Set fillText for name
                ctx.fillText(nameText, nameXOffset, yOffset + (index * 70));
                // Set fillText for value
                ctx.fillText(valueText, valueXOffset, yOffset + (index * 70));
            });
        };
        function getEnChoicesData(ctx, canvas) {
            var yOffset = 1840; // Initial y-offset for name
            var valueXOffset = canvas.width - 1780; // X-offset for value
            var nameXOffset = canvas.width - 2260; // X-offset for name
            ChoiceItems.forEach(function (item, index) {
                var nameText = item.enName.trim();
                var valueText = item.value;
                // Set fillText for name
                ctx.fillText(nameText, nameXOffset, yOffset + (index * 70));
                // Set fillText for value
                ctx.fillText(valueText, valueXOffset, yOffset + (index * 70));
            });
        };
        function getEnAdvantagesData(ctx, canvas) {
            var yOffset = 1840; // Initial y-offset for name
            var valueXOffset = canvas.width - 250; // X-offset for value
            var nameXOffset = canvas.width - 760; // X-offset for name
            CarAdvantages.forEach(function (item, index) {
                var nameText = item.enName;
                var valueText = item.advantagesValue;
                // Set fillText for name
                ctx.fillText(nameText, nameXOffset, yOffset + (index * 70));
                // Set fillText for value
                ctx.fillText(valueText, valueXOffset, yOffset + (index * 70));
            });
        }
        const CreateEnPageContract3 = async () => {
            return new Promise(async (resolve, reject) => {
                var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage3";
                var imagePath = image.replace('~', '');
                // Get ALl Date for Page 2
                var Data = getEnDataOfPage3();
                var signtures = await loadEnSignatures();
                // Last Director and manger and user and renter with signture
                // Text on Image
                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var url;
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);

                    ctx.font = "bold 35px serif";
                    ctx.textAlign = "left";
                    ctx.fillStyle = "black";
                    //
                    ctx.fillText(Data.fromBranchName, canvas.width - 2000, 770);
                    ctx.fillText(Data.toBranchName, canvas.width - 1140, 770);
                    ctx.fillText(Data.geographicDistict, canvas.width - 2000, 860);
                    ctx.fillText(Data.freeHours, canvas.width - 1250, 860);
                    ctx.fillText(Data.freeKM, canvas.width - 2100, 953);
                    ctx.fillText(Data.age, canvas.width - 1305, 953);
                    ctx.fillText(Data.rentDaily, canvas.width - 2100, 1045);
                    ctx.fillText(Data.advatagesValue, canvas.width - 1100, 1045);
                    ctx.fillText(Data.maxHourValue, canvas.width - 2080, 1138);
                    ctx.fillText(Data.addKmValue, canvas.width - 1270, 1138);
                    ctx.fillText(Data.choicesValue, canvas.width - 2150, 1230);
                    ctx.fillText(Data.additionalValue, canvas.width - 1300, 1230);
                    ctx.fillText(Data.addDriverValue, canvas.width - 1990, 1325);
                    ctx.fillText(Data.privateDriverValue, canvas.width - 1200, 1325);
                    ctx.fillText(Data.compensationAccident, canvas.width - 1990, 1415);
                    ctx.fillText(Data.compensationTheft, canvas.width - 1200, 1415);
                    ctx.fillText(Data.compensationFire, canvas.width - 1990, 1510);
                    ctx.fillText(Data.compensationDrowning, canvas.width - 1200, 1510);
                    // Additonals
                    if (AdditionalsItems != null && AdditionalsItems.length != 0) {
                        getEnAdditionalData(ctx, canvas);
                    }
                    //Choices
                    if (ChoiceItems != null && ChoiceItems.length != 0) {
                        getEnChoicesData(ctx, canvas);
                    }
                    //AdvantagesData
                    if (CarAdvantages != null && CarAdvantages.length != 0) {
                        getEnAdvantagesData(ctx, canvas);
                    }
                    // Last
                    DrawEnNameAndSignture(signtures, ctx, canvas);
                    canvas.toBlob(async function (blob) {
                        // Return the blob

                        resolve(blob);
                    }, "image/png");
                };
                img.src = imagePath;
            });
        };
        // Page4
        function GetEnCheckUpItems(ctx, canvas) {
            GetCheckUp();
            var yOffset = 885; // Initial y-offset for name
            var valueXOffset = canvas.width - 1400; // X-offset for value
            var nameXOffset = canvas.width - 2000; // X-offset for name
            if (CarCheckUp != null && CarCheckUp.length > 0) {
                CarCheckUp.forEach(function (item, index) {
                    var nameText = item.enName;
                    var checkupReason = item.reasonCheck + (item.reason ? " - " + item.reason : "");
                    // Set fillText for name
                    ctx.fillText(nameText, nameXOffset, yOffset + (index * 70));
                    // Set fillText for value
                    ctx.fillText(checkupReason, valueXOffset, yOffset + (index * 70));
                });
            }
        }
        const CreateEnPageContract4 = async () => {
            return new Promise(async (resolve, reject) => {
                var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage4";
                var imagePath = image.replace('~', '');                    // Get ALl Date for Page 4
                // Last Director and manger and user and renter with signture
                var signtures = await loadEnSignatures();
                ///////////////////////////////////////////////////////
                // Text on Image
                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var url;
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    ctx.font = "bold 35px serif";
                    ctx.textAlign = "left";
                    ctx.fillStyle = "black";
                    GetEnCheckUpItems(ctx, canvas);
                    // Last
                    DrawEnNameAndSignture(signtures, ctx, canvas);
                    canvas.toBlob(async function (blob) {
                        // Return the blob

                        resolve(blob);
                    }, "image/png");
                };
                img.src = imagePath;
            });
        };
        // Page5
        async function GetENCheckUpPicture() {
            // Array to store the Image objects
            const images = [];
            imgCheckUpArray.forEach(file => {
                const img = new Image();
                img.src = URL.createObjectURL(file.f);
                images.push(img);
            });
            return images;
        }
        const CreateEnPageContract5 = async () => {
            return new Promise(async (resolve, reject) => {
                var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage5";
                var imagePath = image.replace('~', '');
                // Get ALl Date for Page 5
                var pictures = await GetENCheckUpPicture();
                // Last Director and manger and user and renter with signture
                var signtures = await loadEnSignatures();
                ///////////////////////////////////////////////////////
                // Text on Image
                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var url;
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);

                    ctx.font = "bold 35px serif";
                    ctx.textAlign = "left";
                    ctx.fillStyle = "black";
                    //
                    if (pictures[0]) {
                        ctx.drawImage(pictures[0], canvas.width - 1015, 750, 650, 650);
                    }
                    if (pictures[1]) {
                        ctx.drawImage(pictures[1], canvas.width - 1015, 1470, 650, 650);
                    }
                    if (pictures[2]) {
                        ctx.drawImage(pictures[2], canvas.width - 1015, 2185, 650, 650);
                    }
                    if (pictures[3]) {
                        ctx.drawImage(pictures[3], canvas.width - 2015, 750, 650, 650);
                    }
                    if (pictures[4]) {
                        ctx.drawImage(pictures[4], canvas.width - 2015, 1470, 650, 650);
                    }
                    if (pictures[5]) {
                        ctx.drawImage(pictures[5], canvas.width - 2015, 2185, 650, 650);
                    }
                    // Last
                    DrawEnNameAndSignture(signtures, ctx, canvas);
                    canvas.toBlob(async function (blob) {
                        // Return the blob

                        resolve(blob);
                    }, "image/png");
                };
                img.src = imagePath;
            });
        };
        // Page6
        const CreateEnPageContract6 = async () => {
            return new Promise(async (resolve, reject) => {
                var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage6";
                var imagePath = image.replace('~', '');
                // Get ALl Date for Page 6
                var pictures = await GetENCheckUpPicture();
                // Last Director and manger and user and renter with signture
                var signtures = await loadEnSignatures();
                ///////////////////////////////////////////////////////
                // Text on Image
                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var url;
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);

                    ctx.font = "bold 35px serif";
                    ctx.textAlign = "left";
                    ctx.fillStyle = "black";
                    ////////////
                    if (pictures[6]) {
                        ctx.drawImage(pictures[6], canvas.width - 1015, 750, 650, 650);
                    }
                    if (pictures[7]) {
                        ctx.drawImage(pictures[7], canvas.width - 1015, 1470, 650, 650);
                    }
                    if (pictures[8]) {
                        ctx.drawImage(pictures[8], canvas.width - 1015, 2185, 650, 650);
                    }
                    if (pictures[9]) {
                        ctx.drawImage(pictures[9], canvas.width - 2015, 750, 650, 650);
                    }
                    if (pictures[10]) {
                        ctx.drawImage(pictures[10], canvas.width - 2015, 1470, 650, 650);
                    }
                    if (pictures[11]) {
                        ctx.drawImage(pictures[11], canvas.width - 2015, 2185, 650, 650);
                    }
                    // Last
                    DrawEnNameAndSignture(signtures, ctx, canvas);
                    canvas.toBlob(async function (blob) {
                        resolve(blob);
                    }, "image/png");
                };
                img.src = imagePath;

            });
        };
        // Page 7
        async function getContractEnConditionPic1() {
            var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractTerms1";
            var imagePath = image.replace('~', '');
            try {
                const mainImg = await loadImage(imagePath);
                return mainImg;
            } catch (error) {
                console.error('Error loading contract image:', error);
                throw error; // إعادة رمي الخطأ للتعامل معه في المتصل
            }
        }
        const CreateEnPageContract7 = async () => {
            return new Promise(async (resolve, reject) => {
                var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage7";
                var imagePath = image.replace('~', '');
                // Last Director and manger and user and renter with signture
                //Get Pic
                // var mainImg = await getContractEnConditionPic1();
                var signtures = await loadEnSignatures();
                ///////////////////////////////////////////////////////
                // Text on Image
                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var url;
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);

                    ctx.font = "bold 35px serif";
                    ctx.textAlign = "left";
                    ctx.fillStyle = "black";
                    // //Get Pic
                    // ctx.drawImage(mainImg, canvas.width - 2192, 720, 1900, 2120);
                    // Last
                    DrawEnNameAndSignture(signtures, ctx, canvas);
                    canvas.toBlob(async function (blob) {
                        // Return the blob
                        resolve(blob);
                    }, "image/png");
                };
                img.src = imagePath;
            });
        };
        // Page 8
        async function getContractEnConditionPic2() {
            var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractTerms2";
            var imagePath = image.replace('~', '');
            try {
                const mainImg = await loadImage(imagePath);
                return mainImg;
            } catch (error) {
                console.error('Error loading contract image:', error);
                throw error; // إعادة رمي الخطأ للتعامل معه في المتصل
            }
        }
        const CreateEnPageContract8 = async () => {
            return new Promise(async (resolve, reject) => {
                var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage8";
                var imagePath = image.replace('~', '');
                // Last Director and manger and user and renter with signture
                //Get Pic
                // var mainImg = await getContractEnConditionPic2();
                var signtures = await loadEnSignatures();
                ///////////////////////////////////////////////////////
                // Text on Image
                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var url;
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);

                    ctx.font = "bold 35px serif";
                    ctx.textAlign = "left";
                    ctx.fillStyle = "black";
                    // //Get Pic
                    // ctx.drawImage(mainImg, canvas.width - 2192, 720, 1900, 2120);
                    // Last
                    DrawEnNameAndSignture(signtures, ctx, canvas);
                    canvas.toBlob(async function (blob) {
                        // Return the blob
                        resolve(blob);
                    }, "image/png");
                };
                img.src = imagePath;
            });
        };
        // Page 9
        async function getContractEnConditionPic3() {
            var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractTerms3";
            var imagePath = image.replace('~', '');
            try {
                const mainImg = await loadImage(imagePath);
                return mainImg;
            } catch (error) {
                console.error('Error loading contract image:', error);
                throw error; // إعادة رمي الخطأ للتعامل معه في المتصل
            }
        }
        const CreateEnPageContract9 = async () => {
            return new Promise(async (resolve, reject) => {
                var image = "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage9";
                var imagePath = image.replace('~', '');
                // Last Director and manger and user and renter with signture
                //Get Pic
                // var mainImg = await getContractEnConditionPic3();
                var signtures = await loadEnSignatures();
                ///////////////////////////////////////////////////////
                // Text on Image
                // Get Image And Text On
                // Read the image file as a Blob
                const responseImage = await fetch(imagePath);
                const blob = await responseImage.blob();
                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var url;
                var img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);

                    ctx.font = "bold 35px serif";
                    ctx.textAlign = "left";
                    ctx.fillStyle = "black";
                    // //Get Pic
                    // ctx.drawImage(mainImg, canvas.width - 2192, 720, 1900, 2120);
                    // Last
                    DrawEnNameAndSignture(signtures, ctx, canvas);
                    canvas.toBlob(async function (blob) {
                        // Return the blob
                        resolve(blob);
                    }, "image/png");
                };
                img.src = imagePath;
            });
        };
        async function getPictureAndCreateEnPdfContract() {
            try {
                console.log("Starting getPictureAndCreateEnPdfContract");
                async function imageExists(imagePath) {
                    try {
                        const response = await fetch(imagePath);
                        return response.ok;
                    } catch (error) {
                        console.error(`Error checking image at ${imagePath}:`, error);
                        return false;
                    }
                }
                const createPageFunctions = [
                    { func: CreateEnPageContract1, order: 1 },
                    { func: CreateEnPageContract2, order: 2 },
                    { func: CreateEnPageContract3, order: 3 },
                    { func: CreateEnPageContract4, order: 4 },
                    { func: CreateEnPageContract5, order: 5 },
                ];

                if (imgCheckUpArray.length > 6) {
                    createPageFunctions.push({ func: CreateEnPageContract6, order: 6 });
                }
                // Paths to the terms images
                // const termsImagePaths = [
                //     "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractTerms1",
                //     "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractTerms2",
                //     "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractTerms3"
                // ];

                // Corresponding create page functions for termsImagePaths
                const termsCreatePageFunctions = [
                    CreateEnPageContract7,
                    CreateEnPageContract8,
                    CreateEnPageContract9
                ];

                // Paths to the pages images
                const pageImagePaths = [
                    "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage7",
                    "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage8",
                    "@lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage.CrMasLessorImageEnContractPage9"
                ];

                // Check if the terms images exist and add corresponding functions
                for (let i = 0; i < pageImagePaths.length; i++) {
                    const pageImagePath = pageImagePaths[i];
                    if (pageImagePath && pageImagePath.trim() !== "") {
                        const pageExists = await imageExists(pageImagePath);
                        if (pageExists) {
                            createPageFunctions.push({ func: termsCreatePageFunctions[i], order: 7 + i });
                        }
                    }
                }
                // ترتيب الوظائف حسب ترتيبها
                createPageFunctions.sort((a, b) => a.order - b.order);
                console.log("Sorted createPageFunctions:", createPageFunctions);

                // تنفيذ الوظائف بالترتيب وجمع الصور
                const imageBlobs = [];
                for (const { func, order } of createPageFunctions) {
                    console.log(`Executing ${func.name} (order ${order})`);
                    try {
                        const blob = await func();
                        imageBlobs.push(blob);
                        console.log(`Successfully executed ${func.name} (order ${order})`);
                    } catch (error) {
                        console.error(`Error executing ${func.name} (order ${order}):`, error);
                        throw error; // إعادة الرمي للتعامل مع الخطأ في الـ try-catch الخارجي
                    }
                }
                console.log("Collected imageBlobs:", imageBlobs);
                // التأكد من عدد الصفحات
                const pageCount = imageBlobs.length;
                // if (pageCount < 8 || pageCount > 9) {
                //     throw new Error(`Invalid number of pages: ${pageCount}. Expected 8 or 9 pages.`);
                // }
                // إنشاء عقد PDF باستخدام الصور المجمعة
                await createPdfContract(imageBlobs, "SavePdfEnContract");
            } catch (error) {
                console.error("Error creating English PDF contract:", error);
                // إعادة التوجيه إلى صفحة الخطأ
                window.location.href = "/BS/Contract/FailedToast?type=encontract";
            }
        }
    </script>
    <script>
        // Create pdf with multi photo
        const createPdfContract = async (imageBlobs, InputPdf) => {
            const doc = new jsPDF('p', 'pt', 'a4', true);
            for (let imageIndex = 0; imageIndex < imageBlobs.length; imageIndex++) {
                if (imageIndex > 0) {
                    doc.addPage();
                }
                doc.setPage(imageIndex + 1);

                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();

                const blob = imageBlobs[imageIndex];
                const img = await createImageFromBlob(blob);

                const imgWidth = pageWidth;
                const imgHeight = (pageWidth * img.height) / img.width;

                // Calculate the position to center the image vertically
                const imgYPos = (pageHeight - imgHeight) / 2;
                const imgXPos = 0;
                doc.addImage(img, 'JPEG', imgXPos, imgYPos, imgWidth, imgHeight, '', 'FAST');
                // Convert the PDF to a blob
                const pdfBase64 = doc.output('datauristring');
                // Set the base64-encoded PDF to the hidden input field
                document.getElementById(InputPdf).value = pdfBase64;
            }
        };
        // Helper function to create an image element from a blob
        const createImageFromBlob = (blob) => {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = URL.createObjectURL(blob);
            });
        };
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('msform');
            const submitButton = document.getElementById('submitForm');

            submitButton.addEventListener('click', async function (event) {
                event.preventDefault();

                if ($("#msform").valid()) {
                    const AmountPayed = document.getElementById("AmountPayed").value;

                    CheckIfCanPayLessThanTotalAmount();
                    if (somethingIsNotOkay) {
                        // startLoader(55000);
                        $("#ContainerLoader").show();
                        try {
                            await sendStaticImageToWhatsApp();
                            console.log("StaticImageToWhatsApp sent successfully.");

                            // Send invoices to WhatsApp
                            await sendArInvoiceToWhatsApp();
                            console.log("Arabic invoice sent successfully.");

                            await sendEnInvoiceToWhatsApp();
                            console.log("English invoice sent successfully.");

                            if (parseFloat(AmountPayed) > 0) {
                                // Send receipts to WhatsApp if any amount is paid
                                await sendArReceiptToWhatsApp();
                                console.log("Arabic receipt sent successfully.");

                                await sendEnReceiptToWhatsApp();
                                console.log("English receipt sent successfully.");
                            }

                            // Run Arabic PDF creation
                            await getPictureAndCreateArPdfContract();
                            console.log("Arabic PDF contract creation completed successfully.");

                            // Run English PDF creation
                            await getPictureAndCreateEnPdfContract();
                            console.log("English PDF contract creation completed successfully.");


                            // Submit the form after all processes are done
                            form.submit();
                        } catch (error) {
                            console.error("Error during the PDF contract creation:", error);
                            // Redirect to error handling page or show an error message
                            window.location.href = "/BS/Contract/FailedToast?type=createpdf";
                        }
                    } else {
                        CheckIfCanPayLessThanTotalAmount();
                    }
                }
            });
        });
    </script>
    <script type="text/javascript">
        function createPdfAndSendToWhatsApp(receiptNo, invoiceNo, imageBlob, InputPdf, language) {
            var doc = new jsPDF('p', 'pt', 'a4', true);
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            try {
                // Convert the image blob to a base64 DataURL
                const reader = new FileReader();
                reader.onload = function () {
                    const imageDataUrl = reader.result;
                    // Add the image to the PDF
                    const imgWidth = pageWidth; // Width of the image in the PDF
                    const imgHeight = pageHeight; // Height of the image in the PDF
                    const imgXPos = 0; // X position of the image (left edge)
                    const imgYPos = 0; // Y position of the image (top edge)
                    doc.addImage(imageDataUrl, 'JPEG', imgXPos, imgYPos, imgWidth, imgHeight, '', 'FAST');
                    // Convert the PDF to a blob
                    const pdfBlob = doc.output('blob');
                    const blobUrl = URL.createObjectURL(pdfBlob);
                    const pdfBase64 = doc.output('datauristring');
                    // Set the base64-encoded PDF to the hidden input field
                    document.getElementById(InputPdf).value = pdfBase64;

                    // Prepare form data with PDF
                    if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US" && InputPdf != "" && InputPdf != null && language == "en") {
                        if (InputPdf == "SavePdfEnInvoice") {
                            document.getElementById('Contract_InitialInvoiceNo').value = invoiceNo;
                        }
                        else {
                            document.getElementById('Contract_AccountReceiptNo').value = receiptNo;
                        }
                    }
                    else if ("@requestCulture?.RequestCulture.UICulture.Name" == "ar-EG" && InputPdf != "" && InputPdf != null && language == "ar") {
                        if (InputPdf == "SavePdfArInvoice") {
                            document.getElementById('Contract_InitialInvoiceNo').value = invoiceNo;
                        }
                        else {
                            document.getElementById('Contract_AccountReceiptNo').value = receiptNo;
                        }
                    }
                };
                reader.readAsDataURL(imageBlob); // Start reading the image blob
            } catch (error) {
                console.error('Error adding image to PDF:', error);
            }
        }
    </script>
    <script>
        $(document).ready(function () {
            $("#Contract_PaymentMethod").change(function () {
                var PaymentMethod = $("#Contract_PaymentMethod").val();
                var BranchCode = $("#SelectedBranch").val();
                $.get("/BS/Contract/GetSalesPoint", { PaymentMethod: PaymentMethod, BranchCode: BranchCode }, function (data) {
                    $("#Contract_SalesPoint").empty();
                    if (data.type == "1" && data.salesPoints != null) {
                        $.each(data.salesPoints, function (index, row) {
                            if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {
                                $("#Contract_SalesPoint").append("<option  value= '" + row.crCasAccountSalesPointCode + "'>" + row.crCasAccountSalesPointEnName + "</option>")
                            }
                            else {
                                $("#Contract_SalesPoint").append("<option class='text-right' value= '" + row.crCasAccountSalesPointCode + "'>" + row.crCasAccountSalesPointArName + "</option>")
                            }
                        });
                    }
                    else if (data.type == "2" && data.accountBank != null) {
                        $.each(data.accountBank, function (index, row) {
                            if ("@requestCulture?.RequestCulture.UICulture.Name" == "en-US") {

                                $("#Contract_SalesPoint").append("<option value= '" + row.crCasAccountBankCode + "'>" + row.crCasAccountBankEnName + "</option>")
                            }
                            else {
                                $("#Contract_SalesPoint").append("<option class='text-right' value= '" + row.crCasAccountBankCode + "'>" + row.crCasAccountBankArName + "</option>")
                            }
                        });
                    }

                });
            })
        });
    </script>
    <script>
        $(document).ready(function () {
            /////////////////////////////////////////////////////////////////////////search-icon-renter///////////////////////////////////////////////////////////////////
            const imagePayRenter = document.getElementById("seacrh_icon_Renter");
            const dropdownPayRenter = document.getElementById("dropdown_content_Renter");
            imagePayRenter.addEventListener('click', function () {
                if (dropdownPayRenter.style.display === 'block') {
                    dropdownPayRenter.style.display = 'none';
                } else {
                    dropdownPayRenter.style.display = 'block';
                }
            });

            /////////////////////////////////////////////////////////////////////////search-icon-driver///////////////////////////////////////////////////////////////////
            const imagePayDriver = document.getElementById("seacrh_icon_Driver");
            const dropdownPayDriver = document.getElementById("dropdown_content_Driver");
            imagePayDriver.addEventListener('click', function () {
                if (dropdownPayDriver.style.display === 'block') {
                    dropdownPayDriver.style.display = 'none';
                } else {
                    dropdownPayDriver.style.display = 'block';
                }
            });
            /////////////////////////////////////////////////////////////////////////search-icon-AddDriver///////////////////////////////////////////////////////////////////
            const imagePayAddDriver = document.getElementById("seacrh_icon_AddDriver");
            const dropdownPayAddDriver = document.getElementById("dropdown_content_AddDriver");
            imagePayAddDriver.addEventListener('click', function () {
                if (dropdownPayAddDriver.style.display === 'block') {
                    dropdownPayAddDriver.style.display = 'none';
                } else {
                    dropdownPayAddDriver.style.display = 'block';
                }
            });
            /////////////////////////////////////////////////////////////////////////search-ContractINfo///////////////////////////////////////////////////////////////////
            const imagePaymentDetails = document.getElementById("payment-extra-details");
            const dropdownPaymentInfo = document.getElementById("dropdown-content-payment");
            imagePaymentDetails.addEventListener('click', function () {
                if (dropdownPaymentInfo.style.display === 'block') {
                    dropdownPaymentInfo.style.display = 'none';
                } else {
                    dropdownPaymentInfo.style.display = 'block';
                }
            });


        });
        // To decode some string
        function decodeHTMLEntities(text) {
            var textArea = document.createElement("textarea");
            textArea.innerHTML = text;
            return textArea.value;
        }
        // Function to format Hijri date
        function formatHijriDate(date) {
            const parsedDate = new Date(date);
            const options = { weekday: 'long', day: 'numeric', year: 'numeric', month: 'long', calendar: 'islamic-umalqura' };
            return parsedDate.toLocaleDateString('ar-SA', options).replace(/هـ/g, ''); // Remove "هـ" suffix
        }
        function formatHijriEnDate(date) {
            const parsedDate = new Date(date);
            const options = { weekday: 'long', day: 'numeric', year: 'numeric', month: 'long', calendar: 'islamic-umalqura' };
            return parsedDate.toLocaleDateString('en-US-u-ca-islamic-umalqura', options).replace(/AH/g, ''); // Remove "AH" suffix
        }
        function getFormatDate(date) {
            const parsedDate = new Date(date);
            if (!isNaN(parsedDate) && parsedDate != null && parsedDate != "") {
                var dateFormat = parsedDate.getFullYear() + '/' +
                    (parsedDate.getMonth() + 1).toString().padStart(2, '0') + '/' +
                    parsedDate.getDate().toString().padStart(2, '0') + ' ' +
                    parsedDate.getHours().toString().padStart(2, '0') + ':' +
                    parsedDate.getMinutes().toString().padStart(2, '0') + ':' +
                    parsedDate.getSeconds().toString().padStart(2, '0');
                return dateFormat;
            }
            return "";
        }
        function formatDateOnly(dateString) {
            var date = new Date(dateString);
            return date.getFullYear() + '/' + (date.getMonth() + 1).toString().padStart(2, '0') + '/' + date.getDate().toString().padStart(2, '0');
        }
        function splitTextInHalf(text) {
            // Check if text is null, empty, or less than or equal to 100 characters
            if (text == null || text === "") {
                return ["", ""];
            }

            if (text.length <= 100) {
                return [text, ""];
            }

            // Find the middle of the text
            const middleIndex = Math.floor(text.length / 2);

            // Find the closest space to the middle to avoid splitting words
            const beforeMiddle = text.lastIndexOf(' ', middleIndex);
            const afterMiddle = text.indexOf(' ', middleIndex + 1);

            // Determine the best split point
            const splitIndex = (middleIndex - beforeMiddle < afterMiddle - middleIndex)
                ? beforeMiddle
                : afterMiddle;

            // Split the text into two parts
            const firstHalf = text.slice(0, splitIndex).trim();
            const secondHalf = text.slice(splitIndex).trim();

            return [firstHalf, secondHalf];
        }
        function splitNumberbeforeAndafterDecimal(number) {
            let cleanedValueString = number.replace(/,/g, "");
            let parts = cleanedValueString.split('.');
            let beforeDecimal = parts[0];
            let afterDecimal = parts.length > 1 ? parts[1] : "00";
            afterDecimal = afterDecimal.padEnd(2, '0');
            // Add thousands separators to the before decimal part
            beforeDecimal = beforeDecimal.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            return [beforeDecimal, afterDecimal];
        }
    </script>
    <script>
        async function dataChanged(number) {
            try {
                const response = await $.ajax({
                    url: "/BS/Contract/Get_ConvertedNumber_Action",
                    type: "GET",
                    data: { our_No: number },
                });
                return response;
            } catch (error) {
                console.error("Error occurred: ", error);
            }
        }
    </script>
    <script>
        function showSpinner(button) {
            button.dataset.originalContent = button.innerHTML;
            console.log("button.innerHTML", button.innerHTML);

            const spinner = document.createElement('div');
            spinner.classList.add('spinner-border', 'spinner-border-sm', 'text-warning');
            spinner.setAttribute('role', 'status');
            const checkIcon = document.createElement('i');
            checkIcon.classList.add('fa-solid', 'fa-check');
            button.innerHTML = '';
            button.appendChild(spinner);
            button.classList.add('spinner-payment-check');
        }

        function removeSpinnerAndChangeColor(button) {
            button.innerHTML = button.dataset.originalContent;
            button.innerHTML = originalContentBtnSignture;
            console.log("button.innerHTML", button.innerHTML);
            console.log("originalContentBtnSignture", originalContentBtnSignture);
            const checkDiv = button.querySelector('.row .col-auto .systems-check');
            if (checkDiv) {
                checkDiv.style.backgroundColor = 'green';
            }
            button.classList.remove('spinner-payment-check');
        }
        function calculateAge(birthDate) {
            // Parse the birthdate
            var birthdate = new Date(birthDate);

            // Get today's date
            var dateTimeNow = decodeHTMLEntities('@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fffK")');
            var today = new Date(dateTimeNow);

            // Calculate the age
            var age = today.getFullYear() - birthdate.getFullYear();
            var monthDiff = today.getMonth() - birthdate.getMonth();
            var dayDiff = today.getDate() - birthdate.getDate();

            // Adjust if the birthday hasn't occurred yet this year
            if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
                age--;
            }

            return age;
        }

        function getFormattedDatesMiliadiAndHijri(language) {
            // Get the current Miladi date from the server (assuming server provides the date in a specific format)
            var dateTimeNow = decodeHTMLEntities('@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fffK")'); // or "@DateTime.Now" if you prefer local server time
            const miladiDate = new Date(dateTimeNow);

            // Format the Miladi date
            const miladiOptions = { year: 'numeric', month: '2-digit', day: '2-digit' };
            const miladiDateString = miladiDate.toLocaleDateString('en-US', miladiOptions).split('/').join('/');

            // Initialize hijriDateString
            let hijriDateString;

            // Format the Hijri date based on the language
            if (language === "ar") {
                hijriDateString = formatHijriDate(miladiDate);
            } else {
                hijriDateString = formatHijriEnDate(miladiDate);
            }

            return {
                miladiDate: miladiDateString,
                hijriDate: hijriDateString
            };
        }
    </script>
    <!--Controller to inputs-->
    <script>
        // Phone No0 dont start with zero
        document.getElementById('CheckModal-PhoneInput').addEventListener('input', function () {
            let inputValue = this.value;
            if (inputValue.startsWith('0')) {
                this.value = inputValue.replace(/^0+/, '');
            }
        });
    </script>
    <script>
        document.querySelectorAll('.email-input').forEach(function (emailInput) {
            emailInput.addEventListener('input', function (e) {
                const emailValue = emailInput.value;
                const validEmailPattern = /^[a-zA-Z0-9@@._-]*$/;
                if (!validEmailPattern.test(emailValue)) {
                    emailInput.value = emailValue.replace(/[^a-zA-Z0-9@@._-]/g, '');
                }
            });
        });
    </script>
}