@using Bnan.Core.Extensions
@model List<CrMasLessorInformation>
@inject IViewLocalizer localizer
@inject IOptions<RequestLocalizationOptions> options
@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    ViewData["returnUrl"] = string.IsNullOrEmpty(Context.Request.Path) ? "~/" : $"~{Context.Request.Path.Value}";
}
<link href="~/css/toastr.css" rel="stylesheet" />
<div class="col my-2 d-flex align-items-center justify-content-center">
    <div class="container NewUpdate-container">
        <form action="" class="needs-validation" novalidate>
            <div class="row mt-3 g-3">

                <div class="row justify-content-center">
                    <div class="col-lg-9">
                        <div class="row g-3 my-2">
                            <div class="col">
                                <h3> الربط التقني </h3>
                            </div>
                            <div class="col-md-auto save-col">
                                <button type="submit" class="custom-img-btn">
                                    <img src="../../../images/save.svg" />
                                </button>
                            </div>
                        </div>
                        <main class="mt-3 g-3">
                            <div class="accordion inputs-accordion">
                               @*  <div class=" inputs-accordion-item">
                                    <div class=" inputs-accordion-item-header">
                                        <span class="accordion-item-header-title">
                                            <i class="fa-solid fa-check data-check"></i> هيئة النقل
                                        </span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                             viewBox="0 0 24 24" fill="none" stroke="#666666"
                                             stroke-width="3" stroke-linecap="round"
                                             stroke-linejoin="round"
                                             class="lucide lucide-chevron-down accordion-item-header-icon">
                                            <path d="m6 9 6 6 6-6" />
                                        </svg>
                                    </div>
                                    <div class="accordion-item-description-wrapper">
                                        <div class="accordion-item-description">
                                            <hr class="accordion-items-hr">
                                            <div class="container-fluid ">
                                                <div class="row techncal-connect-rows">
                                                    <div class="col-md-6">
                                                        <label for="Content-Type" class="form-label">
                                                            Content-Type
                                                        </label>
                                                        <input type="text" id="Content-Type"
                                                               class="form-control inputs english-input"
                                                               name="Content-Type " maxlength="100"
                                                               required>
                                                        <div class="invaild  techncal-connect-error   ">
                                                            <div class="invalid-feedback">
                                                                الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="App-ID" class="form-label">
                                                            App-ID
                                                        </label>
                                                        <input type="text" id="App-ID"
                                                               class="form-control inputs  english-input"
                                                               name="App-ID " maxlength="100" required>
                                                        <div class="invaild  techncal-connect-error   ">
                                                            <div class="invalid-feedback">
                                                                الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="row techncal-connect-rows">
                                                    <div class="col-md-6">
                                                        <label for="App-Key" class="form-label">
                                                            App-Key
                                                        </label>
                                                        <input type="text" id="App-Key"
                                                               class="form-control inputs english-input"
                                                               name="App-Key " maxlength="100" required>
                                                        <div class="invaild  techncal-connect-error   ">
                                                            <div class="invalid-feedback">
                                                                الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="Authorization " class="form-label">
                                                            Authorization
                                                        </label>
                                                        <input type="text" id="Authorization "
                                                               class="form-control inputs  english-input"
                                                               name="Authorization  " maxlength="100"
                                                               required>
                                                        <div class="invaild  techncal-connect-error   ">
                                                            <div class="invalid-feedback">
                                                                الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="inputs-accordion-item">
                                    <div class="inputs-accordion-item-header">
                                        <span class="accordion-item-header-title">
                                            <i class="fa-solid fa-check data-check"></i> شموس
                                        </span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                             viewBox="0 0 24 24" fill="none" stroke="#666666"
                                             stroke-width="3" stroke-linecap="round"
                                             stroke-linejoin="round"
                                             class="lucide lucide-chevron-down accordion-item-header-icon">
                                            <path d="m6 9 6 6 6-6" />
                                        </svg>
                                    </div>
                                    <div class="accordion-item-description-wrapper">
                                        <div class="accordion-item-description">
                                            <hr class="accordion-items-hr">
                                            <div class="container-fluid ">
                                                <div class="row techncal-connect-rows">
                                                    <div class="col-md-6">
                                                        <label for="Content-Type-Shomoos"
                                                               class="form-label"> Content-Type </label>
                                                        <input type="text" id="Content-Type-Shomoos"
                                                               class="form-control inputs english-input"
                                                               name="Content-Type-Shomoos " maxlength="100"
                                                               required>
                                                        <div class="invaild  techncal-connect-error   ">
                                                            <div class="invalid-feedback">
                                                                الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="App-ID-Shomoos" class="form-label">
                                                            App-ID
                                                        </label>
                                                        <input type="text" id="App-ID-Shomoos"
                                                               class="form-control inputs  english-input"
                                                               name="App-ID-Shomoos " maxlength="100"
                                                               required>
                                                        <div class="invaild  techncal-connect-error   ">
                                                            <div class="invalid-feedback">
                                                                الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="row techncal-connect-rows">
                                                    <div class="col-md-6">
                                                        <label for="App-Key-Shomoos" class="form-label">
                                                            App-Key
                                                        </label>
                                                        <input type="text" id="App-Key-Shomoos"
                                                               class="form-control inputs english-input"
                                                               name="App-Key-Shomoos " maxlength="100"
                                                               required>
                                                        <div class="invaild  techncal-connect-error   ">
                                                            <div class="invalid-feedback">
                                                                الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="Authorization-Shomoos "
                                                               class="form-label"> Authorization </label>
                                                        <input type="text" id="Authorization-Shomoos "
                                                               class="form-control inputs  english-input"
                                                               name="Authorization-Shomoos  "
                                                               maxlength="100" required>
                                                        <div class="invaild  techncal-connect-error   ">
                                                            <div class="invalid-feedback">
                                                                الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="inputs-accordion-item">
                                    <div class="inputs-accordion-item-header">
                                        <span class="accordion-item-header-title">
                                            <i class="fa-solid fa-check data-check"></i> رسائل نصية
                                        </span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                             viewBox="0 0 24 24" fill="none" stroke="#666666"
                                             stroke-width="3" stroke-linecap="round"
                                             stroke-linejoin="round"
                                             class="lucide lucide-chevron-down accordion-item-header-icon">
                                            <path d="m6 9 6 6 6-6" />
                                        </svg>
                                    </div>
                                    <div class="accordion-item-description-wrapper">
                                        <div class="accordion-item-description">
                                            <hr class="accordion-items-hr">
                                            <div class="container-fluid ">
                                                <div class="row techncal-connect-rows">
                                                    <div class="col-md-6">
                                                        <label for="UserName" class="form-label">
                                                            User
                                                            Name
                                                        </label>
                                                        <input type="text" id="UserName"
                                                               class="form-control inputs english-input"
                                                               name="UserName " maxlength="100" required>
                                                        <div class="invaild  techncal-connect-error   ">
                                                            <div class="invalid-feedback">
                                                                الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="API-Token " class="form-label">
                                                            API-Token
                                                        </label>
                                                        <input type="text" id="API-Token "
                                                               class="form-control inputs  english-input"
                                                               name="API-Token  " maxlength="100" required>
                                                        <div class="invaild  techncal-connect-error   ">
                                                            <div class="invalid-feedback">
                                                                الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div> *@
                                <div class="inputs-accordion-item">
                                    <div class="inputs-accordion-item-header">
                                        <span class="accordion-item-header-title">
                                            <i class="fa-solid fa-check data-check"></i> واتساب
                                        </span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                             viewBox="0 0 24 24" fill="none" stroke="#666666"
                                             stroke-width="3" stroke-linecap="round"
                                             stroke-linejoin="round"
                                             class="lucide lucide-chevron-down accordion-item-header-icon">
                                            <path d="m6 9 6 6 6-6" />
                                        </svg>
                                    </div>
                                    <div class="accordion-item-description-wrapper">
                                        <div class="accordion-item-description">
                                            <hr class="accordion-items-hr">
                                            <div class="container-fluid ">
                                                <div class="row techncal-connect-rows ">
                                                    <div class="col-md-7">
                                                        <div class="row">
                                                            <div class="col-md-10">
                                                                <label for="DeviceName-whatsapp"
                                                                       class="form-label">
                                                                    اسم الجهاز
                                                                </label>
                                                                <input type="text"
                                                                       id="DeviceName-whatsapp"
                                                                       class="form-control inputs"
                                                                       name="DeviceName-whatsapp"
                                                                       maxlength="100" required>
                                                                <div class="invaild ">
                                                                    <div class="invalid-feedback">
                                                                        الحقل مطلوب
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-10">
                                                                <label for="phone2" class="form-label">
                                                                    الجوال
                                                                </label>
                                                                <div class="input-group ">
                                                                    <input type="tel"
                                                                           class="form-control inputs tel-input"
                                                                           id="phone2" name="phone2" maxlength="20" required>
                                                                    <select class="input-group-text select-style counterCode"
                                                                            name="counterCode-phone2">
                                                                        <option value="+966">+966</option>
                                                                        <option value="+962">+962</option>
                                                                        <option value="+20">+20</option>
                                                                    </select>
                                                                    <div class="invaild">
                                                                        <div class="invalid-feedback">
                                                                            الحقل مطلوب
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-10">
                                                                <label for="API-Token-whatsapp"
                                                                       class="form-label">
                                                                    رمز واجهة برمجة التطبيقات
                                                                </label>
                                                                <input type="text"
                                                                       id="API-Token-whatsapp"
                                                                       class="form-control inputs"
                                                                       name="API-Token-whatsapp"
                                                                       maxlength="100" required>
                                                                <div class="invaild">
                                                                    <div class="invalid-feedback">
                                                                        الحقل مطلوب
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-5 d-flex flex-column text-center"
                                                         style="min-height: 190px;">
                                                        <div class="d-flex align-items-center justify-content-center h-100"
                                                             id="QRArea">
                                                            <button class="border-0 bg-transparent" id="RegenerateQR" onclick="fetchQrCode()">
                                                                <img id="qrImg" src="~/MasSystem/images/qrcode 1.svg">
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </main>
                    </div>
                </div>
            </div>
        </form>
        <a asp-area="MAS" asp-controller="Home" asp-action="Index" data-bs-toggle="tooltip" data-bs-placement="top"
           data-bs-custom-class="custom-tooltip" data-bs-title="@localizer["BackToHome"]" class="main-page-icon">
            <img src="~/MasSystem/images/back to main.svg" alt="man">
        </a>
    </div>
</div>
@section scripts {
    <script src="~/js/toastr.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>
    <script>
        async function generateQrCode() {
            var select_company_id = "4005";
            var settings = {
                url: "http://" + "62.84.187.79:3000" + "/api/generateQrCodeNew2/" + select_company_id,
                method: "GET",
                timeout: 50000, // sets timeout to 50 seconds (optional, fetch doesn't support native timeout directly)
                headers: {
                    "Access-Control-Allow-Origin": "*",
                    "Access-Control-Allow-Headers": "Origin, X-Requested-With, Content-Type, Accept"
                },
            };

            try {
                const response = await fetch(settings.url, {
                    method: settings.method,
                    headers: settings.headers,
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json(); // Parse the JSON response
                console.log("QR Code Response:", data);
                return data;
            } catch (error) {
                console.error("Error fetching QR Code:", error);
                return null;
            }
        }
    </script>
    <script>
        async function fetchQrCode() {
            const companyId = "4005"; // Replace with the desired company ID
            const url = `/MAS/TechnicalConnectivity/GenerateQrCode?companyId=${companyId}`;

            try {
                // Clear the content of #QRArea and show the loader
                $('#QRArea').empty();
                $('#QRArea').append('<span class="loader"></span>'); // Show loader

                // Send the GET request to fetch the QR code
                const response = await fetch(url, {
                    method: 'GET',
                });

                // Check if response is not successful
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // Parse the JSON response to get QR code data
                const data = await response.json();
                var qr = data.response.qr;

                // Empty the #QRArea and append the generated QR code
                $('#QRArea').empty(); // Clear loader
                $('#QRArea').qrcode(qr); // Generate the QR code in the div

                console.log("QR Code Data:", data);
            } catch (error) {
                // Handle error
                console.error("Error fetching QR Code:", error);
                $('#QRArea').empty(); // Clear any content
                $('#QRArea').append('<span>Error fetching QR Code</span>'); // Show error message
            }
        }
       
    </script>


}